<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Begin Drupal Taxonomy Data -->
    <meta name="products" content="Live">
    <meta name="role" content="API Developer">
    <meta name="task" content="">
    <meta name="topic" content="General Info,Live Streaming">
    <meta name="API" content="General Info">
    <meta name="keywords" content="">
    <!-- End Drupal Taxonomy Data -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title>Server-Side Ad Insertion Using the Brightcove Live API</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
<link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
<script src="//use.edgefonts.net/source-code-pro.js"></script>
<link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
<link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
<link rel="stylesheet" href="/en/styles/foundation-fixes.css">

<script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-2728311-29', 'auto');
    ga('send', 'pageview');
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
    <!-- header navbar -->
    <div id="navWrapper" class="fixed"></div>
    <!-- breadcrumbs -->
    <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
    <!-- search -->
    <div id="searchModal" class="reveal-modal" data-reveal></div>
    <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
            <h1>Server-Side Ad Insertion Using the Brightcove Live API</h1>
            <!-- begin drupal content -->
            <article class="bcls-article">
                <header id="bcls_header" class="bcls-header">
                    <p>This topic shows you how to set up server-side ad insertion (SSAI) for you live stream jobs.</p>
                </header>
            </article>
            <section id="Overview" class="bcls-section">
                <h2>Overview</h2>
                <p>SSAI allows you display ads during a live streaming event at specified times. Here are the main featurs of SSAI:</p>
                <ul>
                    <li>Since ads are stitched into the live stream on the server side, they are not affected by ad blockers</li>
                    <li>Ads are inserted at cue points sent from your encoder or you can create an instant cue point using the Live API</li>
                    <li>You can ingest "slate" assets to fill any unused ad time</li>
                </ul>
            </section>
            <section id="authentication" class="bcls-section">
                <h2>Headers</h2>
                <p>The following headers are required with API requests:</p>
<pre class="line-numbers"><code class="language-http">x-api-key: <span class="bcle-input">APIKEY-HERE</span>
Content-Type: application/json</code></pre>
            </section>
            <section id="ad_configuration_variables" class="bcls-section">
                <h2>Ad configuration variables</h2>
                <p>The following table provides a summary of ad configuration variables, which are used in the requests to manage ad configurations detailed in the sections that follow.</p>
                <table class="bcls-table">
                    <caption class="bcls-caption--table">Ad Configuration Variables</caption>
                    <thead class="bcls-table__head">
                        <tr>
                            <th style="width:20%;">Variable</th>
                            <th style="width:60%;"><div style="word-wrap:break-word;">Description</div></th>
                        </tr>
                    </thead>
                    <tbody class="bcls-table__body">
                        <tr>
                            <td style="width:20%">session.session_id</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">unique session id</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">job.job_id</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">unique job id</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">application_ad_configuration.description</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">description value of the application at session creation</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">random.int32</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">random 32-bit signed integer</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">random.int64</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">random 64-bit signed integer</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">random.uuid</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">random uuid</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">server.timestamputc</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">epoch time in ms when the call from the ads-api has been made</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">client.useragent</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">http user-agent header value at session creation</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">client.ipaddress</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">http x-forwarded-for header value at session creation, if provided, otherwise the remote address</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">client.referrer</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">http referer header value at session creation (correct spelling)</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">client.referer</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">http referer header value at session creation (http spelling)</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">live.adbreak</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">(currently unused)</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">live.adbreakduration</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">double-precision floating-point value in seconds</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">live.adbreakdurationint</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">integer value in seconds</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">live.adbreak.timestamputc.wallclock</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">epoch time in ms when the call to the ads server has been made</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">live.adbreak.timestamputc.origin</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">epoch time in ms from the origin chunklist. This value indicates the time when the cue out chunk has been created in the origin chunklist.</div></td>
                        </tr>
                        <tr>
                            <td style="width:20%">live.adbreak.timestamputc.session</td>
                            <td style="text-align:left;width:60%;"><div style="word-wrap:break-word;">epoch time in ms from the ssai chunklist. This value indicates the time of the cue out chunk in the ssai chunklist. Since the adbreak content and the adbreak gap are NOT usually the same, after the 1st adbreak the live.adbreak.timestamputc.origin is different from live.adbreak.timestamputc.session. This value takes into account the time adjustments that have been made in the ssai chunklist.</div></td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section id="create_ad_configurations" class="bcls-section">
                <h2>Create an ad configuration</h2>
                <p>To create a new ad configuration, send a <code>POST</code> request to:</p>
                <pre class="line-numbers"><code class="language-http">https://api.bcovlive.io/v1/ssai/application</code></pre>
                <h4>Sample request body</h4>
<pre class="line-numbers"><code class="language-json">{
    "application_ad_configuration": {
        "ad_configuration_description": "Human readable description of the configuration",
        "ad_configuration_expected_response_type": "Dfp/Vast/SmartXML",
        "ad_configuration_strategy": "SingleAdResponse/MultipleAdResponse",
        "ad_configuration_transforms": [
        {
            "xpath": "/",
            "xslt": "&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:Det=\"http://Det.com\"&gt;&lt;xsl:output omit-xml-declaration=\"yes\"/&gt;&lt;xsl:template match=\"node()|@*\"&gt;&lt;xsl:copy&gt;&lt;xsl:apply-templates select=\"node()|@*\"/&gt;&lt;/xsl:copy&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;"
        }],
        "ad_configuration_url_format": "https://ad-provider-host.com/path/to/ad-handler?ip={{client.ipaddress}}&amp;num={{random.int32}}&amp;ses={{session.session_id}}"
    },
    "application_description": "Human readable description of the ad application",
    "account_id": <span class="bcls-input">"USER'S ACCOUNT ID" [Optional - When omitted, Account ID of requesting user is used]</span>
}</code></pre>
                <h4>Sample response</h4>
<pre class="line-numbers"><code class="language-json">{
  "application": {
    "account_id": "USER ACCOUNT ID",
    "application_description": "Human readable description of the ad application",
    "application_ad_configuration": {
      "ad_configuration_description": "Human readable description of the configuration",
      "ad_configuration_expected_response_type": "Dfp/Vast/SmartXML,
      "ad_configuration_strategy": "SingleAdResponse/MultipleAdResponse",
      "ad_configuration_transforms": [
        {
          "xpath": "/",
          "xslt": "&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:Det=\"http://Det.com\"&gt;&lt;xsl:output omit-xml-declaration=\"yes\"/&gt;&lt;xsl:template match=\"node()|@*\"&gt;&lt;xsl:copy&gt;&lt;xsl:apply-templates select=\"node()|@*\"/&gt;&lt;/xsl:copy&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;"
        }
      ],
      "ad_configuration_url_format": "https://ad-provider-host.com/path/to/ad-handler?ip={{client.ipaddress}}&amp;num={{random.int32}}&amp;ses={{session.session_id}}"
    },
    "application_id": <span class="bcle-highlight">"APPLICATION ID"</span>
  },
  "inserted": true
}</code></pre>
            </section>
            <section id="Update_an_ad_configuration" class="bcls-section">
                <h3>Update an ad configuration</h3>
                <p>Updating an ad configuration is very similar to creating one. Make a <code>PUT</code> request to:</p>
                <pre class="line-numbers"><code class="language-http">https://api.bcovlive.io/v1/ssai/application/<span class="bcle-input">APPLICATION_ID</span></code></pre>
                <h4>Sample request body</h4>
<pre class="line-numbers"><code class="language-json">{
    "application_ad_configuration": {
        "ad_configuration_description": "Some Updated Description Value",
        "ad_configuration_expected_response_type": "Dfp/Vast/SmartXML",
        "ad_configuration_strategy": "SingleAdResponse/MultipleAdResponse",
        "ad_configuration_transforms": [
        {
            "xpath": "/",
            "xslt": "&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:Det=\"http://Det.com\"&gt;&lt;xsl:output omit-xml-declaration=\"yes\"/&gt;&lt;xsl:template match=\"node()|@*\"&gt;&lt;xsl:copy&gt;&lt;xsl:apply-templates select=\"node()|@*\"/&gt;&lt;/xsl:copy&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;"
        }],
        "ad_configuration_url_format": "https://updated-ad-provider-host.com/path/to/ad-handler?ip={{client.ipaddress}}&amp;num={{random.int32}}&amp;ses={{session.session_id}}"
    },
    "application_description": "Human readable description of the ad application",
    "account_id": <span class="bcls-input">"USER'S ACCOUNT ID" [Optional - When omitted, Account ID of requesting user is used]</span>
}</code></pre>
                <h4>Sample response</h4>
<pre class="line-numbers">{
    "account_id": "USER ACCOUNT ID",
    "application_description": "Human readable description of the ad application",
    "application_ad_configuration": {
        "ad_configuration_description": "Some Updated Description Value",
        "ad_configuration_expected_response_type": "Dfp/Vast/SmartXML,
        "ad_configuration_strategy": "SingleAdResponse/MultipleAdResponse",
        "ad_configuration_transforms": [
        {
            "xpath": "/",
            "xslt": "&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:Det=\"http://Det.com\"&gt;&lt;xsl:output omit-xml-declaration=\"yes\"/&gt;&lt;xsl:template match=\"node()|@*\"&gt;&lt;xsl:copy&gt;&lt;xsl:apply-templates select=\"node()|@*\"/&gt;&lt;/xsl:copy&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;"
        }
        ],
        "ad_configuration_url_format": "https://updated-ad-provider-host.com/path/to/ad-handler?ip={{client.ipaddress}}&amp;num={{random.int32}}&amp;ses={{session.session_id}}"
    },
    "application_id": <span class="bcle-highlight">"APPLICATION ID"</span>
}<code class="language-json"></code></pre>
            </section>
            <section id="Get_all_ad_configurations" class="bcls-section">
                <h2>Get all ad configurations</h2>
                <p>To retrieve all the ad configurations for an account, submit a <code>GET</code> request to:</p>
                <pre class="line-numbers"><code class="language-http">https://api.bcovlive.io/v1/ssai/applications/<span class="bcle-input">ACCOUNT_ID</span></code></pre>
                <h3>Sample response</h3>
<pre class="line-numbers"><code class="language-json">[
  {
    "application_id": "APPLICATION_ID_1",
    "application_description": "DFP Single Midroll",
    "application_ad_configuration": {
      "ad_configuration_description": "DFP Test Config Single Midroll",
      "ad_configuration_strategy": "MultipleAdResponse",
      "ad_configuration_transforms": [],
      "ad_configuration_url_format": "https://ad-provider-host.com/path/to/ad-handler",
      "ad_configuration_expected_response_type": "Dfp"
    },
    "account_id": "ACCOUNT_ID"
  },
  {
    "application_id": "APPLICATION_ID_2",
    "application_description": "Test DFP Single Midroll"
    "application_ad_configuration": {
      "ad_configuration_description": "DFP Test Config Single Midroll",
      "ad_configuration_strategy": "MultipleAdResponse",
      "ad_configuration_transforms": [
        {
          "xslt": "&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:Det=\"http://Det.com\"&gt;&lt;xsl:output omit-xml-declaration=\"yes\"/&gt;&lt;xsl:template match=\"node()|@*\"&gt;&lt;xsl:copy&gt;&lt;xsl:apply-templates select=\"node()|@*\"/&gt;&lt;/xsl:copy&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;",
          "xpath": "/"
        }
      ],
      "ad_configuration_url_format": "https://ad-provider-host.com/path/to/ad-handler?ip={{client.ipaddress}}&amp;num={{random.int32}}&amp;ses={{session.session_id}}",
      "ad_configuration_expected_response_type": "Dfp"
    },
    "account_id": "ACCOUNT_ID"
  }
]</code></pre>
            </section>
            <section id="Get_an_ad_configuration" class="bcls-section">
                <h2>Get an ad configuration</h2>
                <p>You can also retrieve a specific ad configuration by its <code>application_id</code> by sending <code>GET</code> request to:</p>
                <pre class="line-numbers"><code class="language-http"></code></pre>
            </section>
            <section id="Cuepoints" class="bcls-section">
                <h2>Cuepoints</h2>
                <p>Ad breaks are triggered by cuepoints, which can be specified in two ways:</p>
                <ul>
                    <li>Sent to Brightcove by the encoder</li>
                    <li>Immediate cuepoints created via the Live API</li>
                </ul>
                <h3>From the encoder</h3>
                <p>The Brightcove live delivery system can interpret cuepoints submitted by the encoder in the AMF format:</p>
<pre class="line-numbers"><code class="language-bash">AMFDataList
    [0]:onCuePoint
    [1]:{Obj[]:
        time: 1.9889, //Difference from PTS of THIS packet to the first PTS of the 1st video frame in the adbreak
        name: "scte35",
        type: "event",
        parameters: {Obj[]:
            type: "avail_in",
            duration: 12.0}
        }</code></pre>
                <h3>Manual insertion</h3>
                <p></p>
            </section>
            <section id="Managing slates" class="bcls-section">
                <h2>Managing slates</h2>
                <p>You can also create immediate cuepoints using the Live API by sending a <code>POST</code> request to:</p>
                <pre class="line-numbers"><code class="language-http">https://api.bcovlive.io/v1/jobs/:jobId/cuepoint</code></pre>
                <p>Include a request body specifying the duration of the break:</p>
                <pre class="line-numbers"><code class="language-json">{
   "duration":30
}</code></pre>
            </section>
            <!-- end drupal content -->
        </div>
    </div>
    <!-- bcl scripts -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.4/gist-embed.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
<script src="/en/scripts/docs-nav-data.min.js"></script>
<script src="/en/scripts/bcls-doc-site-v2.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
<script>
    $(document).foundation();
</script>
<div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="bcls-footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>
</html>
