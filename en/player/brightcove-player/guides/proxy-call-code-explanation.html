<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Begin Drupal Taxonomy Data -->
  <meta name="products" content="Video Cloud">
  <meta name="role" content="Player Developer">
  <meta name="task" content="">
  <meta name="topic" content="">
  <!-- End Drupal Taxonomy Data -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
  <!-- change title to match the h1 heading -->
  <title>Learning Guide: Using the REST APIs</title>
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <script src="//use.edgefonts.net/source-code-pro.js"></script>
  <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
  <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
  <link rel="stylesheet" href="/en/styles/foundation-fixes.css">
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-2728311-29', 'auto');
    ga('send', 'pageview');
  </script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
  <!-- header navbar -->
  <div id="navWrapper" class="fixed"></div>
  <!-- breadcrumbs -->
  <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
  <div class="row">
    <div class="sidebar large-2 columns show-for-large-up">
      <div id="sidenav" class="side-nav"></div>
    </div>
    <div id="main" class="large-10 small-12 columns">
      <h1>Learning Guide: Using the REST APIs</h1>

      <!-- begin drupal content -->
      <article class="bcls-article">
        <header id="bcls_header" class="bcls-header">
          <p>In this topic, you will first get a high level overview of using the REST APIs. Then later in the document a deeper dive will discuss example code. The first example uses the Analytics API to retrieve and display in the player's controlbar the number of views the video currently in the player has had. The second, and slightly more complex, example uses the CMS API to retrieve the most popular videos from an account and show them in a playlist. The code discussion in this document will center on retrieving the desired data from the correct REST API.</p>
        </header>

        <section id="High_level_view" class="bcls-section">
          <h2>High level view</h2>
          <p>To use the REST APIs you need to have a few pieces in place. Briefly, they are:</p>
          <ul>
            <li><strong>Client code</strong>: The client code asks for specific data then displays it according to application requirements. The client code will be discussed at some length in this document as it is what you will need to be writing most frequently.</li>
            <li><strong>Proxy server</strong>: For security reasons the REST APIs will not accept data requests directly from the client as that would encourage sending confidential information, like as access token, from the client. This means that a proxy will act as an intermediary between the client and the REST API. The proxy used in the examples are written in PHP and detailed in the <a href="#">GET THIS</a> document.</li>
            <li><strong>REST APIs</strong>: Brightcove supplies a comprehensive set of APIs to customize, extend, and integrate with the Brightcove platform. See the <a href="http://docs.brightcove.com/en/video-cloud/concepts/api-overview/api-overview.html">Overview: Video Cloud APIs</a> document for more information.</li>
          </ul>
          <p>The following diagram shows the interaction between the three core entities of the process to retrieve data from one of Brightcove's REST APIs:</p>
          <figure class="bcls-figure">
              <img class="bcls-image" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/client-proxy-api.png" alt="Basic Pieces Overview">
          </figure>
        </section>

        <section id="Client_functionality_overview" class="bcls-section">
          <h2>Client functionality overview</h2>
          <p></p>
          <figure class="bcls-figure">
              <img class="bcls-image" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/proxy-API-call.png" alt="Client functionality overview">
          </figure>
        </section>

        <section id="Example_1_code_walkthough" class="bcls-section">
          <h2>Example 1 code walkthough</h2>
          <p>Rather than looking at the code as one piece, it will be presented and discussed in sections. Some of the sections will relate to the diagram in the section above.</p>
          <pre class="line-numbers"><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;title&gt;Untitled Document&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;video id=&quot;myPlayerID&quot;
    data-video-id=&quot;3851380732001&quot;
    data-account=&quot;1752604059001&quot;
    data-player=&quot;HkAzSmB0l&quot;
    data-embed=&quot;default&quot;
    data-application-id
    class=&quot;video-js&quot;
    controls
    width=&quot;640&quot;
    height=&quot;360&quot;&gt;&lt;/video&gt;
  &lt;script src=&quot;//players.brightcove.net/1752604059001/HkAzSmB0l_default/index.min.js&quot;&gt;&lt;/script&gt;

  &lt;script type=&quot;text/javascript&quot;&gt;
    var myPlayer,
      viewsCount,
      viewsObject = [];

    videojs('myPlayerID').ready(function() {
      myPlayer = this,
      options = [],
      options.requestType = 'GET',
      options.proxyURL = 'http://solutions.brightcove.com/bcls/bcls-proxy/doc-samples-proxy.php',
      options.requestBody = '';
      // Wait for loadstart event so mediainfo is populated
      // and the video ID and account ID can be retrieved
      myPlayer.on('loadstart', function() {
        var videoID = myPlayer.mediainfo.id,
          accountID = myPlayer.mediainfo.accountId;
        // Build the Analytics API endpoint
        options.url = 'https://analytics.api.brightcove.com/v1/alltime/accounts/' + accountID + '/videos/' + videoID;
        // Make the request to the Analytics API
        // Extract views from data returned by Analytics API
        makeRequest(options, function(viewsRaw) {
          // Remove console.log command for production code
          console.log('viewsRaw', viewsRaw);
          viewsObject = JSON.parse(viewsRaw);
          console.log('viewsObject', viewsObject);
          viewsCount = viewsObject.alltime_video_views;
          console.log('views', viewsCount);
          // Call function to place data in controlbar
          //placeCountInControlbar();
        });
      });
    });

    /**
     * Dynamically built a div that is then
     * placed in the controlbar's spacer element
     */
    function placeCountInControlbar() {
      var spacer,
        newElement = document.createElement('div');
      //Place data in div
      newElement.innerHTML = &quot;Total Views: &quot; + viewsCount;
      //Get the spacer in the controlbar
      spacer = document.getElementsByClassName('vjs-spacer')[0];
      //Right justify content in the spacer and add top margin
      spacer.setAttribute('style', 'justify-content: flex-end; margin-top: 10px');
      //Add the dynacmially built div to the spacer in the controlbar
      spacer.appendChild(newElement);
    }

    /**
     * send API request to the proxy
     * @param  {Object} options for the request
     * @param  {String} options.url the full API request URL
     * @param  {String=&quot;GET&quot;,&quot;POST&quot;,&quot;PATCH&quot;,&quot;PUT&quot;,&quot;DELETE&quot;} requestData [options.requestType=&quot;GET&quot;] HTTP type for the request
     * @param  {String} options.proxyURL proxyURL to send the request to
     * @param  {String} options.client_id client id for the account (default is in the proxy)
     * @param  {String} options.client_secret client secret for the account (default is in the proxy)
     * @param  {JSON} [options.requestBody] Data to be sent in the request body in the form of a JSON string
     * @param  {Function} [callback] callback function that will process the response
     */
    function makeRequest(options, callback) {
      var httpRequest = new XMLHttpRequest(),
        response,
        requestParams,
        dataString,
        proxyURL = options.proxyURL,
        /**
         * set up request data
         * the proxy used here takes the following params:
         * url - the full API request (required)
         * requestType - the HTTP request type (default: GET)
         * clientId - the client id (defaults here to a Brightcove sample account value - this should always be stored on the server side if possible)
         * clientSecret - the client secret (defaults here to a Brightcove sample account value - this should always be stored on the server side if possible)
         * requestData - request body for write requests (optional JSON string)
         */
        requestParams = &quot;url=&quot; + encodeURIComponent(options.url) + &quot;&amp;requestType=&quot; + options.requestType;
      // only add client id and secret if both were submitted
      if (options.client_id &amp;&amp; options.client_secret) {
        requestParams += '&amp;client_id=' + options.client_id + '&amp;client_secret=' + options.client_secret;
      }
      // add request data if any
      if (options.requestData) {
        requestParams += '&amp;requestBody=' + options.requestBody;
      }
      console.log('requestParams', requestParams);
      // set response handler
      httpRequest.onreadystatechange = getResponse;
      // open the request
      httpRequest.open('POST', proxyURL);
      // set headers
      httpRequest.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
      // open and send request
      httpRequest.send(requestParams);

      // response handler
      function getResponse() {
        try {
          if (httpRequest.readyState === 4) {
            if (httpRequest.status === 200 || httpRequest.status === 204) {
              response = httpRequest.responseText;
              // some API requests return '{null}' for empty responses - breaks JSON.parse
              if (response === '{null}') {
                response = null;
              }
              // return the response
              callback(response);
            } else {
              alert('There was a problem with the request. Request returned ' + httpRequest.status);
            }
          }
        } catch (e) {
          alert('Caught Exception: ' + e);
        }
      };
    }
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;&lt;/code&gt;</pre>
        </section>

        <section id="section-name1" class="bcls-section">
          <h2>section-title</h2>
          <ol>
            <li>Build the request</li>
            <li>Make the request, pass two arguments
              <ul>
                <li>Argument 1: The request information </li>
                <li>Pass the callback function, the argument of the callback function will contain desired data returned by the API call</li>
                <li>Process the returned, raw JSON data</li>
                <li>Display processed information as desired</li>
              </ul>
            </li>
            <li></li>
            <li></li>
            <li>url=https://analytics.api.brightcove.com/v1/alltime/accounts/1752604059001/videos/3851380732001&requestType=GET</li>
          </ol>


          <table class="standard-table">
           <tbody>
            <tr>
             <td class="header">Value</td>
             <td class="header">State</td>
             <td class="header">Description</td>
            </tr>
            <tr>
             <td><code>0</code></td>
             <td><code>UNSENT</code></td>
             <td>Client has been created. <code>open()</code> not called yet.</td>
            </tr>
            <tr>
             <td><code>1</code></td>
             <td><code>OPENED</code></td>
             <td><code>open()</code> has been called.</td>
            </tr>
            <tr>
             <td><code>2</code></td>
             <td><code>HEADERS_RECEIVED</code></td>
             <td><code>send()</code> has been called, and headers and status are available.</td>
            </tr>
            <tr>
             <td><code>3</code></td>
             <td><code>LOADING</code></td>
             <td>Downloading; <code>responseText</code> holds partial data.</td>
            </tr>
            <tr>
             <td><code>4</code></td>
             <td><code>DONE</code></td>
             <td>The operation is complete.</td>
            </tr>
           </tbody>
          </table>


          <p></p>
        </section>

        <section id="section-name2" class="bcls-section">
          <h2>section-title</h2>
          <p></p>
        </section>

        <section id="section-name3" class="bcls-section">
          <h2>section-title</h2>
          <p></p>
        </section>

        <section id="section-name4" class="bcls-section">
          <h2>section-title</h2>
          <p></p>
        </section>

      </article>
      <!-- end drupal content -->

      <div class="bcls-section" id="BCLreferences">
        <h2>Related Topics</h2>
        <ul>
          <li><a href="../guides/1x-5x-skins.html">Skins and Player Versions</a>
          </li>
        </ul>
      </div>

    </div>
  </div>
  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.4/gist-embed.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v2.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
    $(document).foundation();
  </script>
  <div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
  </div>
  <div class="bcls-footer"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a>
  </div>
  <script>
    var feedbackMail = document.getElementById("feedbackMail");
    feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
  </script>
</body>

</html>
