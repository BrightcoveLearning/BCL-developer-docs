<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Begin Drupal Taxonomy Data -->
  <meta name="products" content="Video Cloud, Brightcove Player">
  <meta name="role" content="Device SDK Developer">
  <meta name="task" content="Develop with the Native SDKs">
  <meta name="topic" content="Troubleshooting/Error Handling">
  <meta name="sdk" content="iOS,tvOS,Android">
  <meta name="keywords" content="device,SDK,FAQ">
  <!-- End Drupal Taxonomy Data -->

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
  <meta name="robots" content="noindex">
  <!-- change title to match the h1 heading -->
  <title>Advertising with the SSAI Plugin</title>

  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <script src="//use.edgefonts.net/source-code-pro.js"></script>
  <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
  <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
  <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
  <!-- header navbar -->
  <div id="navWrapper" class="fixed"></div>
  <!-- breadcrumbs -->
  <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
  <div class="row">
    <div class="sidebar large-2 columns show-for-large-up">
      <div id="sidenav" class="side-nav"></div>
    </div>
    <div id="main" class="large-10 small-12 columns">
      <h1>Doc Title</h1>

      <!-- BEGIN DRUPAL CONTENT -->

      <article class="bcls-article">
          <h3>Sample: Passing video ID on URL page request for iframe</h3>

          <p>JavaScript code needs to be used on the HTML page that contains the iframe player code, and JavaScript is also used to build a custom plugin. You will first see an functioning example, then the code used is briefly described.</p>

          <p>The link below is an example of the code at work. Note that in the link a parameter is passed to the URL page request. You will see the second video in the playlist is played first, then the playlist continues to play.</p>

          <p><a href="https://solutions.brightcove.com/bcls/brightcove-player/control-first-video/iframe-playlist-control-frist-video.html?playlistVideoId=5387609370001">https://solutions.brightcove.com/bcls/brightcove-player/control-first-video/iframe-playlist-control-frist-video.html?playlistVideoId=5387609370001</a></p>

          <aside class="bcls-aside bcls-aside--tip">The parameter name used is the same as the one used for the built-in functionality, but need not be so. The code on the HTML page would need to be adjusted if you wish to use a different parameter name.</aside>

          <h4>Code on HTML page</h4>

          <p>The key concept for understanding this code is that a value is passed to the iframe using JavaScript's <code>postMessage()</code> method. (For a thorough discussion of this method see the <a href="/node/18192">Brightcove Player Sample: Play/Pause Video from iframe Parent</a>            document.)</p>

          <pre class="line-numbers">
      <code class="language-javascript">&lt;!doctype html&gt;
      &lt;html&gt;

      &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;Untitled Document&lt;/title&gt;
        &lt;style&gt;
        iframe {
          height: 344px;
          width: 610px;
        }
      &lt;/style&gt;

      &lt;/head&gt;

      &lt;body&gt;

        &lt;iframe src="//players.brightcove.net/1752604059001/H1HpIEcCb_default/index.html?playlistId=5541484620001"
          allowfullscreen
          webkitallowfullscreen
          mozallowfullscreen&gt;&lt;/iframe&gt;

        &lt;script type="text/javascript"&gt;
        <span class="bcls-highlight">// Match the protocol of the of the parent's page
        var theParamValue,
          theProtocol = location.protocol,
          theURL = theProtocol + "//players.brightcove.net",
          // Get a reference to the iframe element
          iframeTag = document.querySelector("iframe"),
          // Retrieve window object needed for postMessage
          win = iframeTag.contentWindow;

        // Use the helper function below to get the value of the parameter
        theParamValue = getURLparam("playlistVideoId");

        // When the iframe is loaded, use JavaScript's postMessage method to pass it the desired video's ID
        iframeTag.addEventListener("load", function() {
          win.postMessage(theParamValue, theURL);
        });

        // Helper function to get value for a specific URL parameter
        function getURLparam(name) {
          var regex, results;
          name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
          regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)");
          results = regex.exec(location.search);
          return results === null
            ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
        }</span>
        &lt;/script&gt;

      &lt;/body&gt;

      &lt;/html&gt;</code></pre>

          <p>Details of the code follow, based on comment:</p>

          <ul>
            <li><strong>// Match the protocol of the of the parent's page</strong>: The <code>postMessage()</code> method requires both context of where the <code>iframe</code> tag is located, as well as where the iframe content's are from (the latter for
              security reasons), and both are determined in this section of the code.</li>
            <li><strong>// Use the helper function below to get the value of the parameter</strong>: Call's the helper function to read the value of the URL parameter passed to the function. In this case it is getting the ID of the video passed on the URL.</li>
            <li><strong>// When the iframe is loaded, use JavaScript's postMessage method to pass it the desired video's ID</strong>: This is the call to the <code>postMessage()</code> method. Note that you need to wait for the iframe tag to be completely
              loaded before calling the function, hence the use of using the event handler for JavaScript's <code>load</code> event.</li>
            <li><strong>// Helper function to get value for a specific URL parameter</strong>: This is a JavaScript function that reads the URL, then grabs the value associated with a particular query parameter.</li>
          </ul>

          <p>The player you use must have a plugin associated with it. You would use the code that follows, save it in an Internet accessible location, then in the <strong>PLAYERS</strong> &gt; <strong>PLUGINS</strong> section associate the plugin with the
            player. The name of the plugin used in the code is <strong>controlFirstVideo</strong>, and would be entered as follows:</p>

          <figure class="bcls-figure"><img class="bcls-image" alt="Entering plugin name" src="//learning-services-media.brightcove.com/doc-assets/player-development/playlists/iframe-control-fisrt-video-played/plugin-name.png" /></figure>

          <p>Here is the plugin code:</p>

          <pre class="line-numbers">
      <code class="language-javascript">videojs.registerPlugin('controlFirstVideo', function() {
        var myPlayer = this,
          passedVideoID;

        // This method called when postMessage sends data into the iframe
        function playVideo(evt){
          var videoIndex;
          // Retrieve data stored in the object passed via postMessage
          passedVideoID = evt.data;
          // Retrieve desired video object using Video Cloud catalog
          myPlayer.catalog.getVideo(passedVideoID, function(error, video){
            //deal with error
            // Use the Playlist API to find location of the video in the playlist, then load into the player and play it
            videoIndex = myPlayer.playlist.indexOf(video);
            myPlayer.playlist.currentItem(videoIndex);
            myPlayer.play();
          });
        };
        // Listen for the message, then call playVideo() method when received
        window.addEventListener("message",playVideo);
      });</code></pre>

          <p>Details of the code follow, based on comment:</p>

          <ul>
            <li><strong>// Listen for the message, then call playVideo() method when received</strong> (bottom of code): This event listener waits for <code>postMessage</code> to send data. The event with <code>postMessage</code> is always <code>message</code>.
              When the event is received the <code>playVideo()</code> method is called.</li>
            <li><strong>// Retrieve data stored in the object passed via postMessage</strong>: The data passed via <code>postMessage</code> is part of the event object, and the video ID is extracted for use.</li>
            <li><strong>// Retrieve desired video object using Video Cloud catalog</strong>: You need the actual video object to use with the Playlist API, so the Video Cloud catalog is used to retrieve the video object based on its ID.</li>
            <li><strong>// Use the Playlist API to find location of the video in the playlist, then load into the player and play it</strong>: First the Playlist API's <code>indexOf()</code> method is used to find the location of the desired video in the
              playlist. You then use the and the Playlist API's <code>currentItem()</code> method to load that video into the player. Finally, play the video.</li>
          </ul>

          <aside class="bcls-aside bcls-aside--information">For details on the Playlist API see the <a href="/node/18099">Guide: Playlist API</a> document.</aside>

          <p>Since it is likely you will not be playing the first video in the playlist, the following settings for the player make sense to set:</p>

          <figure class="bcls-figure"><img class="bcls-image" alt="Player settings" src="//learning-services-media.brightcove.com/doc-assets/player-development/playlists/iframe-control-fisrt-video-played/player-settings.png" /></figure>
        </section>



      </article>
      <script src="//players.brightcove.net/1752604059001/f50a2d3c-af51-4d8c-84e3-0c7cdec0edbe_default/index.min.js"></script>

      <!-- END DRUPAL CONTENT -->
    </div>
  </div>

  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
    $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
</body>

</html>
