<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Advertising with the SSAI Plugin</title>
</head>

<body>
      <h1>Doc Title</h1>
<p>Enter values for the two form fields below to see header bidding in action using your player and video. (If you choose not to input your data, demo data is supplied.) The sample uses the AppNexus header bidding functionality.</p>
<p>Below the player, the code for the player implementation is shown so you can copy and use.</p>
      <!-- BEGIN DRUPAL CONTENT -->



<style type="text/css">
  .video-js {
    width: 640px;
    height: 360px;
  }
  .bcls-code {
    color: #111;
    font-family: 'Source Code Pro', monospace;
    padding: 1em;
    width: 90%;
    min-height: 5em;
    background-color: #cfcfcf;
    font-size: 1rem;
  }
  .bcls-button {
    padding: .5em;
    background-color: #64AAB2;
    border: 1px black solid;
    border-radius: .5em;
    color: black;
    cursor: pointer;
  }
  fieldset {
    color: #64AAB2;
    border: 1px #64AAB2 solid;
    border-radius: .5em;
    /* width: 640px;
           height: 480px; */
  }
  code {
    color: #E4B842;
    font-family: 'Source Code Pro', monospace;
  }
</style>
<link href="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.css" rel="stylesheet" />

<div id="inputFields" class="input-fields">
    <h3>Account Information</h3>
    <div id="accountInfo">
      <table class="bcls-table">
        <tbody class="bcls-table__body">
          <tr>
            <td>Video Cloud Account ID:</td>
            <td>
              <input id="accountID" type="text" size="60" value="1507807800001" />
            </td>
          </tr>
          <tr>
            <td>Video ID:</td>
            <td>
              <input id="videoID" type="text" size="60" value="5622718636001" />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
<p>
  <button id="buildPlayer" class="bcls-button" onclick="addPlayer()">Build the Player</button>
</p>

  <h3>Player</h3>
  <div class="bcls-fieldset" style="width: 640px;height: 360px;">
    <div id="placeHolder" style="width: 640px;height: 360px;background-color: #cfcfcf;">&nbsp;</div>
  </div>

<h3>Publishing Code</h3>
<p><button id="copyCode" class="bcls-button" onclick="copyCode()">Copy Code to Clipboard</button></p>
  <div class="bcls-fieldset">
    <textarea id="publishingCode" class="bcls-code" style="width: 100%;height: 420px" onclick="this.select()"></textarea>
  </div>
<!-- custom script -->
<script type="text/JavaScript">
  var myPlayer,
    playerHTML,
    playerScript,
    publishingCode = document.getElementById('publishingCode'),
    accountID = document.getElementById('accountID'),
    videoID = document.getElementById('videoID'),
    configOptions = {};
  //  Build the player and place in HTML DOM
  function addPlayer() {
    configOptions.accountID = accountID.value;
    configOptions.videoID = videoID.value;
    console.log('configOptions', configOptions);
    // Dynamically build the player video element
    playerHTML = '<video id=\"myPlayerID\" data-video-id=\"' + configOptions.videoID + '\"  data-account=\"' + configOptions.accountID + '\" data-player=\"default\" data-embed=\"default\" class=\"video-js\" controls></video>';
    // Inject the player code into the DOM
    document.getElementById('placeHolder').innerHTML = playerHTML;
    // Add and execute the player script tag
    playerScript = document.createElement('script');
    playerScript.src = "//players.brightcove.net/" + configOptions.accountID + "/default_default/index.min.js";
    document.body.appendChild(playerScript);
    playerScript.onload = loadPrebid;
  }

    function loadPrebid() {
      ima = document.createElement('script');
      ima.src = '//acdn.adnxs.com/prebid/not-for-prod/1/prebid.js';
      document.head.appendChild(ima);
      ima.onload = loadIMA;
    }

    function loadIMA() {
      ima = document.createElement('script');
      ima.src = '//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.js';
      document.head.appendChild(ima);
      ima.onload = headerBidding;
    }

  function headerBidding() {
    console.log('**********in header bidding');
    //FROM HEADER BIDDING CODE
    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];
    iosDevice = !! navigator.platform.match(/iPhone|iPod|iPad/);
    var getServerUrl = function (callback) {
      var videoAdUnit = {
        code: 'video1',
        mediaTypes: {
          video: {
            playerSize: [640, 480],
            context: 'instream'
          }
        },
        bids: [{
          bidder: 'appnexus',
          params: {
            placementId: iosDevice ? 13239390 : 13232361,
            video: {
              skipppable: true,
              playback_method: ['auto_play_sound_off']
            }
          }
        }]
      };
      pbjs.que.push(function () {
        pbjs.addAdUnits(videoAdUnit);
        pbjs.setConfig({
          debug: true,
          cache: {
            url: 'https://prebid.adnxs.com/pbc/v1/cache'
          }
        });
        pbjs.requestBids({
          bidsBackHandler: function (bids) {
            var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
              adUnit: videoAdUnit,
              params: {
                iu: '/19968336/prebid_cache_video_adunit',
                cust_params: {
                  section: 'blog',
                  anotherKey: 'anotherValue'
                },
                output: 'vast'
              }
            });
            callback(videoUrl);
          }
        });
      });
    };
    console.log('**********calling IMA3 plugin next');
    bc("myPlayerID").ima3({
      serverUrl: getServerUrl,
      debug: true,
      timeout: 5000,
      ima3SdkSettings: {
        "disableCustomPlaybackForIOS10Plus": true
      }
    });
    videojs("myPlayerID").ready(function () {
          console.log('**********in player ready');
      var myPlayer = this;
      myPlayer.on("ima3error", function () {
        console.log("There was an ima3 error.");
      });
    });
  }
</script>
</body>

</html>
