<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Begin Drupal Taxonomy Data -->
  <meta name="products" content="Video Cloud, Brightcove Player">
  <meta name="role" content="Device SDK Developer">
  <meta name="task" content="Develop with the Native SDKs">
  <meta name="topic" content="Troubleshooting/Error Handling">
  <meta name="sdk" content="iOS,tvOS,Android">
  <meta name="keywords" content="device,SDK,FAQ">
  <!-- End Drupal Taxonomy Data -->

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
  <meta name="robots" content="noindex">
  <!-- change title to match the h1 heading -->
  <title>Advertising with the SSAI Plugin</title>

  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <script src="//use.edgefonts.net/source-code-pro.js"></script>
  <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
  <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
  <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
  <!-- header navbar -->
  <div id="navWrapper" class="fixed"></div>
  <!-- breadcrumbs -->
  <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
  <div class="row">
    <div class="sidebar large-2 columns show-for-large-up">
      <div id="sidenav" class="side-nav"></div>
    </div>
    <div id="main" class="large-10 small-12 columns">
      <h1>Doc Title</h1>

      <!-- BEGIN DRUPAL CONTENT -->

<script async src="//acdn.adnxs.com/prebid/not-for-prod/1/prebid.js">
</script>
<style type="text/css">.video-js {
  width: 640px;
  height: 360px;
  }
  .bcls-code {
    color: #111;
    font-family: 'Source Code Pro', monospace;
    padding: 1em;
    width: 90%;
    min-height: 5em;
    background-color: #cfcfcf;
    font-size: 1rem;
  }
  .bcls-button {
    padding: .5em;
    background-color: #64AAB2;
    border: 1px black solid;
    border-radius: .5em;
    color: black;
    cursor: pointer;
  }
  fieldset {
    color: #64AAB2;
    border: 1px #64AAB2 solid;
    border-radius: .5em;
  }
  code {
    color: #E4B842;
    font-family: 'Source Code Pro', monospace;
  }
</style>
<link href="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.css" rel="stylesheet" />
<div id="inputFields" class="input-fields">
  <h3>Account Information
  </h3>
  <div id="accountInfo">
    <table class="bcls-table">
      <tbody class="bcls-table__body">
        <tr>
          <td>Video Cloud Account ID:
          </td>
          <td>
            <input id="accountID" type="text" size="60" value="1507807800001" />
          </td>
        </tr>
        <tr>
          <td>Video ID:
          </td>
          <td>
            <input id="videoID" type="text" size="60" value="5622718636001" />
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<p>
  <button id="buildPlayer" class="bcls-button" onclick="addPlayer()">Build the Player
  </button>
</p>
<h3>Player
</h3>
<div style="width: 640px;height: 360px;">
  <div id="placeHolder" style="width: 640px;height: 360px;background-color: #cfcfcf;">&nbsp;
  </div>
</div>
<h3>Publishing Code
</h3>
<p>
  <button id="copyCode" class="bcls-button" onclick="copyCode()">Copy Code to Clipboard
  </button>
</p>
<div><textarea id="publishingCode" class="bcls-code" style="width: 100%;height: 420px" onclick="this.select()"></textarea>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify-css.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.7.5/beautify-html.min.js"></script><!-- custom script --><script type="text/JavaScript">
  var myPlayer,
      playerHTML,
      displayPlayerHTML,
      playerScript,
      publishingCode = document.getElementById('publishingCode'),
      accountID = document.getElementById('accountID'),
      videoID = document.getElementById('videoID'),
      configOptions = {};
  var pbjs = pbjs || {};
  pbjs.que = pbjs.que || [];
  iosDevice = !! navigator.platform.match(/iPhone|iPod|iPad/);
  //  Build the player and place in HTML DOM
  function addPlayer() {
    configOptions.accountID = accountID.value;
    configOptions.videoID = videoID.value;
    console.log('configOptions', configOptions);
    // Dynamically build the player video element, but only partially so it does not instantiate
    playerHTML = '<video id=\"myPlayerID\" data-embed=\"default\" class=\"video-js\" controls></video>';
    // Inject the player code into the DOM
    document.getElementById('placeHolder').innerHTML = playerHTML;
    // Add and execute the player script tag
    playerScript = document.createElement('script');
    playerScript.src = "//players.brightcove.net/" + configOptions.accountID + "/default_default/index.min.js";
    document.body.appendChild(playerScript);
    playerScript.onload = loadIMA;
  }
  function loadIMA() {
    ima = document.createElement('script');
    ima.src = '//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.js';
    document.head.appendChild(ima);
    ima.onload = headerBidding;
  }
  function headerBidding() {
    // Instantiate player and immediately after call ima3 method
    myPlayerID.setAttribute('data-account', configOptions.accountID);
    myPlayerID.setAttribute('data-player', 'default');
    myPlayerID.setAttribute('data-video-id', configOptions.videoID);
    myPlayer = bc(document.getElementById("myPlayerID"));
    console.log('**********calling IMA3 plugin next');
    myPlayer.ima3({
      serverUrl: getServerUrl,
      debug: true,
      timeout: 5000,
      ima3SdkSettings: {
        "disableCustomPlaybackForIOS10Plus": true
      }
    });
    //FROM HEADER BIDDING CODE
    function getServerUrl(callback) {
      var videoAdUnit = {
        code: 'video1',
        mediaTypes: {
          video: {
            playerSize: [640, 480],
            context: 'instream'
          }
        },
        bids: [{
          bidder: 'appnexus',
          params: {
            placementId: iosDevice ? 13239390 : 13232361,
            video: {
              skipppable: true,
              playback_method: ['auto_play_sound_off']
            }
          }
        }]
      };
      pbjs.que.push(function () {
        pbjs.addAdUnits(videoAdUnit);
        pbjs.setConfig({
          debug: true,
          cache: {
            url: 'https://prebid.adnxs.com/pbc/v1/cache'
          }
        });
        pbjs.requestBids({
          bidsBackHandler: function (bids) {
            var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
              adUnit: videoAdUnit,
              params: {
                iu: '/19968336/prebid_cache_video_adunit',
                cust_params: {
                  section: 'blog',
                  anotherKey: 'anotherValue'
                },
                output: 'vast'
              }
            });
            callback(videoUrl);
          }
        });
      });
    };
    myPlayer.ready(function () {
      console.log('**********in player ready');
      myPlayer.on("ima3error", function () {
        console.log("There was an ima3 error.");
      });
    });
    buildHTML();
  }
  function buildHTML() {
    var htmlText1,
        htmlText2,
        jsText,
        allFormattedCode;
    htmlText1 = '<!DOCTYPE html> <html> <head> <meta charset="UTF-8"> <title>Prebid Video -- Brightcove Player</title> <script async src="//acdn.adnxs.com/prebid/not-for-prod/1/prebid.js">\</script\> <link href="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.css" rel="stylesheet"> \n </head> <body> <h1>Prebid Video -- Brightcove Player</h1> \n';
    displayPlayerHTML = '<video id="myPlayerID" data-account="' + configOptions.accountID + '" data-player="default" data-video-id="' + configOptions.videoID + '" data-embed="default" data-application-id class="video-js" playsinline controls width="640" height="480"></video>';
    htmlText1 += displayPlayerHTML;
    htmlText1 += playerScript.outerHTML;
    htmlText1 += '<script src="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.js">\</script\>';
    htmlText1 += '<script type="text/javascript">';
    jsText = ' var pbjs = pbjs || {}; pbjs.que = pbjs.que || []; iosDevice = !! navigator.platform.match(/iPhone|iPod|iPad/); function getServerUrl(callback) { var videoAdUnit = { code: "video1", mediaTypes: { video: { playerSize: [640, 480], context: "instream" } }, bids: [{ bidder: "appnexus", params: { placementId: iosDevice ? 13239390 : 13232361, video: { skipppable: true, playback_method: ["auto_play_sound_off"] } } }] }; pbjs.que.push(function () { pbjs.addAdUnits(videoAdUnit); pbjs.setConfig({ debug: true, cache: { url: "https://prebid.adnxs.com/pbc/v1/cache" } }); pbjs.requestBids({ bidsBackHandler: function (bids) { var videoUrl = pbjs.adServers.dfp.buildVideoUrl({ adUnit: videoAdUnit, params: { iu: "/19968336/prebid_cache_video_adunit", cust_params: { section: "blog", anotherKey: "anotherValue" }, output: "vast" } }); callback(videoUrl); } }); }); }; bc("myPlayerID").ima3({ serverUrl: getServerUrl, debug: true, timeout: 5000, ima3SdkSettings: { "disableCustomPlaybackForIOS10Plus": true } }); var myPlayer = videojs.getPlayer("myPlayerID"); myPlayer.ready(function() { myPlayer.on("ima3error", function () { console.log("There was an ima3 error."); }); });';
    htmlText2 =  '\</script\> <script src="https://learning-services-media.brightcove.com/doc-assets/js/https-fix.js"></script>
<script src="https://learning-services-media.brightcove.com/doc-assets/js/support-feedback.js"></script><script src="https://learning-services-media.brightcove.com/doc-assets/site-assets/js/site/feedback-docs.js"></script>
</body> </html>';
    htmlText1 = html_beautify(htmlText1, { "indent_size": 2 });
    jsText =  js_beautify(jsText, { "indent_size": 2, "indent_level": 10 });
    htmlText2 = html_beautify(htmlText2, { "indent_size": 2 });
    allFormattedCode = htmlText1 + '\n' + jsText + '\n' + htmlText2;
    publishingCode.textContent = allFormattedCode;
  }
  function copyCode() {
    publishingCode.select();
    document.execCommand('copy');
  }
</script>

      <!-- END DRUPAL CONTENT -->
    </div>
  </div>

  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
    $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
<script src="https://learning-services-media.brightcove.com/doc-assets/js/https-fix.js"></script>
<script src="https://learning-services-media.brightcove.com/doc-assets/js/support-feedback.js"></script><script src="https://learning-services-media.brightcove.com/doc-assets/site-assets/js/site/feedback-docs.js"></script>
</body>

</html>
