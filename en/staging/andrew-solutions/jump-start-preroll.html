<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Load Player Dynamically</title>
  <style>
    .video-js {
      width: 640px;
      height: 360px;
    }
    body {
      background-color: #111;
      color: #f5f5f5;
      font-family: sans-serif;
      margin: 2em;
    }
    .bcls-code {
      color: #111;
      font-family: 'Source Code Pro',monospace;
      padding: 1em;
      width: 90%;
      min-height: 5em;
      background-color: #cfcfcf;
      font-size: 1rem;
    }
    .bcls-button {
      padding: .5em;
      background-color: #333;
      border: 1px yellow solid;
      border-radius: .5em;
      color: yellow;
      cursor: pointer;
    }
    fieldset {
      color: #64AAB2;
      border: 1px #64AAB2 solid;
      border-radius: .5em;
    }
    code {
      color: #E4B842;
      font-family: 'Source Code Pro',monospace;
    }
  </style>
  <link href="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.css" rel="stylesheet">
</head>

<body>
  <h2 id="accountInput">Jump Start: Pre-Roll Ad</h2>

  <p>Enter values for the three form fields below to see a pre-roll ad appear before your video. (If you choose not to input your data, demo data will be supplied.)</p>
  <p>Below the player, the code for the player implementation is shown so you can copy and use.</p>

  <div id="inputFields" class="input-fields">
  <fieldset class="bcls-fieldset"><legend>Account Information</legend>

  <div id="accountInfo">
  <table class="bcls-table">
  	<tbody class="bcls-table__body">
  		<tr>
  			<td>Video Cloud Account ID:</td>
  			<td><input id="accountID" type="text" size="60" placeholder="1507807800001" /></td>
  		</tr>
  		<tr>
  			<td>Video ID:</td>
  			<td><input id="videoID" type="text" size="60" placeholder="5622718636001"/></td>
  		</tr>
  		<tr>
  			<td>Ad Server URL:</td>
  			<td><input id="adServerURL" type="text" size="60" placeholder="https://solutions.brightcove.com/bcls/brightcove-player/vmap/simple-vast.xml" /></td>
  		</tr>
  	</tbody>
  </table>
  </div>
  </fieldset>
  </div>
  <p><button id="buildPlayer" class="bcls-button"  onclick="addPlayer()">Build the Player</button></p>
  <div id="playerWrapper"  >
  <fieldset class="bcls-fieldset"><legend>Player</legend><div id="placeHolder" style="width: 640px;height: 360px"></div></fieldset>
  </div>

  <div id="publishingCodeWrapper">
  <fieldset class="bcls-fieldset"><legend>Publishing Code</legend><textarea id="publishingCode" class="bcls-code" style="width: 90%;height: 420px" onclick="this.select()"></textarea></fieldset>
  </div>

  <!-- custom script -->
  <script type="text/JavaScript">
    var myPlayer,
      playerHTML,
      playerScript,
      publishingCode = document.getElementById('publishingCode'),
      accountID = document.getElementById('accountID'),
      videoID = document.getElementById('videoID'),
      adServerURL = document.getElementById('adServerURL'),
      defaults = {},
      options = {};
      defaults.accountID = '1507807800001';
      defaults.videoID = '5622718636001';
      defaults.adServerURL = 'https://solutions.brightcove.com/bcls/brightcove-player/vmap/simple-vast.xml';

     //  Build the player and place in HTML DOM
    function addPlayer() {
      options.accountID = (isDefined(accountID.value)) ? accountID.value : defaults.accountID;
      options.videoID = (isDefined(videoID.value)) ? videoID.value : defaults.videoID;
      options.adServerURL = (isDefined(adServerURL.value)) ? adServerURL.value : defaults.adServerURL;

      console.log('options',options);

      // Dynamically build the player video element
      playerHTML = '<video id=\"myPlayerID\" data-video-id=\"' + options.videoID + '\"  data-account=\"' + options.accountID + '\" data-player=\"default\" data-embed=\"default\" class=\"video-js\" controls></video>';
      // Inject the player code into the DOM
      document.getElementById('placeHolder').innerHTML = playerHTML;
      // Add and execute the player script tag
      playerScript = document.createElement('script');
      playerScript.src = "//players.brightcove.net/" + options.accountID + "/default_default/index.min.js";
      document.body.appendChild(playerScript);
      playerScript.onload = callback;
    }
     //  Initialize the player and start the video
    function callback() {
      var ima = document.createElement('script');
      ima.src = '//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.js';
      document.body.appendChild(ima);
      myPlayer = videojs('myPlayerID');
      ima.onload = function () {
        myPlayer.ima3({
          // debug to true to see console messages
          debug: true,
          // set the requestMode to onload
          requestMode: "onload",
          // this is where your ad tag goes
          serverUrl: options.adServerURL
        });
      }
      buildHTML();
    }
    function buildHTML() {
      var htmlText,
        prettyText;
      htmlText = '<!doctype html><html><head><meta charset="UTF-8"><title>Play a Preroll</title><!-- Page styles --><style>.video-js {width: 640px; height: 360px;}</style><link href="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.css" rel="stylesheet"></head><body>'
      htmlText += playerHTML;
      htmlText += playerScript.outerHTML;
      htmlText += '<script src="//players.brightcove.net/videojs-ima3/3/videojs.ima3.min.js">\</script\>'
      htmlText += '<script type="text/javascript">';
      htmlText += '\n\t\t\tvar myPlayer = videojs.getPlayer("myPlayerID");\n\t\t\tmyPlayer.ready(function(){\n\t\t\t\tmyPlayer.ima3({ \n\t\t\t\t\tdebug: true,\n\t\t\t\t\trequestMode: "onload",\n\t\t\t\t\tserverUrl: "' + options.adServerURL + '"\n\t\t\t\t})\n\t\t\t}); \</script\> </body> </html>';
      prettyText = formatCode(htmlText,false,false);
      publishingCode.textContent = prettyText;
    }

    // Parameters:
    // code 								- (string) code you wish to format
    // stripWhiteSpaces			- (boolean) do you wish to remove multiple whitespaces coming after each other?
    // stripEmptyLines 			- (boolean) do you wish to remove empty lines?
    function formatCode(code, stripWhiteSpaces, stripEmptyLines) {
        "use strict";
        var whitespace          = ' '.repeat(1);             // Default indenting 4 whitespaces
        var currentIndent       = 0;
        var char                = null;
        var nextChar            = null;


        var result = '';
        for(var pos=0; pos <= code.length; pos++) {
            char            = code.substr(pos, 1);
            nextChar        = code.substr(pos+1, 1);

            // If opening tag, add newline character and indention
            if(char === '<' && nextChar !== '/') {
                result += '\n' + whitespace.repeat(currentIndent);
                currentIndent++;
            }
            // if Closing tag, add newline and indention
            else if(char === '<' && nextChar === '/') {
                // If there're more closing tags than opening
                if(--currentIndent < 0) currentIndent = 0;
                result += '\n' + whitespace.repeat(currentIndent);
            }

            // remove multiple whitespaces
            else if(stripWhiteSpaces === true && char === ' ' && nextChar === ' ') char = '';
            // remove empty lines
            else if(stripEmptyLines === true && char === '\n' ) {
                //debugger;
                if(code.substr(pos, code.substr(pos).indexOf("<")).trim() === '' ) char = '';
            }

            result += char;
        }

        return result;
    }
    /**
      * determines whether a var has value
      * @param  {*}  x var to evaluate - note that if x = {} or [], true will be returned
      * @return {Boolean}   whether var has a value
      */
     function isDefined(x) {
         if (x === '' || x === null || x === undefined) {
             return false;
         }
         return true;
     }
  </script>
</body>

</html>
