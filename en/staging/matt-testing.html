<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Begin Drupal Taxonomy Data -->
  <meta name="products" content="Video Cloud, Brightcove Player">
  <meta name="role" content="Device SDK Developer">
  <meta name="task" content="Develop with the Native SDKs">
  <meta name="topic" content="Troubleshooting/Error Handling">
  <meta name="sdk" content="iOS,tvOS,Android">
  <meta name="keywords" content="device,SDK,FAQ">
  <!-- End Drupal Taxonomy Data -->

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
  <meta name="robots" content="noindex">
  <!-- change title to match the h1 heading -->
  <title>Advertising with the SSAI Plugin</title>

  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
  <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <script src="//use.edgefonts.net/source-code-pro.js"></script>
  <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
  <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
  <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
  <!-- header navbar -->
  <div id="navWrapper" class="fixed"></div>
  <!-- breadcrumbs -->
  <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
  <div class="row">
    <div class="sidebar large-2 columns show-for-large-up">
      <div id="sidenav" class="side-nav"></div>
    </div>
    <div id="main" class="large-10 small-12 columns">
      <h1>Doc Title</h1>

      <!-- BEGIN DRUPAL CONTENT -->

      <article class="bcls-article">
        <section class="bcls-section">
          <h2 id="High_level_view">High level view</h2>

          <p>To use the REST APIs you need to have a few pieces in place. Briefly, they are:</p>

          <ul>
            <li><strong>Client code</strong>: The client code asks for specific data then displays it according to application requirements. The client code will be discussed at some length in this document as it is what you will need to be writing most frequently.</li>
            <li><strong>Proxy server</strong>: For security reasons the REST APIs will not accept data requests directly from the client as that would encourage sending confidential information, like client credentials, from the client. This means that a
              proxy will act as an intermediary between the client and the REST API. The proxy used in the examples is written in PHP and discussed later in this document. The proxy must be setup on a server under your control, and can be written in the
              language of your choice. The suggested configuration of the proxy enables it to be written once and used by any of the APIs.</li>
            <li><strong>REST APIs</strong>: Brightcove supplies a comprehensive set of APIs to customize, extend, and integrate with the Brightcove platform. See the <a href="/node/16824">Overview: Video Cloud APIs</a> document for more information.</li>
          </ul>

          <p>The following diagram shows the interaction between the three core entities of the process to retrieve data from one of Brightcove's REST APIs:</p>

          <figure class="bcls-figure"><img class="bcls-image" alt="Basic Pieces Overview" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/client-proxy-api.png" /></figure>
        </section>

        <section class="bcls-section">
          <h2 id="Client_functionality_overview">Client functionality overview</h2>

          <p>The client side code changes significantly depending from which API you are requesting data. As mentioned above, the proxy is a write once and don't modify piece of code, and the APIs are maintained by Brightcove. This is why the emphasis in
            the document will be on learning how to alter the client code to retrieve the desired data from one of the APIs.</p>

          <p>The diagram below focuses on key parts of the client code, those being:</p>

          <ul>
            <li>The function that makes the <code>HTTPRequest</code> to the proxy. To avoid ambiguity the function is named <code>makeRequest()</code>. It is pictured on the right side of the diagram below.</li>
            <li>The code that gathers required information for the request. It is pictured on the top-left of the diagram. This code is usually quite straight forward and uses concepts well know to even beginning programmers.</li>
            <li>The call that executes the previously mentioned <code>makeRequest()</code> function. It is pictured on the bottom-left of the diagram. The call passes a function to <code>makeRequest()</code> as a parameter. Then in <code>makeRequest()</code>              that function is called. This is an example of a anonymously defined <strong>callback</strong> function.</li>
          </ul>

          <p>You see the two sections in the diagram labeled <strong>Asynchronous Activity</strong>. Although represented in the diagram in two different places, this is actually the same asynchronous activity, and represents the unknown time it takes for:</p>

          <ul>
            <li>The client to send the request to the proxy.</li>
            <li>The proxy to request data from the API.</li>
            <li>The API to build the result set and return it to the proxy.</li>
            <li>The proxy to return the data to the client.</li>
          </ul>

          <p>Note that the logic flow arrows from the box that calls <code>makeRequest()</code> (bottom-left box) seem to indicate that the code is executed at two different times, which is exactly the case. The call to the function is made, but the callback
            function is not executed until <code>makeRequest()</code> has done its job and the callback function is executed, which returns the requested data to the function calling code.</p>

          <figure class="bcls-figure"><img class="bcls-image" alt="Client functionality overview" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/proxy-API-call.png" /></figure>
        </section>

        <section class="bcls-section">
          <h2 id="Example_code_walkthrough">Example code walkthrough</h2>

          <p>Rather than looking at the code as one piece, it will be presented and discussed in sections. Some of the sections will relate to the diagram above.</p>

          <h3>Standard player code</h3>

          <p>This code section contains the basic Brightcove Player in-page embed code.</p>

          <ul>
            <li>Lines 11-21: Standard Brightcove Player code with the addition of a <code>id</code> attribute added.</li>
          </ul>

          <pre class="line-numbers">
<code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Untitled Document&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;video id="myPlayerID"
    data-video-id="3851380732001"
    data-account="1752604059001"
    data-player="HkAzSmB0l"
    data-embed="default"
    data-application-id
    class="video-js"
    controls
    width="640"
    height="360"&gt;&lt;/video&gt;
  &lt;script src="//players.brightcove.net/1752604059001/HkAzSmB0l_default/index.min.js"&gt;&lt;/script&gt;</code></pre>

          <h3>Preparing to make call</h3>

          <p>This code section initializes variables and gets ready to make the call to <code>makeRequest()</code>. Generally speaking, for a read request you will need to provide the following information:</p>
          <ol>
            <li>The URL to the proxy you will be using, for example (of course, this needs to be proxy under your control):
              <pre class="line-numbers"><code class="language-html">https://solutions.brightcove.com/bcls/bcls-proxy/doc-samples-proxy-v2.php</code></pre>
            </li>
            <li>The URL needed for the actual request, normally dynamically constructed:
            <pre class="line-numbers"><code class="language-html">https://analytics.api.brightcove.com/v1/alltime/accounts/1752604059001/videos/4825279519001</code></pre> </li>
            <li>The HTTP method, for instance <code>GET</code>.</li>
          </ol>
          <p>An example follows:</p>

          <ul>
            <li>Line 1: Standard code to wait until the player is ready to interact with.</li>
            <li>Lines 2-4: Create/set values for variables needed later in the code.</li>
            <li>Lines 7-12: Wait for the <code>loadstart</code> event so the <code>mediainfo</code> object is populated. Assign variables to hold values needed for the Analytics API endpoint.</li>
            <li>Line 13: Set the HTTP method for the call.</li>
          </ul>

          <pre class="line-numbers">
<code class="language-javascript">videojs('myPlayerID').ready(function() {
  myPlayer = this,
    accountId = myPlayer.bcinfo.accountId,
    options = {};

  // +++ Wait for loadstart event so can use mediainfo object +++
  myPlayer.on('loadstart', function() {
    var videoId = myPlayer.mediainfo.id,
      baseURL = 'https://analytics.api.brightcove.com/v1/alltime/accounts/',
      endPoint = accountId + '/videos/' + videoId;
    options.proxyURL = &quot;https://solutions.brightcove.com/bcls/bcls-proxy/doc-samples-proxy-v2.php&quot;;
    options.url = baseURL + endPoint;
    options.requestType = &quot;GET&quot;;</code></pre>
          <aside class="bcls-aside bcls-aside--information">Note: Lines 9,10 and 12 could easily be placed into a single long line. The code was written as shown to avoid long lines that involve scrolling to view, and also to assist in code reusability.</aside>

          <h3>Call <code>makeRequest()</code></h3>

          <p>This code section makes the call to <code>makeRequest()</code> function. Note that two parameters are passed. The first being the options object that holds info for the endpoint, and the second is the callback function. Remember, this is an asynchronous call so the anonymously defined callback function won't be called until data has been returned by the REST API to the <code>makeRequest()</code> function.</p>

          <ul>
            <li>Line 1: Call the <code>makeRequest()</code> function, passing the required values for the call in the <code>options</code> object. In this case the object contains the following:
              <figure class="bcls-figure"><img class="bcls-image" alt="options object" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/options-object-console.png" /></figure>
            </li>
            <li>Lines 3-13: The callback function is defined as an anonymous function (highlighted in yellow). Remember that this function is a parameter and NOT called here but later in the code.</li>
            <li>Lines 6, 8, 10: <code>console.log()</code> statements that display:
              <ul>
                <li>The raw JSON string that is returned by the API call.</li>
                <li>The JSON object generated by the <code>JSON.parse()</code> method that does conversion from string to object.</li>
                <li>The actual views count, extracted from the object by using simple <code>object.property</code> notation.</li>
              </ul>
            </li>
            <li>Line 12: Calls the function that displays the number of views in the controlbar.</li>
          </ul>

          <p>The following screenshot from the console shows actual displayed data from the <code>console.log</code> statements:</p>

          <figure class="bcls-figure"><img class="bcls-image" alt="Processing of data in callback function" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/console-data-process-callback-function.png" /></figure>

          <pre class="line-numbers">
<code class="language-javascript">// +++ Make the request to the Analytics API +++
// Extract views from data returned by Analytics API
makeRequest(options, <span class="bcls-highlight">function(viewsRaw) {
  var viewsCount;
  // Remove console.log command for production code
  console.log('viewsRaw', viewsRaw);
  viewsObject = JSON.parse(viewsRaw);
  console.log('viewsObject', viewsObject);
  viewsCount = viewsObject.alltime_video_views;
  console.log('views', viewsCount);
  // Call function to place data in controlbar
  placeCountInControlbar(viewsCount);
}</span>);</code></pre>

          <h3>Actual <code>makeRequest()</code> function</h3>

          <p>This section of the document examines the code that actually defines the <code>makeRequest()</code> function. The code that defines the function is written in such a way that it need NOT be modified, but used repeatedly as is. You may find edge cases that this is not true, but for the vast majority of uses this code need NOT be modified.</p>

          <aside class="bcls-aside bcls-aside--tip">A key concept in understanding the <code>makeRequest()</code> function is gaining knowledge about how the <code>XMLHttpRequest</code> object behaves. The <code>XMLHttpRequest.onreadystatechange</code> is an event handler that is called whenever the <code>readyState</code> attribute changes. The value assigned to it is the event handler function code that you write. The following table shows the values the <code>readyState</code> attribute can have, and what each value means:

            <table class="bcls-table">
              <thead class="bcls-table__head">
                <tr>
                  <td class="header">Value</td>
                  <td class="header">State</td>
                  <td class="header">Description</td>
                </tr>
              </thead>
              <tbody class="bcls-table__body">
                <tr>
                  <td><code>0</code></td>
                  <td><code>UNSENT</code></td>
                  <td>Client has been created. <code>open()</code> not called yet.</td>
                </tr>
                <tr>
                  <td><code>1</code></td>
                  <td><code>OPENED</code></td>
                  <td><code>open()</code> has been called.</td>
                </tr>
                <tr>
                  <td><code>2</code></td>
                  <td><code>HEADERS_RECEIVED</code></td>
                  <td><code>send()</code> has been called, and headers and status are available.</td>
                </tr>
                <tr>
                  <td><code>3</code></td>
                  <td><code>LOADING</code></td>
                  <td>Downloading; <code>responseText</code> holds partial data.</td>
                </tr>
                <tr>
                  <td><code>4</code></td>
                  <td><code>DONE</code></td>
                  <td>The operation is complete.</td>
                </tr>
              </tbody>
            </table>
            <p>You will see in the code the exactly how the event handler is utilized.</p>
          </aside>
          <p>A line by line discussion of the code follows:</p>
          <ul>
            <li>Lines 1-6: Function definition and variables creation. A key point is that an new <code>XMLHttpRequest</code> object is created.</li>
            <li>Lines 8, 26: Defines the event handler function for <code>readyState</code> changes.</li>
            <li>Lines 9, 23, 25: Use a <code>try-catch</code> in case the request fails at a high level.</li>
            <li>Lines 10, 11: Use <code>if</code> statements to be sure the request is finished (<code>readyState</code> is 4) and completed successfully, the status is in the 200 range. The following shows console logging of the <code>readyState</code> and <code>status</code> values in the event handler definition:
              <figure class="bcls-figure"><img class="bcls-image" alt="Logging readyState and status" src="//learning-services-media.brightcove.com/doc-assets/player-development/architecture/proxy-API-call/console-readystate-and-status.png" /></figure>
            </li>
            <li>Line 18: The callback function is executed. This passes the returned data from the API back to the callback function as detailed in the <strong>Call makeRequest()</strong> section above.</li>

            <li>Line 33: Set the event handler for the <code>XMLHttpRequest.onreadystatechange</code> event.</li>
            <li>Line 35: Initializes the request to the proxy.</li>
            <li>Line 38: Sends the request, which is asynchronous.</li>
          </ul>

          <pre class="line-numbers">
<code class="language-javascript">function makeRequest(options, callback) {
  var httpRequest = new XMLHttpRequest(),
    response,
    requestParams,
    dataString,
    proxyURL = options.proxyURL,
    // response handler
    getResponse = function() {
      try {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
            response = httpRequest.responseText;
            // some API requests return '{null}' for empty responses - breaks JSON.parse
            if (response === '{null}') {
              response = null;
            }
            // return the response
            callback(response);
          } else {
            alert('There was a problem with the request. Request returned ' + httpRequest.status);
          }
        }
      } catch (e) {
        alert('Caught Exception: ' + e);
      }
    };
  /**
   * set up request data
   * the proxy used here takes the following request body:
   * JSON.strinify(options)
   */
  // set response handler
  httpRequest.onreadystatechange = getResponse;
  // open the request
  httpRequest.open('POST', proxyURL);
  // set headers if there is a set header line, remove it
  // open and send request
  httpRequest.send(JSON.stringify(options));
}</code></pre>


          <h3>Display the returned data</h3>

          <p>This code shows how to place the returned data into the controlbar. This function is called at the end of the callback function, shown in <strong>Call makeRequest()</strong> section above.</p>

          <ul>
            <li>Lines 5, 16: Define the function.</li>
            <li>Line 6: Create a variable for the <code>spacer</code> element in the controlbar.</li>
            <li>Line 7: Dynamically create a <code>div</code> element.</li>
            <li>Line 9: Place a label and the value of the views in the newly created <code>div</code> element.</li>
            <li>Line 11: Use JavaScript's <code>document.getElementsByClassName()</code> method to get the controlbar's <code>spacer</code> element.</li>
            <li>Line 13: Style the <code>spacer</code> to display the total views right-justified and down 10px from the top of the <code>spacer</code>.</li>
            <li>Line 15: Add the newly created, populated and styled element to the <code>spacer</code>.</li>
          </ul>

          <pre class="line-numbers">
<code class="language-javascript">/**
 * Dynamically build a div that is then
 * placed in the controlbar's spacer element
 */
function placeCountInControlbar(viewsCount) {
  var spacer,
    newElement = document.createElement('div');
  //Place data in div
  newElement.innerHTML = &quot;Total Views: &quot; + viewsCount;
  //Get the spacer in the controlbar
  spacer = document.getElementsByClassName('vjs-spacer')[0];
  //Right justify content in the spacer and add top margin
  spacer.setAttribute('style', 'justify-content: flex-end; margin-top: 10px');
  //Add the dynamically built div to the spacer in the controlbar
  spacer.appendChild(newElement);
}</code></pre>

          <h3>Complete code listing</h3>

          <p>The complete, functioning code is located in this GitHub repository: <a href="https://github.com/BrightcoveLearning/learning-guide-using-rest-apis/blob/master/display-views-in-controlbar.html">display-views-in-controlbar.html</a>.</p>
        </section>

        <section class="bcls-section">
          <h2 id="Proxy_code">Proxy code</h2>

          <p>As mentioned earlier, the proxy can be written in the language of your choice. The Brightcove API documentation examples use a proxy written in PHP. Since the implementation of the proxy is so language dependent, the PHP code below will not be analyzed in detail in this document.</p>

          <p>The basic functionality provided by a proxy must include:</p>

          <ol>
            <li>Accept client request.</li>
            <li>Get an <strong>auth token</strong> from the OAuth API.</li>
            <li>Send the auth token and data request (endpoint) to the intended API.</li>
            <li>Receive data back from API.</li>
            <li>Send data back to client.</li>
          </ol>

          <pre class="line-numbers">
<code class="language-javascript">&lt;?php
/**
 * proxy for Brightcove RESTful APIs
 * gets an access token, makes the request, and returns the response
 * Accessing:
 *         (note you should *always* access the proxy via HTTPS)
 *     Method: POST
 *     request body (accessed via php://input) is a JSON object with the following properties
 *
 * {string} url - the URL for the API request
 * {string} [requestType=GET] - HTTP method for the request
 * {string} [requestBody] - JSON data to be sent with write requests
 * {string} [client_id] - OAuth2 client id with sufficient permissions for the request
 * {string} [client_secret] - OAuth2 client secret with sufficient permissions for the request
 * {string} [account_id] - Brightcove account id
 *
 * if client_id, client_secret, or account_id are not included in the request, default values will be used
 *
 * @returns {string} $response - JSON response received from the API
 */

// security checks
// if you want to do some basic security checks, such as checking the origin of the
// the request against some white list, this is the place to do it
// CORS enablement and other headers
header(&quot;Access-Control-Allow-Origin: *&quot;);
header(&quot;Content-type: application/json&quot;);
header(&quot;X-Content-Type-Options: nosniff&quot;);
header(&quot;X-XSS-Protection&quot;);

// default account values
// if you work on one Brightcove account, put in the values below
// if you do not provide defaults, the account id, client id, and client secret must
// be sent in the request body for each request
$default_account_id    = 'YOUR_ACCOUNT_ID';
$default_client_id     = 'YOUR_CLIENT_ID';
$default_client_secret = 'YOUR_CLIENT_SECRET';

// get request body
$requestData = json_decode(file_get_contents('php://input'));

// set up access token request
if ($requestData-&gt;client_id) {
    $client_id = $requestData-&gt;client_id;
} else {
    // default to the id for all permissions for most BCLS accounts
    $client_id = $default_client_id;
}
if ($requestData-&gt;client_secret) {
    $client_secret = $requestData-&gt;client_secret;
} else {
    // default to the secret for all permissions for most BCLS accounts
    $client_secret = $default_client_secret;
}
if ($requestData-&gt;ccount_id) {
    $account_id = $requestData-&gt;account_id;
} else {
    // default to Doc Samples account; change to default to BrightcoveLearning or another account
    $account_id = $default_account_id;
}

$auth_string = &quot;{$client_id}:{$client_secret}&quot;;
$request     = &quot;https://oauth.brightcove.com/v4/access_token?grant_type=client_credentials&quot;;
$ch          = curl_init($request);
curl_setopt_array($ch, array(
        CURLOPT_POST           =&gt; TRUE,
        CURLOPT_RETURNTRANSFER =&gt; TRUE,
        CURLOPT_SSL_VERIFYPEER =&gt; FALSE,
        CURLOPT_USERPWD        =&gt; $auth_string,
        CURLOPT_HTTPHEADER     =&gt; array(
            'Content-type: application/x-www-form-urlencoded',
        ),
    ));
$response = curl_exec($ch);
curl_close($ch);

// Check for errors
if ($response === FALSE) {
    die(curl_error($ch));
}

// Decode the response
$responseData = json_decode($response, TRUE);
$access_token = $responseData[&quot;access_token&quot;];

// get request type or default to GET
if ($requestData-&gt;requestType) {
    $method = $requestData-&gt;requestType;
} else {
    $method = &quot;GET&quot;;
}

// more security checks
// optional: you might want to check the URL for the API request here
// and make sure it is to an approved API
// and that there is no suspicious code appended to the URL


// get the URL and authorization info from the form data
$request = $requestData-&gt;url;
//send the http request
if ($requestData-&gt;requestBody) {
  $ch = curl_init($request);
  curl_setopt_array($ch, array(
    CURLOPT_CUSTOMREQUEST  =&gt; $method,
    CURLOPT_RETURNTRANSFER =&gt; TRUE,
    CURLOPT_SSL_VERIFYPEER =&gt; FALSE,
    CURLOPT_HTTPHEADER     =&gt; array(
      'Content-type: application/json',
      &quot;Authorization: Bearer {$access_token}&quot;,
    ),
    CURLOPT_POSTFIELDS =&gt; $requestData-&gt;requestBody
  ));
  $response = curl_exec($ch);
  curl_close($ch);
} else {
  $ch = curl_init($request);
  curl_setopt_array($ch, array(
    CURLOPT_CUSTOMREQUEST  =&gt; $method,
    CURLOPT_RETURNTRANSFER =&gt; TRUE,
    CURLOPT_SSL_VERIFYPEER =&gt; FALSE,
    CURLOPT_HTTPHEADER     =&gt; array(
      'Content-type: application/json',
      &quot;Authorization: Bearer {$access_token}&quot;,
    )
  ));
  $response = curl_exec($ch);
  curl_close($ch);
}

// Check for errors and log them if any
// note that logging will fail unless
// the file log.txt exists in the same
// directory as the proxy and is writable
if ($response === FALSE) {
    $logEntry = &quot;\nError:\n&quot;.
    &quot;\n&quot;.date(&quot;Y-m-d H:i:s&quot;).&quot; UTC \n&quot;
    .$response;
    $logFileLocation = &quot;log.txt&quot;;
    $fileHandle      = fopen($logFileLocation, 'a') or die(&quot;-1&quot;);
    fwrite($fileHandle, $logEntry);
    fclose($fileHandle);
    echo &quot;Error: there was a problem with your API call&quot;+
    die(curl_error($ch));
}

// Decode the response
// $responseData = json_decode($response, TRUE);
// return the response to the AJAX caller
$responseDecoded = json_decode($response);
if (!isset($responseDecoded)) {
    $response = '{null}';
}
echo $response;
?&gt;</code></pre>

          <p>Although the entire code for the proxy server is shown above, it is also located in the GitHub repo: <a href="https://github.com/BrightcoveLearning/learning-guide-using-rest-apis/blob/master/proxy.php">proxy.php</a>.</p>
        </section>

        <section class="bcls-section">
          <h2 id="Example_2">Example 2</h2>

          <p>This second example is more complex than the one detailed earlier. This example displays the 10 most popular videos from an account in a playlist. The main steps of the code are:</p>

          <ol>
            <li>Request from the Analytics API the 10 videos with the most views in an account. This step involves an asynchronous call using a callback function.</li>
            <li>From the returned Analytics API data, extract only the video IDs and place them in an array. A helper function is written to do the extraction of IDs from the returned data.</li>
            <li>Request the complete video objects for each of the videos in the list of IDs in the array. This step involves looping over the array and requesting the video objects using <code>player.catalog.getVideo()</code>. Of course, this involves multiple asynchronous calls using the <code>catalog</code>. A helper function is written to retrieve the video objects based on IDs and place the objects into an array.</li>
            <li>Place the array of video objects into the playlist for a playlist-enabled player.</li>
          </ol>

          <p>Since you are now familiar with many of the concepts and specific code on how to call the APIs, only the code that calls the <code>makeRequest()</code> function is detailed.</p>

          <ul>
            <li>Line 2: Call the <code>makeRequest()</code> function passing as arguments the options required for a successful REST API call, along with an anonymously defined callback function (highlighted in yellow). This should sound familiar from above. Very importantly, the <code>makeRequest()</code> function that is called IS THE EXACT SAME FUNCTION USED IN THE PREVIOUS EXAMPLE. You can do the same in your code. The <code>makeRequest()</code> function was written to be reused with any calls to a Brightcove REST API.
              <aside class="bcls-aside bcls-aside--tip">The <code>mostWatchedVideos</code> parameter will have the retrieved value assigned to when the callback function is used in the <code>makeRequest()</code> function.</aside>
            </li>
            <li>Line 3: Create a variable to hold the JSON parsed returned data.</li>
            <li>Line 5: Parse the returned data to convert if from a string to an object.</li>
            <li>Line 7: Use the helper function to extract video IDs from returned data. Unfortunately, the Analytics API does not return the full video objects, so IDs are needed to access the full objects.</li>
            <li>Lines 9-12: Call the <code>getVideoData</code> helper function that uses a callback function to populate the <code>videoObjects</code> array based on IDs passed.</li>
            <li>Line 11: Populate the playlist with the array of video objects.</li>
          </ul>

          <pre class="line-numbers">
      <code class="language-javascript">// +++ Make the CMS API request to get matching video IDs +++
      makeRequest(options, <span class="bcls-highlight">function(mostWatchedVideos) {
        var JSONmostWatchedVideos;
        // Convert response string into JSON
        JSONmostWatchedVideos = JSON.parse(mostWatchedVideos);
        // Extract the needed video IDs into an array
        videoData = extractVideoData(JSONmostWatchedVideos);
        // Get video objects based on array of video IDs
        getVideoData(videoData, function(videoObjects) {
          // Add the most watched videos list to the player as a playlist
          myPlayer.playlist(videoObjects);
        });</span>
      });</code></pre>

          <h3>Complete code listing</h3>

          <p>The complete, functioning example is located in this CodePen: <a href="https://codepen.io/team/rcrooks1969/pen/zRzZNG/">Most Watched Videos in a Playlist</a>.</p>
        </section>
      </article>


      <!-- END DRUPAL CONTENT -->
    </div>
  </div>

  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
    $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
</body>

</html>
