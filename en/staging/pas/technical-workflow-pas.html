<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Technical Workflow: Playback Authorization Service</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Technical Workflow: Playback Authorization Service</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <p>In this topic, you will learn how to generate and register tokens when using Brightcove's Playback Authorization Service.</p>


	    <!-- BEGIN DRUPAL CONTENT -->

<article class="bcls-article">
<section class="bcls-section">
<h2 id="Introduction">Introduction</h2>

<p>Brightcove's Playback Authorization Service (PAS) offers an extra level of security when using Dynamic Delivery with DRM-protected or HTTP Live Streaming Encryption (HLSe) content. </p>

<p>This feature gives you control over your content playback by requiring a token to authorize playback. A valid JWT token is required to obtain a key, needed to decrypt encrypted HLS,  or a license, needed to decrypt DRM-protected content.</p>

<p>If you are not familiar with this feature, see the <a href="https://docs.brightcove.com/en/staging/pas/overview-playback-authorization-service.html">Overview: Playback Authorization Service</a> document.</p>

</section>

<section class="bcls-section">
<h2 id="Workflow">Workflow</h2>

<p>To use Playback Authorization Service, follow these steps:</p>
<ol class="bcls-tasklist">
	<li><a href="#Generate_public_private_key_pair">Generate public-private key pair</a></li>
  <li>
    <a href="#Register_public_key">Register public key with Brightcove</a>
  </li>
  <li>
    <a href="#Generate_JWT_token">Generate JWT token for each playback session, signed with the private key</a>
  </li>
  <li>
    <a href="#Configure_the_player">Configure the player to use the token</a>
  </li>
  <li>
    <a href="#Blacklist_tokens">Blacklist tokens</a>
  </li>
</ol>

</section>

<section class="bcls-section">
<h2 id="Generate_public_private_key_pair">Generate public-private key pair</h2>

<p>The publisher will generate a public-private key pair and provide the public key to Brightcove. The private key is used by the publisher to sign tokens, and is not shared with Brightcove.</p>

<p>
  Example script to generate the key pair:
</p>
<pre class="line-numbers"><code class="language-bash">#!/bin/bash
set -euo pipefail

NAME=${1:-}
test -z &quot;${NAME:-}&quot; &amp;&amp; NAME=&quot;brightcove-playback-auth-key-$(date +%s)&quot;
mkdir &quot;$NAME&quot;

CURVE_PEM=&quot;./$NAME/prime256v1.pem&quot;
PRIVATE_PEM=&quot;./$NAME/private.pem&quot;
PUBLIC_PEM=&quot;./$NAME/public.pem&quot;
PUBLIC_TXT=&quot;./$NAME/public_key.txt&quot;

openssl ecparam -name prime256v1 -out &quot;$CURVE_PEM&quot;
openssl ecparam -in &quot;$CURVE_PEM&quot; -genkey -noout -out &quot;$PRIVATE_PEM&quot;
openssl ec -in &quot;$PRIVATE_PEM&quot; -pubout -out &quot;$PUBLIC_PEM&quot; 2&gt;/dev/null
openssl ec -in &quot;$PRIVATE_PEM&quot; -pubout -outform DER | base64 &gt; &quot;$PUBLIC_TXT&quot;

rm &quot;$CURVE_PEM&quot;

echo &quot;Public key saved in $PUBLIC_TXT&quot;
</code></pre>

<p>
  An example of a decoded token using <a href="https://jwt.io/">https://JWT.io</a> specifying the full set of claims is shown here:
</p>
<p>
  HEADER:
</p>
<pre class="line-numbers"><code class="language-json">{
  &quot;alg&quot;: &quot;ES256&quot;,
  &quot;type&quot;: &quot;JWT&quot;
}
</code></pre>

<p>
  PAYLOAD:
</p>
<pre class="line-numbers"><code class="language-json">{
  &quot;accid&quot;: &quot;1100863500123&quot;,
  &quot;conid&quot;: &quot;51141412620123&quot;,
  &quot;exp&quot;: &quot;1554200832&quot;,
  &quot;iat&quot;: &quot;1554199032&quot;,
  &quot;maxip&quot;: &quot;10&quot;,
  &quot;maxu&quot;: &quot;10&quot;,
  &quot;ua&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;
}
</code></pre>
</section>

<section class="bcls-section">
<h2 id="Register_public_key">Register public key</h2>

<p>The public key is registered with Brightcove using the Key API.</p>
<h3>Key API</h3>
<p>
  A maximum of 3 keys may be registered at a time and keys may be deleted, to support key rotation. In practice it is best to have only 1 key.
</p>

<h4>Base URL</h4>
<p>
  The base URL for the API is:
</p>
<pre class="line-numbers"><code class="language-http">https://playback-auth.api.brightcove.com
</code></pre>

<h4>Account path</h4>
<p>
  In all cases, requests will be made for a specific Video Cloud Account. So, you will always add the term accounts followed by your account id to the base URL:
</p>
<pre class="line-numbers"><code class="language-http">https://playback-auth.api.brightcove.com/v1/accounts/{account_Id}
</code></pre>

<h4>Authentication</h4>
<p>
  In all cases, requests will be made for a specific Video Cloud Account. So, you will always add the term accounts followed by your account id to the base URL:
</p>
<pre class="line-numbers"><code class="language-http">Authorization: Bearer {access_token}
</code></pre>
<p>
  The access token is a temporary OAuth2 access token that must be obtained from the Brightcove OAuth service. For details on how to obtain client credentials and use them to retrieve access tokens, see the <a href="https://support.brightcove.com/overview-oauth-api-v4">Brightcove OAuth Overview</a>.
</p>

<h4>Permissions</h4>
<p>
  Requests to the Key API must be made from <a href="https://support.brightcove.com/oauth-api">client credentials</a> with the following permissions:
</p>
<ul>
  <li>
    video-cloud/playback-auth/key/read
  </li>
  <li>
    video-cloud/playback-auth/key/write
  </li>
</ul>

<h4>Manage keys</h4>
<p>
  The Key API supports the following requests:
</p>

<p>
  <strong>List keys:</strong>
</p>
<pre class="line-numbers"><code class="language-http">GET /v1/accounts/{account_Id}/keys
</code></pre>

<!-- <p>
  <strong>Get one key:</strong>
</p>
<pre class="line-numbers"><code class="language-http">GET /v1/accounts/{account_Id}/keys/{key_Id}
</code></pre> -->

<p>
  <strong>Delete one key:</strong>
</p>
<pre class="line-numbers"><code class="language-http">DELETE /v1/accounts/{account_Id}/keys/{key_Id}
</code></pre>

<p>
  <strong>Register a new key:</strong>
</p>
<pre class="line-numbers"><code class="language-http">POST /v1/accounts/{account_Id}/keys
    Content-Type: application/json
    Body: {&quot;value&quot;: &quot;MFkwEwYHKoZIzj0CAQYIKoZIzj...MyeQviqploA==&quot;}
</code></pre>

</section>

<section class="bcls-section">
<h2 id="Generate_JWT_token">Generate JWT token</h2>

<p>Publishers create a <a href="https://jwt.io/introduction/">JSON Web Token</a> (JWT). The token is signed with the <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm">Elliptic Curve Digital Signature Algorithm</a> (ECDSA) using the P-256 curve and the SHA-256 hash algorithm (identified in the JWT spec as "<a href="https://ldapwiki.com/wiki/ES256">ES256</a>"). No other JWT algorithms will be supported.</p>
<p>
  A subset of the standard <a href="https://auth0.com/docs/tokens/jwt-claims">JSON Web Token claims</a> will be used, along with some private claims defined by Brightcove:
</p>

<ul>
  <li>
    <strong>accid</strong> - REQUIRED string, must correspond to the account id that owns the content being played
  </li>
  <li>
    <strong>exp</strong> - REQUIRED int, time this token will no longer be valid, in seconds since the Epoch. Must be no more than 30 days from iat.
  </li>
  <li>
    <strong>iat</strong> - REQUIRED int, time this token was issued, in seconds since the Epoch
  </li>
  <li>
    <strong>conid</strong> - OPTIONAL string, if present, this token will only authorize license fetching for a specific Video Cloud video id
  </li>
  <li>
    <strong>accid</strong>  - OPTIONAL int, integer, if present, this token will only be valid for this many license requests
    <ul>
      <li>
        For HLSe, players will make multiple requests when playing a video, typically one per rendition. The <code>maxu</code> must be set high enough to account for these additional requests.
      </li>
      <li>
        For DRM, one licence request is made per playback
      </li>
    </ul>
  </li>
  <li>
    <strong>maxip</strong> - - OPTIONAL int, integer, if present, this token will only be able to be used by this many different IP addresses
  </li>
  <li>
    <strong>ua</strong> - - OPTIONAL string, a User-Agent string, if present, this token will only be valid for requests from this User-Agent
  </li>
</ul>

<p>
  Libraries are commonly available to generate JWT tokens. For details, see the <a href="https://jwt.io/">JSON Web Tokens</a> site.
</p>

</section>

<section class="bcls-section">
<h2 id="Configure_the_player">Configure the player</h2>

<p>The token is passed with the playback request. If the token is invalid or expired, access to the content will be restricted. The player must be configured to use the token.</p>

<h3>Web player</h3>
<p>
  For details about configuring the Brightcove web player, see the Using PAS with the Web Player document.
</p>
<h3>Native Android player</h3>
<p>
  For details about configuring the native player for Android, see the <a href="http://docs.brightcove.com/en/staging/pas/using-pas-with-sdks.html">Using PAS with the Native SDKs</a> document.
</p>
<h3>Native iOS player</h3>
<p>
  For details about configuring the native player for iOS, see the <a href="http://docs.brightcove.com/en/staging/pas/using-pas-with-sdks.html">Using PAS with the Native SDKs</a> document.
</p>

</section>

<section class="bcls-section">
<h2 id="Blacklist_tokens">Blacklist tokens</h2>

<p>A token that has been blacklisted will not be considered valid for license requests, even if it would otherwise have been approved. Customers may blacklist up to 100 tokens. If 100 tokens are already blacklisted, a customer must delete one or more tokens to make room for any additional entries.</p>

<h3>Blacklist API</h3>
<p>
  The Blacklist API is used to manage your tokens which are blacklisted and considered not valid for license requests.
</p>

<h4>Base URL</h4>
<p>
  The base URL for the Blacklist API is:
</p>
<pre class="line-numbers"><code class="language-http">https://playback-auth.api.brightcove.com
</code></pre>

<h4>Account path</h4>
<p>
  In all cases, requests will be made for a specific Video Cloud Account. So, you will always add the term accounts followed by your account id to the base URL:
</p>
<pre class="line-numbers"><code class="language-http">https://playback-auth.api.brightcove.com/v1/accounts/{account_Id}/blacklist
</code></pre>

<h4>Authentication</h4>
<p>
  In all cases, requests will be made for a specific Video Cloud Account. So, you will always add the term accounts followed by your account id to the base URL:
</p>
<pre class="line-numbers"><code class="language-http">Authorization: Bearer {access_token}
</code></pre>
<p>
  The access token is a temporary OAuth2 access token that must be obtained from the Brightcove OAuth service. For details on how to obtain client credentials and use them to retrieve access tokens, see the <a href="https://support.brightcove.com/overview-oauth-api-v4">Brightcove OAuth Overview</a>.
</p>

<h4>Permissions</h4>
<p>
  Requests to the Blacklist API must be made from <a href="https://support.brightcove.com/oauth-api">client credentials</a> with the following permissions:
</p>
<ul>
  <li>
    video-cloud/playback-auth/blacklist
  </li>
</ul>

<h4>Manage blacklisted tokens</h4>
<p>
  Updates to the blacklist may take up to a minute to propagate through the system. The Blacklist API supports the following requests:
</p>

<p>
  <strong>Show current blacklist:</strong>
</p>
<pre class="line-numbers"><code class="language-http">GET /v1/accounts/{accountId}/blacklist
</code></pre>

<p>
  <strong>Add a token to the blacklist:</strong>
</p>
<pre class="line-numbers"><code class="language-http">PUT (no req body)/v1/accounts/{account_Id}/blacklist/tokens/{token}
</code></pre>
<p>
  The entire encoded JWT string is included in the path.
</p>

<p>
  <strong>Check if a token is on the blacklist:</strong>
</p>
<pre class="line-numbers"><code class="language-http">GET /v1/accounts/{account_Id}/blacklist/tokens/{token}
</code></pre>
<p>
  The entire encoded JWT string is included in the path.
</p>
<p>
  Responses:
</p>
<ul>
  <li>
    204 - the token is blacklisted
  </li>
  <li>
    404 - the token is not blacklisted
  </li>
</ul>

<p>
  <strong>Remove a token from the blacklist:</strong>
</p>
<pre class="line-numbers"><code class="language-http">DELETE /v1/accounts/{account_Id}/blacklist/tokens/{token}
</code></pre>
<p>
  The entire encoded JWT string is included in the path.
</p>

</section>

<section class="bcls-section">
<h2 id="Limitations">Limitations</h2>

<p>The following limitations apply with the initial release of this feature:</p>
<ul>
  <li>
    There is a limit of 100 blacklisted tokens. After that, an error will be thrown.
  </li>
  <li>
    For HLSe (AES-128), the token will be appended to the master manifest request, and will propagate to the encryption key URL. Because these URLs are appended to the master manifest, customers should consider restricting the number of uses to minimize exposure of their content.
  </li>
  <li>
    For HLSe (AES-128), players will make mutlitple requests when playing a video, typically one per rendition. The maxu claim needs to be set high enough to account for these requests. You should consider additional claims to minimize the exposure of your content. Switching renditions will request a new license.
  </li>
</ul>

</section>

</article>


<!-- END DRUPAL CONTENT -->
</div>
</div>
<!-- bcl scripts -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
<script src="/en/scripts/docs-nav-data.min.js"></script>
<script src="/en/scripts/bcls-doc-site-v3.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
<script>
$(document).foundation();
</script>
<!-- Any scripts specific to page samples should go here -->
</body>

</html>
