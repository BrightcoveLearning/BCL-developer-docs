<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Begin Drupal Taxonomy Data -->
    <meta name="products" content="Video Cloud, Brightcove Player">
    <meta name="role" content="Device SDK Developer">
    <meta name="task" content="Develop with the Native SDKs">
    <meta name="topic" content="Troubleshooting/Error Handling">
    <meta name="sdk" content="iOS,tvOS,Android">
    <meta name="keywords" content="device,SDK,FAQ">
    <!-- End Drupal Taxonomy Data -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Video Cloud SSAI with the Native Player SDKs</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Video Cloud SSAI with the Native Player SDKs</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a INTERNAL document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <p>In this topic, you will learn how to play Server-Side ads from videos ingested for Dynamic Delivery with the Brightcove Native Player SDKs.</p>


	    <!-- BEGIN DRUPAL CONTENT -->

      <article class="bcls-article">
      <section id="top" class="bcls-section">
      <aside class="bcls-aside bcls-aside--information">Notes:
        <ul>
          <li>To use this plugin, your Video Cloud account will need to be configured for <a href="https://www.brightcove.com/en/blog/2017/03/digital-rights-management-drm-dynamic-delivery">Dynamic Delivery</a>. Contact your account manager if you are
            interested in converting your account to Dynamic Delivery.</li>
            <li>
              SSAI supports Live playback.
            </li>
            <li>
              SSAI works with Video-on-Demand (VOD) for a limited availability.
            </li>
            <li>
              For a list of limitations, see the <a href="http://docs.brightcove.com/en/staging/ssai-overview.html#Limitations">SSAI Overview</a> document.
            </li>
        </ul>
      </aside>
      </section>

      <section class="bcls-section">
      <h2 id="Overview">Overview</h2>

      <p>Server-Side Ad Insertion (SSAI) allows you to embed ads into your videos so that they can't be blocked by ad blockers in the browser. Dynamic Delivery is the next generation ingest and delivery system which reduces your storage footprint and dynamically packages media. Learn more about using <a href="https://www.brightcove.com/en/blog/2017/03/digital-rights-management-drm-dynamic-delivery">Dynamic Delivery</a> for your videos.</p>

      <p>SSAI works with both DRM and non-DRM content.</p>

      <figure class="bcls-figure"><img class="bcls-image--no-border" alt="Server-side ad" src="//learning-services-media.brightcove.com/doc-assets/device-sdks/guides/ssai/ssai-sdk.png" />
      <figcaption class="bcls-caption--image">Server-side ad</figcaption>
      </figure>

      <p>To play server-side ads with your video content stored in Video Cloud, follow these steps:</p>

      <ol class="bcls-tasklist">
      	<li><a href="#Create_an_ad_configuration">Create an ad configuration</a></li>
      	<li>
      	<p>Include the Once UX plugin in your app:</p>

      	<ul>
      		<li><a href="#iOS_implementation">iOS implementation</a></li>
      		<li><a href="#Android_implementation">Android implementation</a></li>
      	</ul>
      	</li>
        <li><a href="#Play_a_video_with_ads">Play a video with ads</a></li>
      </ol>
      </section>

      <section class="bcls-section">
      <h2 id="Create_an_ad_configuration">Create an ad configuration</h2>

      <p>The ad configuration defines various aspects of SSAI playback, including a URL to your Video Multiple Ad Playlist (VMAP) file, beacons, and other configurations. For now, you must contact your Brightcove account manager to create your ad configuration.</p>
      </section>

      <section class="bcls-section">
      <h2 id="iOS_implementation">iOS implementation</h2>

      <p>Follow these steps within your app to get your ad configuration and play your video:</p>

      <ol class="bcls-tasklist__restart">
      	<li>Include the Once UX plugin in your app, as shown in the <a href="https://github.com/BrightcoveOS/ios-player-samples/tree/master/OUX">Basic Once UX Player</a> sample. This will be the starting point for your app. Notice that the storyboard contains the definitions for the <code>videoContainerView</code> and the <code>companionSlotContainerView</code>.</li>
        <li>
          In Xcode, open the <strong>ViewController.m</strong> file.
        </li>
        <li>
          Comment out or delete the following code:
<pre class="line-numbers"><code class="language-objectivec">static NSString *kViewControllerVideoURLString = @&quot;http://onceux.unicornmedia.com/now/ads/vmap/od/auto/c6589dd5-8f31-4ae3-8a5f-a54ca3d7c973/632f6399-9e87-4ce2-a7c0-39209be2b5d0/bee45a63-71ea-4a20-800f-b67091867eeb/content.once&quot;;
...
// Create video
BCOVVideo *video = [BCOVVideo videoWithURL:[NSURL URLWithString:kViewControllerVideoURLString]];
[self.controller setVideos:@[video]];
</code></pre>
        </li>
      	<li>Define constants for your account id, policy key, video id, and your ad configuration id.
<pre class="line-numbers"><code class="language-objectivec">static NSString *accountId = @&quot;<span class="bcls-input">your account id</span>&quot;;
static NSString *policyKey = @&quot;<span class="bcls-input">your policy key</span>&quot;;
static NSString *videoId = @&quot;<span class="bcls-input">your video id</span>&quot;;
static NSString *adConfigId = @&quot;<span class="bcls-input">your ad configuration id</span>&quot;;
</code></pre>

      	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="https://support.brightcove.com/node/18125">Policy Keys</a> document.</aside>
      	</li>
        <li>
          Define the <code>BCOVPlaybackService</code> class, which provides asynchronous methods for retrieving data from the Playback API.
<pre class="line-numbers"><code class="language-objectivec">@interface ViewController () &lt;BCOVPlaybackControllerDelegate&gt;
@property (nonatomic, strong) id&lt;BCOVPlaybackController&gt; controller;
<span class="bcls-highlight">@property (nonatomic, strong) BCOVPlaybackService *playbackService;</span>
@property (nonatomic) BCOVPUIPlayerView *playerView;
@property (weak, nonatomic) IBOutlet UIView *videoContainerView;
@property (weak, nonatomic) IBOutlet UIView *companionSlotContainerView;

@end</code></pre>
        </li>
      	<li>In the <code>viewDidLoad</code> method, set the query parameter value to your ad configuration id.
<pre class="line-numbers">
<code class="language-objectivec">NSDictionary *queryParameters = @{
  @&quot;ad_config_id&quot; : adConfigId
};
</code></pre>
      	</li>
      	<li>Create an instance of the <code>BCOVPlaybackService</code>.
<pre class="line-numbers">
<code class="language-objectivec">self.playbackService = [[BCOVPlaybackService alloc]
  initWithAccountId:accountId
  policyKey:policyKey];</code></pre>
      	</li>
      	<li>Call the <code>playbackService</code> to retrieve your video along with your ad configuration from the Playback API. Start video playback with your specified ads.
<pre class="line-numbers">
<code class="language-objectivec">[self.playbackService findVideoWithVideoID:videoId parameters:queryParameters completion:^(BCOVVideo *video, NSDictionary *jsonResponse, NSError *error) {
  {
    if (error == nil)
    {
      // play it.
      [self.controller setVideos: @[ video ]];
    }
    else
    {
      NSLog (@&quot;Error! Playback Service says: %@&quot;,
             error.localizedDescription);
    }
  }
}];</code></pre>
      	</li>
      </ol>

<h3 id="Complete_ViewController_m_code" class="bcls-expander-head">Complete ViewController.m code</h3>
<div class="bcls-expander-content">
  <pre class="line-numbers"><code class="language-objectivec">//
//  ViewController.m
//  SSAI with Video Id
//
//  Created on 3/8/18.
//  Copyright &copy; 2018 Brightcove. All rights reserved.
//

#import &quot;ViewController.h&quot;

@import BrightcovePlayerSDK;
@import BrightcoveOUX;

NSString *accountId = @&quot;<span class="bcls-input">your account Id</span>&quot;;
NSString *policyKey = @&quot;<span class="bcls-input">your policy key</span>&quot;;
NSString *videoId = @&quot;<span class="bcls-input">your video Id</span>&quot;;
NSString *adConfigId = @&quot;<span class="bcls-input">your ad configuration Id</span>&quot;;

@interface ViewController () &lt;BCOVPlaybackControllerDelegate&gt;
@property (nonatomic, strong) id&lt;BCOVPlaybackController&gt; playbackController;
@property (nonatomic, strong) BCOVPlaybackService *playbackService;
@property (nonatomic) BCOVPUIPlayerView *playerView;
@property (weak, nonatomic) IBOutlet UIView *videoContainerView;
@property (weak, nonatomic) IBOutlet UIView *companionSlotContainerView;

@end

@implementation ViewController

- (void)viewDidLoad {
  [super viewDidLoad];
  // Do any additional setup after loading the view, typically from a nib.
  BCOVPlayerSDKManager *manager = [BCOVPlayerSDKManager sharedManager];

  // Create a companion slot.
  BCOVOUXCompanionSlot *companionSlot = [[BCOVOUXCompanionSlot alloc] initWithView:self.companionSlotContainerView width:500 height:61];

  // In order to display an ad progress banner on the top of the view, we create this display container.  This object is also responsible for populating the companion slots.
  BCOVOUXAdComponentDisplayContainer *adComponentDisplayContainer = [[BCOVOUXAdComponentDisplayContainer alloc]   initWithCompanionSlots:@[companionSlot]];

  self.playbackController = [manager createOUXPlaybackControllerWithViewStrategy:nil];

  // In order for the ad display container to receive ad information, we add it as a session consumer.
  [self.playbackController addSessionConsumer:adComponentDisplayContainer];

  self.playbackController.delegate = self;
  self.playbackController.autoPlay = YES;

  BCOVPUIBasicControlView *controlView = [BCOVPUIBasicControlView basicControlViewWithVODLayout];
  // Set playback controller later.
  self.playerView = [[BCOVPUIPlayerView alloc] initWithPlaybackController:nil options:nil controlsView:controlView];
  self.playerView.frame = self.videoContainerView.bounds;
  self.playerView.autoresizingMask = UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleWidth;
  [self.videoContainerView addSubview:self.playerView];

  self.playerView.playbackController = self.playbackController;

  NSDictionary *queryParameters = @{
                                @&quot;ad_config_id&quot; : adConfigId
                                };

  self.playbackService = [[BCOVPlaybackService alloc]
                      initWithAccountId:accountId
                      policyKey:policyKey];

  [self.playbackService findVideoWithVideoID:videoId parameters:queryParameters completion:^(BCOVVideo *video, NSDictionary *jsonResponse, NSError *error) {
    {
        if (error == nil)
        {
            // play it.
            [self.playbackController setVideos: @[ video ]];
        }
        else
        {
            NSLog (@&quot;Error! Playback Service says: %@&quot;,
                   error.localizedDescription);
        }
    }
  }];
}

#pragma mark BCOVPlaybackControllerBasicDelegate

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller didAdvanceToPlaybackSession:(id&lt;BCOVPlaybackSession&gt;)session
{
  NSLog(@&quot;ViewController Debug - Advanced to new session.&quot;);
}

#pragma mark BCOVPlaybackControllerAdsDelegate

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didEnterAdSequence:(BCOVAdSequence *)adSequence
{
  NSLog(@&quot;ViewController Debug - Entering ad sequence&quot;);
}

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didExitAdSequence:(BCOVAdSequence *)adSequence
{
  NSLog(@&quot;ViewController Debug - Exiting ad sequence&quot;);
}

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didEnterAd:(BCOVAd *)ad
{
  NSLog(@&quot;ViewController Debug - Entering ad&quot;);
}

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didExitAd:(BCOVAd *)ad
{
  NSLog(@&quot;ViewController Debug - Exiting ad&quot;);
}

- (void)didReceiveMemoryWarning {
  [super didReceiveMemoryWarning];
  // Dispose of any resources that can be recreated.
}
@end</code></pre>
</div>
<br />

          <aside class="bcls-aside bcls-aside--tip">
            <p>
              Events associated with Server-side ad insertion include the following:
            </p>
            <ul>
              <li>
                <a href="https://github.com/brightcove/brightcove-player-sdk-ios-oux/blob/master/ios/dynamic/BrightcoveOUX.framework/Headers/BCOVOUXConstants.h">Lifecycle events that are specific to Once UX</a>
              </li>
              <li>
                <a href="https://github.com/brightcove/brightcove-player-sdk-ios/blob/master/ios/dynamic/BrightcovePlayerSDK.framework/Headers/BCOVAdvertising.h">Lifecycle events associated with ads</a>
              </li>
            </ul>
          </aside>

      </section>

      <section class="bcls-section">
      <h2 id="Android_implementation">Android implementation</h2>

      <p>Follow these steps within your app to get your ad configuration and play your video:</p>

        <ol class="bcls-tasklist__restart">
        	<li>Include the Once UX plugin in your app. For details, see the <a href="https://github.com/BrightcoveOS/android-player-samples/tree/master/brightcove-exoplayer/BasicOnceUxSampleApp">Basic Once UX Player</a> sample.</li>
        	<li>Define constants for your account id, policy key, video id or video reference id, and your ad configuration id.
<pre class="line-numbers">
<code class="language-java">String accountId = "&lt;accountId&gt;";
String policyKey = "&lt;policyKey&gt;";
String videoRef = "&lt;videoRef&gt;";
String adConfigId = "&lt;adConfigId&gt;";
</code></pre>

        	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="https://support.brightcove.com/node/18125">Policy Keys</a> document.</aside>
        	</li>
        	<li>Set the query parameter value to your ad configuration id.
<pre class="line-numbers">
<code class="language-java">Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
parameters.put("ad_config_id", adConfigId);
</code></pre>
        	</li>
        	<li>Create an instance of the catalog service.
<pre class="line-numbers">
<code class="language-java">Catalog catalog = new Catalog(brightcoveVideoView.getEventEmitter(), accountId, policyKey);
</code></pre>
        	</li>
        	<li>Call the catalog service to retrieve your video along with your ad configuration from the Playback API.
<pre class="line-numbers">
<code class="language-java">catalog.findVideoByReferenceID(videoRef, null, parameters, new VideoListener() {
  ...
});
</code></pre>
        	</li>
        	<li>Start video playback with your specified ads.
<pre class="line-numbers">
<code class="language-java">@Override
public void onVideo(Video video) {
  try {
    // The OnceUX plugin will look for a VMAP URL in the video object properties.
    // If valid, it will play the video.
    plugin.processVideo(video);
  } catch (NoSourceFoundException e) {
    // If NoSourceFoundException is thrown it means a suitable VMAP URL was not found.
    // You can try to play it on a regular view
    brightcoveVideoView.add(video);
  }
}
</code></pre>
        	</li>
        </ol>

        <p>Here is the complete code block:</p>

<pre class="line-numbers">
<code class="language-java">@Override
protected void onCreate(Bundle savedInstanceState) {
  setContentView(R.layout.activity_main);
  brightcoveVideoView = (BrightcoveVideoView) findViewById(R.id.brightcove_video_view);
  super.onCreate(savedInstanceState);

  final OnceUxComponent plugin = new OnceUxComponent(this, brightcoveVideoView);
  Catalog catalog = new Catalog(brightcoveVideoView.getEventEmitter(), accountId, policyKey);

  Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
  parameters.put("ad_config_id", adConfigId);
  catalog.findVideoByReferenceID(videoRef, null, parameters, new VideoListener() {
    @Override
    public void onVideo(Video video) {
      try {
        // The OnceUX plugin will look for a VMAP URL in the video object properties.
        // If valid, it will play the video.
        plugin.processVideo(video);
      } catch (NoSourceFoundException e) {
        // If NoSourceFoundException is thrown it means a suitable VMAP URL was not found.
        // You can try to play it on a regular view,
        brightcoveVideoView.add(video);
      }
    }
  });
}
</code></pre>

              <aside class="bcls-aside bcls-aside--tip">
                <p>
                  Events associated with Server-side ad insertion include the following:
                </p>
                <ul>
                  <li>
                    <a href="https://brightcovelearning.github.io/Brightcove-API-References/android-sdk/javadoc/index.html?com/brightcove/onceux/event/package-summary.html">Lifecycle events that are specific to Once UX</a>
                  </li>
                  <li>
                    <a href="https://brightcovelearning.github.io/Brightcove-API-References/android-sdk/javadoc/com/brightcove/player/event/EventType.html">Lifecycle events associated with ads</a>
                  </li>
                </ul>
              </aside>

          </section>

          <section class="bcls-section">
          <h2 id="Play_a_video_with_ads">Playing a video with ads</h2>
            <p>
            Any video that you retrieve from Video Cloud that has been ingested with Dynamic Delivery, will include the ads specified in the VMAP file in your ad configuration.
            </p>
            <aside class="bcls-aside bcls-aside--information">Currently, Server-side ad insertion will not respect the Advertising property (Free or Ad Supported) set in Video Cloud's Media module.</aside>
          </section>
          <br />
      </article>

      <!-- END DRUPAL CONTENT -->
		</div>
	</div>
	<!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
  $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
</body>

</html>
