<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Begin Drupal Taxonomy Data -->
    <meta name="products" content="Video Cloud, Brightcove Player">
    <meta name="role" content="Device SDK Developer">
    <meta name="task" content="Develop with the Native SDKs">
    <meta name="topic" content="Troubleshooting/Error Handling">
    <meta name="sdk" content="iOS,tvOS,Android">
    <meta name="keywords" content="device,SDK,FAQ">
    <!-- End Drupal Taxonomy Data -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Migrating to ExoPlayer 2 Framework</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Migrating to ExoPlayer 2 Framework</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <p>In this topic, you will learn how to use the ExoPlayer 2 framework with the Brightcove Native Player SDK for Android.</p>


	    <!-- BEGIN DRUPAL CONTENT -->

      <article class="bcls-article">
      <section class="bcls-section"><!-- <h2 id="Player_example">Player example</h2> -->

      <p>Learn how to migrate for the following project types:</p>

      <ul>
      	<li><a href="#New_project">New project</a></li>
      	<li><a href="#Existing_ExoPlayer_1_project">Existing ExoPlayer 1 project</a></li>
      	<li><a href="#Existing_MediaPlayer_project">Existing MediaPlayer project</a></li>
      </ul>

      <p>Refer to the <a href="https://github.com/BrightcoveOS/android-player-samples/tree/ExoPlayer2/brightcove-exoplayer">ExoPlayer sample applications</a> for additional guidance on integrating the <a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2</a> framework into your project.</p>
      <aside class="bcls-aside bcls-aside--information">When compiling the <code>exoplayer2</code> in the <code>dependencies</code> section of the <strong>build.gradle</strong> file, the <code>transitive</code> option must be set to <code>true</code> so that gradle will automatically include other dependencies such as the offline-playback plugin.</aside>
      </section>

      <section class="bcls-section">
      <h2 id="New_project">New project</h2>

      <p>Follow these steps to add ExoPlayer 2 to a new Android project:</p>

      <ol class="bcls-tasklist">
      	<li>In your <strong>build.gradle</strong> file, add the following compile dependency:

      	<pre class="line-numbers">
<code class="language-java">dependencies {
    compile "com.brightcove.player:exoplayer2:${brightcoveAndroidSdkVersion}" {transitive = true}
}</code></pre>
      	</li>
      	<li>If you are using an evironment variable for the SDK version, then open the <strong>gradle.properties</strong> file, and set the current version value for the Native SDK for Android beta. It should look similar to this:
      	<pre class="line-numbers">
<code class="language-java">brightcoveAndroidSdkVersion=6.0.0-Beta1</code></pre>
      	</li>
      </ol>
      </section>

      <section class="bcls-section">
      <h2 id="Existing_ExoPlayer_1_project">Existing ExoPlayer 1 project</h2>

      <p>Follow these steps to update an existing ExoPlayer 1 project to use the ExoPlayer 2 framework:</p>

      <ol class="bcls-tasklist__restart">
      	<li>In your <strong>build.gradle</strong> file, update Android support libraries:

      	<pre class="line-numbers">
<code class="language-java">compile 'com.android.support:appcompat-v7:25.4.0'
compile 'com.android.support:support-v4:25.4.0'
compile 'com.android.support:recyclerview-v7:25.4.0'
compile 'com.android.support:support-vector-drawable:25.4.0'
</code></pre>
      	</li>
      	<li>In your <strong>build.gradle</strong> file, update Android Build Tools:
      	<pre class="line-numbers">
<code class="language-java">buildToolsVersion "25.0.3"
</code></pre>
      	</li>
      	<li>In your <strong>build.gradle</strong> file, add the Google Maven Repository:
      	<pre class="line-numbers">
<code class="language-java">maven {
     url 'https://maven.google.com'
}
</code></pre>
      	</li>
      	<li>If your project uses advertising with Google IMA, update Google Play Services Ads:
      	<pre class="line-numbers">
<code class="language-java">compile 'com.google.android.gms:play-services-ads:11.0.4'
</code></pre>

      	<aside class="bcls-aside bcls-aside--information">It is important to note here that the Brightcove Native Player SDK for Android does not support applications that attempt to use both ExoPlayer and ExoPlayer 2.</aside>
      	</li>
      	<li>Where you previously imported the Brightcove ExoPlayer library as a dependency in build.gradle:
      	<pre class="line-numbers">
<code class="language-java">dependencies {
    compile "com.brightcove.player:exoplayer:${brightcoveAndroidSdkVersion}"
}
</code></pre>

      	<p>Change the name of the dependency:</p>

      	<pre class="line-numbers">
<code class="language-java">dependencies {
    compile "com.brightcove.player:exoplayer2:${brightcoveAndroidSdkVersion}" {transitive = true}
}
</code></pre>
      	</li>
      	<li>If you are using an evironment variable for the SDK version, then open the <strong>gradle.properties</strong> file, and set the current version value for the Native SDK for Android beta. It should look similar to this:
      	<pre class="line-numbers">
<code class="language-java">brightcoveAndroidSdkVersion=6.0.0-Beta1</code></pre>

      	<p>There should be no additional coding required to integrate ExoPlayer 2 into your project.</p>
      	</li>
      </ol>
      </section>

      <section class="bcls-section">
      <h2 id="Existing_MediaPlayer_project">Existing MediaPlayer project</h2>

      <p>Follow these steps to update an existing MediaPlayer project to use the ExoPlayer 2 framework:</p>

      <ol class="bcls-tasklist__restart">
      	<li>In your <strong>build.gradle</strong> file, add the following compile dependency:

      	<pre class="line-numbers">
<code class="language-java">dependencies {
    compile "com.brightcove.player:exoplayer2:${brightcoveAndroidSdkVersion}" {transitive = true}
}</code></pre>
      	</li>
      	<li>If you are using an evironment variable for the SDK version, then open the <strong>gradle.properties</strong> file, and set the current version value for the Native SDK for Android beta. It should look similar to this:
      	<pre class="line-numbers">
<code class="language-java">brightcoveAndroidSdkVersion=6.0.0-Beta1</code></pre>
      	</li>
      	<li>In your app, use the <a href="https://brightcovelearning.github.io/Brightcove-API-References/android-sdk/javadoc/com/brightcove/player/view/BrightcoveExoPlayerVideoView.html">BrightcoveExoPlayerVideoView</a> instead of the <a href="https://brightcovelearning.github.io/Brightcove-API-References/android-sdk/javadoc/com/brightcove/player/view/BrightcoveVideoView.html">BrightcoveVideoView</a>, which uses the Android Media Player.</li>
      </ol>
      </section>

      <section class="bcls-section">
      <h2 id="Breaking_changes">Breaking changes</h2>

      <p>The following changes to the Brightcove Native SDK for Android are breaking changes with the ExoPlayer 2. Use of the ExoPlayer 1 has been deprecated with the Brightcove Native SDK.</p>
      <h3>ExoPlayerVideoDisplayComponent internal listeners</h3>
      <p>
        The <code>ExoPlayerVideoDisplayComponent</code> class allows you to set listeners to get the status of the ExoPlayer components. Below is a list of some of the listeners:
      </p>
      <table class="bcls-table">
          <thead class="bcls-table__head">
              <tr>
                  <th>Set the listener</th>
                  <th>Receive status info about</th>
              </tr>
          </thead>
          <tbody class="bcls-table__body">
              <tr>
                  <td>setDebugListener</td>
                  <td>InfoListener</td>
              </tr>
              <tr>
                  <td>setCaptionListener</td>
                  <td>CaptionListener</td>
              </tr>
              <tr>
                  <td>setMetadataListener</td>
                  <td>MetadataListener</td>
              </tr>
              <tr>
                  <td>setInternalErrorListener</td>
                  <td>InternalErrorListener</td>
              </tr>
          </tbody>
      </table>
      <p>
        Below are recommendations for using the ExoPlayer 2.
      </p>

      <h4>InfoListener</h4>
      <p>
        For the <code>InfoListener</code> interface, the following changes were made:
      </p>
      <ul>
        <li>
          The <code>onAvailableRangeChanged</code> method was removed
        </li>
        <li>
          The <code>onLoadStarted</code> method has an additional <code>length</code> parameter
        </li>
      </ul>
      <p>
        Example: ExoPlayerVideoDisplayComponent using ExoPlayer 2
      </p>
      <pre class="line-numbers">
<code class="language-java">public interface InfoListener {
   void onVideoFormatEnabled(Format format, int trigger, long mediaTimeMs);
   void onAudioFormatEnabled(Format format, int trigger, long mediaTimeMs);
   void onDroppedFrames(int count, long elapsed);
   void onBandwidthSample(int elapsedMs, long bytes, long bitrateEstimate);
   void onLoadStarted(int sourceId, int type, int trigger, Format format,
              long mediaStartTimeMs, long mediaEndTimeMs);
   void onLoadCompleted(int sourceId, long bytesLoaded, int type, int trigger, Format format,
              long mediaStartTimeMs, long mediaEndTimeMs, long elapsedRealtimeMs, long loadDurationMs);
   void onDecoderInitialized(String decoderName, long initializedTimestampMs,
              long initializationDurationMs);
}</code></pre>

        <h4>CaptionListener</h4>
        <p>
          The <code>CaptionListener</code> interface is unchanged.
        </p>
        <p>
        Example: ExoPlayerVideoDisplayComponent using ExoPlayer v2
      </p>
        <pre class="line-numbers">
<code class="language-java">public interface CaptionListener {
  void onCues(List&lt;Cue&gt; cues);
}</code></pre>

        <h4>MetadataListener</h4>
        <p>
          The <code>MetadataListener</code> interface was introduced with ExoPlayer v2. The previous use of the <code>Id3MetadataListener</code> is now deprecated.
        </p>
        <p>
        Example: ExoPlayerVideoDisplayComponent using ExoPlayer v2
        </p>
        <pre class="line-numbers">
<code class="language-java">public interface MetadataListener {
   void onMetadata(Metadata metadata);
}</code></pre>
        <p>
          With the new <code>MetadataListener</code> you will receive a <code>Metadadata</code> object in the <code>onMetadata</code> callback. With the deprecated <code>Id3MetadataListener</code>, you received a list of <code></code>Id3Frame objects. With the new listener, you can still get a list of <code>Id3Frame</code> objects as shown below:
        </p>
        <pre class="line-numbers">
<code class="language-java">exoPlayerVideoDisplayComponent.setMetadataListener(new ExoPlayerVideoDisplayComponent.MetadataListener() {
   @Override
   public void onMetadata(Metadata metadata) {
       for(int i = 0; i &lt; metadata.length(); i++) {
           Metadata.Entry entry = metadata.get(i);
           if (entry instanceof Id3Frame) {
               Id3Frame id3Frame = (Id3Frame) entry;
           }
       }
   }
});
</code></pre>

        <h4>InternalErrorListener</h4>
        <p>
          The <code>InternalErrorListener</code> interface has many changes. Please check the code below for comparison:
        </p>
        <p>
        ExoPlayerVideoDisplayComponent using ExoPlayer v2
        </p>
        <pre class="line-numbers">
<code class="language-java">public interface InternalErrorListener {
   void onPlayerError(Exception e);
   void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
   void onLoadError(int sourceId, IOException e);
   void onDrmSessionManagerError(Exception e);
}
</code></pre>
        <p>
        ExoPlayerVideoDisplayComponent using ExoPlayer v1 (<strong>deprecated</strong>)
        </p>
        <pre class="line-numbers">
<code class="language-java">public interface InternalErrorListener {
   void onRendererInitializationError(Exception e);
   void onAudioTrackInitializationError(AudioTrack.InitializationException e);
   void onAudioTrackWriteError(AudioTrack.WriteException e);
   void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
   void onDecoderInitializationError(MediaCodecTrackRenderer.DecoderInitializationException e);
   void onCryptoError(MediaCodec.CryptoException e);
   void onLoadError(int sourceId, IOException e);
   void onDrmSessionManagerError(Exception e);
}
</code></pre>

        <p>
          When using ExoPlayer 2, the type of exception you get in <code>onPlayerError(Exception e)</code> is <code>com.google.android.exoplayer2.ExoPlaybackException</code>, but this may change in the future.
        </p>
        <p>
          By using com.google.android.exoplayer2.ExoPlaybackException, you can get the following exception types:
        </p>
        <ul>
          <li>
            <code>ExoPlaybackException.TYPE_SOURCE</code>
          </li>
          <li>
            <code>ExoPlaybackException.TYPE_RENDERER</code>
          </li>
          <li>
            <code>ExoPlaybackException.TYPE_UNEXPECTED</code>
          </li>
        </ul>
        <p>
          You can also retrieve the cause of the error by getting the <code>Throwable</code> object with <code>ExoPlaybackException.getSourceException()</code>.
        </p>

      </section>

      <section class="bcls-section">
      <h2 id="Additional_Resources">Additional Resources</h2>

      <p>For more information about using the ExoPlayer 2 framework, see the following documents:</p>

      <ul>
      	<li><a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2 - New package and class names</a></li>
      	<li><a href="https://google.github.io/ExoPlayer/guide.html">ExoPlayer developer guide</a></li>
      </ul>
      </section>
      </article>







      <!-- END DRUPAL CONTENT -->
		</div>
	</div>
	<!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
  $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
</body>

</html>
