<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Selecting Captions Programmatically with the Native SDK for Android</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Selecting Captions Programmatically with the Native SDK for Android</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <summary>In this topic, you will learn how to programmatically select captions when using the Brightcove Native SDK for Android.</summary>


	    <!-- BEGIN DRUPAL CONTENT -->


  <article class="bcls-article">
  <section class="bcls-section">
    <h2 id="Overview">Overview</h2>
    <p>
      The Native SDK for Android receives captions from either of the following:
    </p>
    <ul>
    	<li>Brightcove catalog response (Playback API) : Sidecar WebVTT</li>
    	<li>Video manifest (HLS or DASH) : In-manifest WebVTT</li>
    </ul>
    <p>
      For more information about captions, see the <a href="https://sdks.support.brightcove.com/features/using-captions-brightcove-native-sdks.html">Using Captions with the Brightcove Native SDKs</a> document.
    </p>
  </section>

  <section class="bcls-section">
    <h2 id="Event_sequence">Event sequence</h2>
    <p>
      The Native SDK follows this event sequence associated with captions:
    </p>
    <ol class="bcls-tasklist">
      <li>
        <p>
          Retrieve a video from the Brightcove catalog (ie. <code>catalog.findVideoByID()</code>).
        </p>
      </li>
      <li>
        <p>
          Sidecar captions are parsed from the catalog response and added to the video properties.
        </p>
      </li>
      <li>
        <p>
          At this point, you can retrieve caption sources as follows:
        </p>
        <pre><code class="language-java">video.getProperties().get(Video.Fields.CAPTION_SOURCES);</code></pre>
      </li>
      <li>
        <p>
          Set the video view. The video is added to ExoPlayer.
        </p>
        <pre><code class="language-java">brightcoveVideoView.add(video);</code></pre>
      </li>
      <li>
        <p>
          The Native SDK gets caption sources and emits the following event:
        </p>
        <pre><code class="language-java">EventType.CAPTIONS_LANGUAGES</code></pre>
      </li>
      <li>
        <p>
          After the video is added to ExoPlayer, the Native SDK looks for in-manifest captions. Any captions not already present in the video caption sources are added. If there are new caption sources, the following event is sent to update the Brightcove media controller.
        </p>
        <pre><code class="language-java">EventType.CAPTIONS_LANGUAGES</code></pre>
      </li>
    </ol>
  </section>

  <section class="bcls-section">
    <h2 id="Select_captions">Select captions</h2>
    <p>
      Follow these steps to select captions programmatically:
    </p>
    <ol class="bcls-tasklist__restart">
      <li>
        <p>
          Create a method to find an specific caption source with the language code. For example:
        </p>
        <pre><code class="language-java">private Pair&lt;Uri, BrightcoveCaptionFormat&gt; getCaptionsForLanguageCode(Video video, String languageCode) {
   Object payload = video == null ? null : video.getProperties().get(Video.Fields.CAPTION_SOURCES);

 if (payload instanceof List) {
   @SuppressWarnings(&quot;unchecked&quot;)
   List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt; pairs =
      (List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt;) payload;

   for (Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair : pairs) {
     if (pair.second.language().equals(languageCode)) {
       return pair;
     }
   }
 }
 return null;
}</code></pre>
      </li>
      <li>
        <p>
          Notice that caption sources are in <code>Pair&lt;Uri, BrightcoveCaptionFormat&gt;</code>. The <code>Uri</code> in the pair indicates the type closed captions:
        </p>
        <ul>
          <li>
            <strong>Sidecar</strong>: The full URL is present
          </li>
          <li>
            <strong>In-manifest</strong>: The BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME is used
          </li>
        </ul>
      </li>
      <li>
        <p>
          Create a method responsible for selecting closed captions from a video with a given language code, by emitting the <code>EventType.SELECT_CLOSED_CAPTION_TRACK</code> event.
        </p>
        <pre><code class="language-java">private void selectCaption(Video video, String language) {
   Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair = getCaptionsForLanguageCode(video, language);

 if (pair != null &amp;&amp; !pair.first.equals(Uri.EMPTY)) {
   // BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME indicates that is not a URL we need to load with the LoadCaptionsService, but instead we'll be enabled through a different component.
   if (!pair.first.toString().startsWith(BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME)) {
     brightcoveVideoView.getClosedCaptioningController().getLoadCaptionsService().loadCaptions(pair.first, pair.second.type());
   }
   Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
   properties.put(Event.CAPTION_FORMAT, pair.second);
   properties.put(Event.CAPTION_URI, pair.first);
   brightcoveVideoView.getEventEmitter().emit(EventType.SELECT_CLOSED_CAPTION_TRACK, properties);
 }
}</code></pre>
      </li>
      <li>
        <p>
          Listen to the <code>EventType.CAPTIONS_LANGUAGES</code> event and select the desired language by the language code.
        </p>
        <pre><code class="language-java">brightcoveVideoView.getEventEmitter().once(EventType.CAPTIONS_LANGUAGES, new EventListener() {
 @Override
 public void processEvent(Event event) {
   brightcoveVideoView.setClosedCaptioningEnabled(true);

    // You could find the desired languaged in the LANGUAGES list.
    // List&lt;String&gt; languages = event.getProperty(Event.LANGUAGES, List.class);
   selectCaption(brightcoveVideoView.getCurrentVideo(), &quot;ja&quot;);
 }
});</code></pre>
      </li>

    </ol>
  </section>

  </article>

  <!-- END DRUPAL CONTENT -->
    </div>
  </div>
  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v3.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
  <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
  <script>
  $(document).foundation();
  </script>
  <!-- Any scripts specific to page samples should go here -->
  <script src="https://learning-services-media.brightcove.com/doc-assets/js/https-fix.js"></script>
<script src="https://learning-services-media.brightcove.com/doc-assets/js/support-feedback.js"></script><script src="https://learning-services-media.brightcove.com/doc-assets/site-assets/js/site/feedback-docs.js"></script>
</body>

  </html>
