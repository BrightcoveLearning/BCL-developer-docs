<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Begin Drupal Taxonomy Data -->
    <meta name="products" content="Video Cloud, Brightcove Player">
    <meta name="role" content="Device SDK Developer">
    <meta name="task" content="Develop with the Native SDKs">
    <meta name="topic" content="Troubleshooting/Error Handling">
    <meta name="sdk" content="iOS,tvOS,Android">
    <meta name="keywords" content="device,SDK,FAQ">
    <!-- End Drupal Taxonomy Data -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>The SSAI Plugin for the Native SDK for Android</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>The SSAI Plugin for the Native SDK for Android</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <p>In this topic, you will learn how to use the Server-Side Ad Insertion (SSAI) plugin with the Brightcove Native SDK for Android. It also details how to migrate from using the OnceUX plugin.</p>
      <!-- <aside class="bcls-aside bcls-aside--information">The content in this document applies to Video Cloud only.</aside> -->


	    <!-- BEGIN DRUPAL CONTENT -->

<article class="bcls-article">
<section class="bcls-section">
<h2 id="Using_the_SSAI_Plugin">Using the SSAI Plugin</h2>

<p>The SSAI plugin allows you to play content with Dynamic Delivery and Server-Side Advertising.</p>
<p>
  In order to play content with SSAI, there are two options:
</p>
<ol class="bcls-tasklist">
	<li><a href="#Provide_a_URL_for_SSAI_content">Provide a URL for SSAI content</a></li>
  <li>
    <a href="#Provide_a_Video_with_VMAP">Provide a Video with VMAP</a>
  </li>
</ol>
<p>
  In either case, the SSAI plugin will request the VMAP source, parse it and automatically add it to the VideoView.
</p>

<h3 id="Provide_a_URL_for_SSAI_content">Provide a URL for SSAI content</h3>
<p>
  With an SSAI asset URL, call the following method:
</p>
<pre><code class="language-java">SSAIComponent.processVideo(String url)</code></pre>
<p>
  Here is an example:
</p>
<pre class="line-numbers"><code class="language-java">String ssaiUrl = &quot;https://onceux.host.com/path/to/content.once&quot;
SSAIComponent ssaiComponent = new SSAIComponent(context, brightcoveVideoView);
ssaiComponent.processVideo(ssaiUrl);
</code></pre>

<h3 id="Provide_a_Video_with_VMAP">Provide a Video with VMAP</h3>
<p>
  For this option, you will provide a Video with a Source containing a VMAP property with the SSAI asset URL. To use the SSAI plugin, follow these steps:
</p>
<ol class="bcls-tasklist__restart">
    <li>In order to request VideoCloud SSAI content, your account must first be configured to use Dynamic Delivery and SSAI.
    For details, see the <a href="/node/18623">Video Cloud SSAI Overview</a> document.</li>
    <li>
      Next, you will need to create an Ad Configuration (adConfig) object. For details, see the <a href="/node/18748">Configuring Server-Side Ad Settings</a> document. Please note that the Brightcove Native SDK for Android does not itself contain any functionality to create or manage adConfigs.
    </li>
    <li>
      Use the adConfig's <code>id</code> property as a URL parameter (<code>ad_config_id</code>) added to the Catalog method call:
      <pre><code class="language-java">findVideoById</code></pre>
      <p>
        or
      </p>
      <pre><code class="language-java">findVideoByReferenceId  </code></pre>
    </li>
    <li>
      Having retrieved the Video object with the findVideo method, call the following method in the SSAI plugin:
      <pre><code class="language-java">SSAIComponent.processVideo(Video ssaiVideo)</code></pre>
    </li>
</ol>
<p>
  Here is an example:
</p>
<pre class="line-numbers"><code class="language-java">Catalog catalog = new Catalog(eventEmitter, myAccountId, myPolicyKey);
SSAIComponent plugin = new SSAIComponent(appContext, getBrightcoveVideoView());

// Set the ad_config_id URL parameter
HttpRequestConfig httpRequestConfig = new HttpRequestConfig.Builder()
        .addQueryParameter(&quot;ad_config_id&quot;, myAdConfig)
        .build();

// Find the Video by ID
catalog.findVideoByID(myVideoId, httpRequestConfig, new VideoListener() {
        @Override
        public void onVideo(Video video) {

        // Process the Video
        plugin.processVideo(video);
    }
});
</code></pre>
</section>

<section class="bcls-section">
<h2 id="Companion_Ads">Companion Ads</h2>

<p>
  If your ads have Companions, you can easily display them in your app by providing a <code>ViewGroup</code> to hold the Companion image, by calling:
</p>
<pre><code class="language-java">SSAIComponent.addCompanionContainer(ViewGroup companionContainer)
</code></pre>
<p>
  Here is an example. First, Add the FrameLayout to your activity or fragment layout:
</p>
<pre class="line-numbers"><code class="language-xml">// my_activity.xml
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
                xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;match_parent&quot;&gt;
 ...
  &lt;FrameLayout
        android:id=&quot;@+id/ad_frame&quot;
        android:layout_width=&quot;300dp&quot;
        android:layout_height=&quot;250dp&quot;
        android:visibility=&quot;invisible&quot; /&gt;
&hellip;
&lt;/RelativeLayout&gt;
</code></pre>
<p>
   Then, use that <code>FrameLayout</code> to pass it to the plugin:
</p>
<pre class="line-numbers"><code class="language-java">ViewGroup viewGroup = findViewById(R.id.ad_frame);
plugin.addCompanionContainer(viewGroup);

// process your Video
plugin.processVideo(video);
</code></pre>
</section>

<section class="bcls-section">
<h2 id="Error_handling">Error handling</h2>

<p>
  All errors will be surface to the developer using the <code>EventType.ERROR</code> event, as shown here:
</p>
<pre class="line-numbers"><code class="language-java">eventEmitter.on(EventType.ERROR, new EventListener() {
    @Override
    public void processEvent(Event event) {
        String errorMessage = event.getProperty(Event.ERROR_MESSAGE, String.class);
        Throwable error = event.getProperty(Event.ERROR, Throwable.class);
        Log.w(TAG, String.format(&quot;Received the error message: %s with error: %s&quot;, errorMessage, error));
    }
});
</code></pre>
</section>

<section class="bcls-section">
<h2 id="Migrating_from_the_OnceUx_Plugin">Migrating from the OnceUx Plugin</h2>

<p>
  If you are already using the OnceUx plugin to play your SSAI videos in your app, you only need to follow a few steps to migrate to the new SSAI plugin.
</p>
<ol class="bcls-tasklist__restart">
    <li>
      In your appâ€™s <strong>build.gradle</strong> file, replace
      <pre><code class="language-java">implementation 'com.brightcove.player:android-onceux-plugin:6.5.1'
</code></pre>
<p>
  with the following: (use the latest plugin version)
</p>
<pre><code class="language-java">implementation 'com.brightcove.player:android-ssai-plugin:6.7.0'
</code></pre>
    </li>
    <li>
      Replace the <code>OnceUxComponent</code> class with the <code>SSAIComponent</code> class.
    </li>
    <li>
      Replace <code>OnceUxEventType.NO_AD_DATA_URL</code> with <code>EventType.ERROR</code>.
    </li>
    <li>
      If your code uses any of the constants that were found in <code>OnceUxEventType</code> class, replace these with <code>SSAIEventType</code> and <code>SSAIEvent</code> constants, according to their function:
      <ul>
        <li>
          The constants used to listen for an event are now found in the <code>SSAIEventType</code> class. For example:
          <pre><code class="language-java">SSAIEventtType.AD_DATA_READY</code></pre>
        </li>
        <li>
          The constants used as keys for Event properties are now found in the SSAIEvent class. For example:
          <pre><code class="language-java">SSAIEvent.SSAI_AD</code></pre>
        </li>
      </ul>
    </li>
    <li>
      The SSAI and OnceUx plugins share an internal library responsible for parsing the VMAP object. If your app directly uses objects from this library (<code>package com.brightcove.iab</code>), there are changes in the new version that you might find useful.
    </li>
    <li>
      For more information, please see Appendix A.
    </li>
</ol>
<!-- <p>
  For more information on the differences between the Event sent in the OnceUx plugin and the SSAI plugin, please check the appendices B and C.
</p> -->
</section>

<section class="bcls-section">
<h2 id="Appendix_A">Appendix A</h2>

<p>This table shows the changes in the internal IAB Android library 1.5.0:</p>
<ul>
  <li>
    Added the following methods to return timed values in microseconds:
    <ul>
      <li>
        <code>com.brightcove.iab.ssai.BrightcoveSSAI.getContentLengthUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.ssai.BrightcoveSSAI.getPayloadLengthUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vmap.AdBreak.getTimeOffsetUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vmap.AdBreak.getDurationUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vast.Linear.getDurationUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vast.Linear.getSkipOffsetUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vast.NonLinear.getMinSuggestedDurationUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vast.Icon.getDurationUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vast.Icon.getOffsetUs():long</code>
      </li>
      <li>
        <code>com.brightcove.iab.vast.Tracking.getOffsetUs():long</code>
      </li>
    </ul>
  </li>
  <li>
    Added <code>AdBreak.POST_ROLL_TIME_OFFSET_US</code> to specify the value of a post-roll AdBreak when using <code>AdBreak.getTimeOffsetUs()</code>.
  </li>
  <li>
    Added the <code>BrightcoveSSAI</code> property getters following the camelcase naming convention.
  </li>
  <li>
    Deprecated the <code>BrightcoveSSAI</code> property getters not following the camelcase naming convention.
  </li>
</ul>

</section>

<section class="bcls-section">
<h2 id="Appendix_B">Appendix B</h2>

<p>This table shows the differences between the EventType properties sent with the OnceUx and the SSAI plugin:</p>
<table class="bcls-table">
	<thead class="bcls-table__head">
		<tr>
			<th style="width:20%">EventType class</th>
			<th style="width:40%">OnceUx plugin</th>
      <th style="width:40%">SSAI plugin</th>
		</tr>
	</thead>
	<tbody class="bcls-table__body">
		<tr>
			<td><a href="https://docs.brightcove.com/android-sdk/javadoc/com/brightcove/player/event/EventType.html#AD_BREAK_STARTED">AD_BREAK_STARTED</a></td>
			<td>none</td>
      <td><code>Event.DURATION</code>:Integer<br>
<code>Event.PLAYHEAD_POSITION</code>:Integer<br>
<code>OnceUxEventType.STITCHED_POSITION</code>:Integer<br>
<code>SSAIEvent.AD_POD:com.brightcove.ssai.AdPod</code>
      </td>
		</tr>
    <tr>
			<td><a href="https://docs.brightcove.com/android-sdk/javadoc/com/brightcove/player/event/EventType.html#AD_STARTED">AD_STARTED</a></td>
			<td><code>Event.AD_ID</code>:String<br>
<code>Event.AD_TITLE</code>:String<br>
<code>OnceUxEventType.EXECUTED</code>:Integer<br>
<code>OnceUxEventType.VAST_LINEAR:com.brightcove.iab.vast.Linear</code><br>
<code>OnceUxEventType.STITCHED_POSITION</code>:Integer
</td>
      <td><code>Event.AD_ID</code>:String<br>
<code>Event.AD_TITLE</code>:String<br>
<code>OnceUxEventType.VAST_LINEAR:com.brightcove.iab.vast.Linear</code><br>
<code>OnceUxEventType.STITCHED_POSITION</code>:Integer
      </td>
		</tr>
    <tr>
			<td><a href="https://docs.brightcove.com/android-sdk/javadoc/com/brightcove/player/event/EventType.html#AD_PAUSED">AD_PAUSED</a></td>
			<td><code>Event.AD_ID</code>:String<br>
<code>Event.AD_TITLE</code>:String<br>
<code>Event.PLAYHEAD_POSITION</code>:Integer<br>
<code>Event.VIDEO</code>:Video
      </td>
      <td>same
      </td>
		</tr>
    <tr>
			<td><a href="https://docs.brightcove.com/android-sdk/javadoc/com/brightcove/player/event/EventType.html#AD_RESUMED">AD_RESUMED</a></td>
			<td><code>Event.AD_ID</code>:String<br>
<code>Event.AD_TITLE</code>:String<br>
<code>Event.VIDEO_DURATION</code>:Integer<br>
<code>Event.PLAYHEAD_POSITION</code>:Integer<br>
<code>Event.SOURCE</code>:Source<br>
<code>Event.VIDEO</code>:Video<br>
<code>Event.FORWARD_BUFFER_SECONDS</code>:Integer
      </td>
      <td>same
		</tr>


	</tbody>
</table>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;






</section>



</article>

<!-- END DRUPAL CONTENT -->
  </div>
</div>
<!-- bcl scripts -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
<script src="/en/scripts/docs-nav-data.min.js"></script>
<script src="/en/scripts/bcls-doc-site-v3.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
<script>
$(document).foundation();
</script>
<!-- Any scripts specific to page samples should go here -->
</body>

</html>
