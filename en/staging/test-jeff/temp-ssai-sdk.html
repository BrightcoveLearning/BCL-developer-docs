<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Video Cloud SSAI with the Native Player SDKs</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Video Cloud SSAI with the Native Player SDKs</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <p>In this topic, you will learn how to play Server-Side ads with the Brightcove Native Player SDKs, from videos ingested for Dynamic Delivery.</p>


	    <!-- BEGIN DRUPAL CONTENT -->



<article class="bcls-article">
<section class="bcls-section">
<h2 id="Overview">Overview</h2>

<p>Server-Side Ad Insertion (SSAI) allows you to embed ads into your videos so that they can't be blocked by ad blockers in the browser. Dynamic Delivery is the next generation ingest and delivery system which reduces your storage footprint and dynamically packages media. Learn more about using <a href="/node/18476">Dynamic Delivery</a> for your videos.</p>

<p>SSAI works with both DRM and non-DRM content.</p>

<aside class="bcls-aside bcls-aside--information">Notes:
<ul>
	<li>To use SSAI, your Video Cloud account needs to be configured for <a href="/node/18476">Dynamic Delivery</a> and enabled for SSAI. Contact your account manager to start using this feature.</li>
	<li>SSAI works with Video-on-Demand (VOD) and supports Live playback.</li>
	<li>The Native SDKs use the OUX plugin as a proxy for VOD SSAI.</li>
	<li>For a list of limitations, see the <a href="/node/18623#Limitations">SSAI Overview</a> document.</li>
</ul>
</aside>

<figure class="bcls-figure"><img class="bcls-image--no-border" alt="Server-side ad" src="//learning-services-media.brightcove.com/doc-assets/device-sdks/guides/ssai/ssai-sdk.png" />
<figcaption class="bcls-caption--image">Server-side ad</figcaption>
</figure>

<p>To play server-side ads with your video content stored in Video Cloud, follow these steps:</p>

<ol class="bcls-tasklist">
	<li><a href="#Create_an_ad_configuration">Create an ad configuration</a></li>
	<li>
	<p>Build your app:</p>

	<ul>
		<li><a href="#Android_implementation">Android implementation</a></li>
		<li><a href="#iOS_implementation">iOS implementation</a></li>
		<li><a href="#tvOS_implementation">tvOS implementation</a></li>
	</ul>
	</li>
	<li><a href="#Play_a_video_with_ads">Play a video with ads</a></li>
	<!-- <li><a href="#Append_query_parameters">Append query parameters</a></li> -->
</ol>
</section>

<section class="bcls-section">
<h2 id="Create_an_ad_configuration">Create an ad configuration</h2>

<p>The ad configuration defines various aspects of SSAI playback, including a URL to your Video Multiple Ad Playlist (VMAP) file, beacons, and other configurations. For now, you must contact your Brightcove account manager to create your ad configuration.</p>
</section>

<section class="bcls-section">
<h2 id="Android_implementation">Android implementation</h2>

<p>Follow these steps within your app to get your ad configuration and play your video:</p>

<ol class="bcls-tasklist__restart">
	<li>Include the Once UX plugin in your app, as shown in the <a href="https://github.com/BrightcoveOS/android-player-samples/tree/master/brightcove-exoplayer/BasicOnceUxSampleApp">Basic Once UX Player</a> sample. This will be the starting point for your app. Notice that the plugin uses a companion ad container.</li>
	<li>In Android Studio, open your <strong>MainActivity.java</strong> file.</li>
	<li>Comment out or delete the following code:
	<pre class="line-numbers">
<code class="notranslate language-java">private String onceUxAdDataUrl = "http://once.unicornmedia.com/now/ads/vmap/od/auto/c501c3ee-7f1c-4020-aa6d-0b1ef0bbd4a9/202ef8bb-0d9d-4f6f-bd18-f45aa3010fe6/8a146f45-9fac-462e-a111-de60ec96198b/content.once";
...
plugin.processVideo(onceUxAdDataUrl);</code></pre>
	</li>
	<li>Define constants for your account id, policy key, video id, and your ad configuration id.
	<pre class="line-numbers">
<code class="notranslate language-java">private String accountId = "<span class="bcls-input">your account id</span>";
private String policyKey = "<span class="bcls-input">your policy key</span>";
private String videoId = "<span class="bcls-input">your video id</span>";
private String adConfigId = "<span class="bcls-input">your ad configuration id</span>";</code></pre>

	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="/node/18125">Policy Keys</a> document.</aside>
	</li>
	<li>In the <code class="notranslate">onCreate</code> method, set the query parameter value to your ad configuration id.
	<pre class="line-numbers">
<code class="notranslate language-java">Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
parameters.put("ad_config_id", adConfigId);
</code></pre>
	</li>
	<li>Create an instance of the catalog service, which provides asynchronous methods for retrieving data from the Playback API.
	<pre class="line-numbers">
<code class="notranslate language-java">Catalog catalog = new Catalog(brightcoveVideoView.getEventEmitter(), accountId, policyKey);
</code></pre>
	</li>
	<li>Call the catalog service to retrieve your video along with your ad configuration from the Playback API. Start video playback with your specified ads.
	<pre class="line-numbers">
<code class="notranslate language-java">catalog.findVideoByID(videoId, null, parameters, new VideoListener() {
  @Override
  public void onVideo(Video video) {
    try {
      // The OnceUX plugin will look for a VMAP URL in the video object properties.
      // If valid, it will play the video.
      plugin.processVideo(video);
    } catch (NoSourceFoundException e) {
      // If NoSourceFoundException is thrown it means a suitable VMAP URL was not found.
      // You can try to play it on a regular view,
      brightcoveVideoView.add(video);
    }
  }
});</code></pre>
	</li>
</ol>

<h3 id="Android_MainActivity_file" class="bcls-expander-head">Android MainActivity file</h3>

<div class="bcls-expander-content">
<p>Your <strong>MainActivity.java</strong> file should look similar to this:</p>

<pre class="line-numbers">
<code class="notranslate language-java">package com.brightcove.player.samples.onceux.basic;

import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.ViewGroup;

import com.brightcove.onceux.OnceUxComponent;
import com.brightcove.onceux.event.OnceUxEventType;
import com.brightcove.player.controller.NoSourceFoundException;
import com.brightcove.player.edge.Catalog;
import com.brightcove.player.edge.VideoListener;
import com.brightcove.player.event.Event;
import com.brightcove.player.event.EventEmitter;
import com.brightcove.player.event.EventListener;
import com.brightcove.player.model.Video;
import com.brightcove.player.view.BrightcoveExoPlayerVideoView;
import com.brightcove.player.view.BrightcovePlayer;

import java.util.HashMap;
import java.util.Map;

/**
 * This app illustrates how to use the Once UX plugin to ensure that:
 *
 * - player controls are hidden during ad playback,
 *
 * - tracking beacons are fired from the client side,
 *
 * - videos are clickable during ad playback and visit the appropriate website,
 *
 * - the companion banner is shown on page switched appropriately as new ads are played
 */
public class MainActivity extends BrightcovePlayer {

    // Private class constants

    private final String TAG = this.getClass().getSimpleName();

    private String accountId = "<span class="bcls-input">your account Id</span>";
    private String policyKey = "<span class="bcls-input">your policy key</span>";
    private String videoId = "<span class="bcls-input">your video Id</span>";
    private String adConfigId = "<span class="bcls-input">your ad configuration Id</span>";

    // Private instance variables

    private OnceUxComponent plugin;
    public OnceUxComponent getOnceUxPlugin() {
        return plugin;
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        // When extending the BrightcovePlayer, we must assign brightcoveVideoView before
        // entering the superclass.  This allows for some stock video player lifecycle
        // management.
        setContentView(R.layout.onceux_activity_main);
        brightcoveVideoView = (BrightcoveExoPlayerVideoView) findViewById(R.id.brightcove_video_view);
        brightcoveVideoView.getAnalytics().setAccount("1752604059001");
        super.onCreate(savedInstanceState);

        // Setup the event handlers for the OnceUX plugin, set the companion ad container,
        // register the VMAP data URL inside the plugin and start the video.  The plugin will
        // detect that the video has been started and pause it until the ad data is ready or an
        // error condition is detected.  On either event the plugin will continue playing the
        // video.
        registerEventHandlers();
        plugin = new OnceUxComponent(this, brightcoveVideoView);
        View view = findViewById(R.id.ad_frame);
        if (view != null &amp;&amp; view instanceof ViewGroup) {
            plugin.addCompanionContainer((ViewGroup) view);
        }

        Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
        parameters.put("ad_config_id", adConfigId);

        Catalog catalog = new Catalog(brightcoveVideoView.getEventEmitter(), accountId, policyKey);

        catalog.findVideoByID(videoId, null, parameters, new VideoListener() {
            @Override
            public void onVideo(Video video) {
                try {
                    // The OnceUX plugin will look for a VMAP URL in the video object properties.
                    // If valid, it will play the video.
                    plugin.processVideo(video);
                } catch (NoSourceFoundException e) {
                    // If NoSourceFoundException is thrown it means a suitable VMAP URL was not found.
                    // You can try to play it on a regular view,
                    brightcoveVideoView.add(video);
                }
            }
        });
   }

    // Private instance methods

    /**
     * Procedural abstraction used to setup event handlers for the OnceUX plugin.
     */
    private void registerEventHandlers() {
        // Handle the case where the ad data URL has not been supplied to the plugin.
        EventEmitter eventEmitter = brightcoveVideoView.getEventEmitter();
        eventEmitter.on(OnceUxEventType.NO_AD_DATA_URL, new EventListener() {
            @Override
            public void processEvent(Event event) {
                // Log the event and display a warning message (later)
                Log.e(TAG, event.getType());
                // TODO: throw up a stock Android warning widget.
            }
        });
    }
}</code></pre>
</div>
&nbsp;

<aside class="bcls-aside bcls-aside--tip">
<p>Events associated with Server-side ad insertion include the following:</p>

<ul>
	<li><a href="https://docs.brightcove.com/android-sdk/javadoc/index.html?com/brightcove/onceux/event/package-summary.html">Lifecycle events that are specific to Once UX</a></li>
	<li><a href="https://docs.brightcove.com/android-sdk/javadoc/com/brightcove/player/event/EventType.html">Lifecycle events associated with ads</a></li>
</ul>
</aside>
</section>

<section class="bcls-section">
<h2 id="iOS_implementation">iOS implementation</h2>

<p>Follow these steps within your app to get your ad configuration and play your video:</p>

<ol class="bcls-tasklist__restart">
	<li>Include the Once UX plugin in your app, as shown in the <a href="https://github.com/BrightcoveOS/ios-player-samples/tree/master/OUX">Basic Once UX Player</a> sample. This will be the starting point for your app. Notice that the storyboard contains the definitions for the <code class="notranslate">videoContainerView</code> and the <code class="notranslate">companionSlotContainerView</code>.</li>
	<li>In Xcode, open your <strong>ViewController.m</strong> file.</li>
	<li>Comment out or delete the following code:
	<pre class="line-numbers">
<code class="notranslate language-objectivec">static NSString *kViewControllerVideoURLString = @"http://onceux.unicornmedia.com/now/ads/vmap/od/auto/c6589dd5-8f31-4ae3-8a5f-a54ca3d7c973/632f6399-9e87-4ce2-a7c0-39209be2b5d0/bee45a63-71ea-4a20-800f-b67091867eeb/content.once";
...
// Create video
BCOVVideo *video = [BCOVVideo videoWithURL:[NSURL URLWithString:kViewControllerVideoURLString]];
[self.controller setVideos:@[video]];
</code></pre>
	</li>
	<li>Define constants for your account id, policy key, video id, and your ad configuration id.
	<pre class="line-numbers">
<code class="notranslate language-objectivec">static NSString *accountId = @"<span class="bcls-input">your account id</span>";
static NSString *policyKey = @"<span class="bcls-input">your policy key</span>";
static NSString *videoId = @"<span class="bcls-input">your video id</span>";
static NSString *adConfigId = @"<span class="bcls-input">your ad configuration id</span>";
</code></pre>

	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="/node/18125">Policy Keys</a> document.</aside>
	</li>
	<li>Define the <code class="notranslate">BCOVPlaybackService</code> class, which provides asynchronous methods for retrieving data from the Playback API.
	<pre class="line-numbers">
<code class="notranslate language-objectivec">@interface ViewController () &lt;BCOVPlaybackControllerDelegate&gt;
@property (nonatomic, strong) id&lt;BCOVPlaybackController&gt; controller;
<span class="bcls-highlight">@property (nonatomic, strong) BCOVPlaybackService *playbackService;</span>
@property (nonatomic) BCOVPUIPlayerView *playerView;
@property (weak, nonatomic) IBOutlet UIView *videoContainerView;
@property (weak, nonatomic) IBOutlet UIView *companionSlotContainerView;

@end</code></pre>
	</li>
	<li>In the <code class="notranslate">viewDidLoad</code> method, set the query parameter value to your ad configuration id.
	<pre class="line-numbers">
<code class="notranslate language-objectivec">NSDictionary *queryParameters = @{
  @"ad_config_id" : adConfigId
};
</code></pre>
	</li>
	<li>Create an instance of the <code class="notranslate">BCOVPlaybackService</code>.
	<pre class="line-numbers">
<code class="notranslate language-objectivec">self.playbackService = [[BCOVPlaybackService alloc]
  initWithAccountId:accountId
  policyKey:policyKey];</code></pre>
	</li>
	<li>Call the <code class="notranslate">playbackService</code> to retrieve your video along with your ad configuration from the Playback API. Start video playback with your specified ads.
	<pre class="line-numbers">
<code class="notranslate language-objectivec">[self.playbackService findVideoWithVideoID:videoId parameters:queryParameters completion:^(BCOVVideo *video, NSDictionary *jsonResponse, NSError *error) {
  {
    if (error == nil)
    {
      // play it.
      [self.controller setVideos: @[ video ]];
    }
    else
    {
      NSLog (@"Error! Playback Service says: %@",
             error.localizedDescription);
    }
  }
}];</code></pre>
	</li>
</ol>

<h3 id="iOS_ViewController_using_Objective-C" class="bcls-expander-head">iOS ViewController using Objective-C</h3>

<div class="bcls-expander-content">
<p>Your <strong>ViewController.m</strong> file should look similar to this:</p>

<pre class="line-numbers">
<code class="notranslate language-objectivec">//
//  ViewController.m
//  SSAI with Video Id
//
//  Copyright © 2018 Brightcove. All rights reserved.
//

#import "ViewController.h"

@import BrightcovePlayerSDK;
@import BrightcoveOUX;

NSString *accountId = @"<span class="bcls-input">your account Id</span>";
NSString *policyKey = @"<span class="bcls-input">your policy key</span>";
NSString *videoId = @"<span class="bcls-input">your video Id</span>";
NSString *adConfigId = @"<span class="bcls-input">your ad configuration Id</span>";

@interface ViewController () &lt;BCOVPlaybackControllerDelegate&gt;
@property (nonatomic, strong) id&lt;BCOVPlaybackController&gt; playbackController;
@property (nonatomic, strong) BCOVPlaybackService *playbackService;
@property (nonatomic) BCOVPUIPlayerView *playerView;
@property (weak, nonatomic) IBOutlet UIView *videoContainerView;
@property (weak, nonatomic) IBOutlet UIView *companionSlotContainerView;

@end

@implementation ViewController

- (void)viewDidLoad {
  [super viewDidLoad];
  // Do any additional setup after loading the view, typically from a nib.
  BCOVPlayerSDKManager *manager = [BCOVPlayerSDKManager sharedManager];

  // Create a companion slot.
  BCOVOUXCompanionSlot *companionSlot = [[BCOVOUXCompanionSlot alloc] initWithView:self.companionSlotContainerView width:500 height:61];

  // In order to display an ad progress banner on the top of the view, we create this display container.  This object is also responsible for populating the companion slots.
  BCOVOUXAdComponentDisplayContainer *adComponentDisplayContainer = [[BCOVOUXAdComponentDisplayContainer alloc]   initWithCompanionSlots:@[companionSlot]];

  self.playbackController = [manager createOUXPlaybackControllerWithViewStrategy:nil];

  // In order for the ad display container to receive ad information, we add it as a session consumer.
  [self.playbackController addSessionConsumer:adComponentDisplayContainer];

  self.playbackController.delegate = self;
  self.playbackController.autoPlay = YES;

  BCOVPUIBasicControlView *controlView = [BCOVPUIBasicControlView basicControlViewWithVODLayout];
  // Set playback controller later.
  self.playerView = [[BCOVPUIPlayerView alloc] initWithPlaybackController:nil options:nil controlsView:controlView];

  [self.videoContainerView addSubview:self.playerView];
  self.playerView.translatesAutoresizingMaskIntoConstraints = NO;
  [NSLayoutConstraint activateConstraints:@[
      [self.playerView.topAnchor constraintEqualToAnchor:self.videoContainerView.topAnchor],
      [self.playerView.rightAnchor constraintEqualToAnchor:self.videoContainerView.rightAnchor],
      [self.playerView.leftAnchor constraintEqualToAnchor:self.videoContainerView.leftAnchor],
      [self.playerView.bottomAnchor constraintEqualToAnchor:self.videoContainerView.bottomAnchor],
  ]];

  self.playerView.playbackController = self.playbackController;

  NSDictionary *queryParameters = @{
                                @"ad_config_id" : adConfigId
                                };

  self.playbackService = [[BCOVPlaybackService alloc]
                      initWithAccountId:accountId
                      policyKey:policyKey];

  [self.playbackService findVideoWithVideoID:videoId parameters:queryParameters completion:^(BCOVVideo *video, NSDictionary *jsonResponse, NSError *error) {
    {
        if (error == nil)
        {
            // play it.
            [self.playbackController setVideos: @[ video ]];
        }
        else
        {
            NSLog (@"Error! Playback Service says: %@",
                   error.localizedDescription);
        }
    }
  }];
}

#pragma mark BCOVPlaybackControllerBasicDelegate

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller didAdvanceToPlaybackSession:(id&lt;BCOVPlaybackSession&gt;)session
{
  NSLog(@"ViewController Debug - Advanced to new session.");
}

#pragma mark BCOVPlaybackControllerAdsDelegate

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didEnterAdSequence:(BCOVAdSequence *)adSequence
{
  NSLog(@"ViewController Debug - Entering ad sequence");
}

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didExitAdSequence:(BCOVAdSequence *)adSequence
{
  NSLog(@"ViewController Debug - Exiting ad sequence");
}

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didEnterAd:(BCOVAd *)ad
{
  NSLog(@"ViewController Debug - Entering ad");
}

- (void)playbackController:(id&lt;BCOVPlaybackController&gt;)controller playbackSession:(id&lt;BCOVPlaybackSession&gt;)session didExitAd:(BCOVAd *)ad
{
  NSLog(@"ViewController Debug - Exiting ad");
}

- (void)didReceiveMemoryWarning {
  [super didReceiveMemoryWarning];
  // Dispose of any resources that can be recreated.
}
@end</code></pre>
</div>

<h3 id="iOS_ViewController_using_Swift" class="bcls-expander-head">iOS ViewController using Swift</h3>

<div class="bcls-expander-content">
<p>Your <strong>ViewController.swift</strong> file should look similar to this:</p>

<pre class="line-numbers">
<code class="notranslate language-objectivec">//
//  ViewController.swift
//  SSAI with Video Id
//
//  Copyright © 2018 Brightcove. All rights reserved.
//

import UIKit
import BrightcovePlayerSDK
import BrightcoveOUX

// ** Customize these values with your own account information **
struct Constants {
  static let kAccountId = &quot;<span class="bcls-input">your account id</span>&quot;
  static let kPolicyKey = &quot;<span class="bcls-input">your policy key</span>&quot;
  static let kVideoId = &quot;<span class="bcls-input">your video id</span>&quot;
  static let kAdConfigId = &quot;<span class="bcls-input">your ad configuration id</span>&quot;
}

class ViewController: UIViewController {
  @IBOutlet weak var videoContainerView: UIView!
  @IBOutlet weak var companionSlotContainerView: UIView!

  let playbackService = BCOVPlaybackService(accountId: Constants.kAccountId, policyKey: Constants.kPolicyKey)
  var controller: BCOVPlaybackController?
  var playerView: BCOVPUIPlayerView?

    override func viewDidLoad() {
      super.viewDidLoad()
      // Do any additional setup after loading the view, typically from a nib.

      // Create a companion slot.
      let companionSlot = BCOVOUXCompanionSlot(view: companionSlotContainerView, width: 500, height: 61)

      // In order to display an ad progress banner on the top of the view, we create this display container.  This object is also responsible for populating the companion slots.
      let adComponentDisplayContainer = BCOVOUXAdComponentDisplayContainer(companionSlots: [companionSlot])

      controller = BCOVPlayerSDKManager.shared().createOUXPlaybackController(viewStrategy: nil)

      // In order for the ad display container to receive ad information, we add it as a session consumer.
      controller?.add(adComponentDisplayContainer)
      controller?.delegate = self
      controller?.isAutoPlay = true

      let controlView = BCOVPUIBasicControlView.withVODLayout()

      // Set playback controller later.
      playerView = BCOVPUIPlayerView(playbackController: nil, options: nil, controlsView: controlView)
      if let playerView = playerView {
        playerView.translatesAutoresizingMaskIntoConstraints = false
        videoContainerView.addSubview(playerView)
        NSLayoutConstraint.activate([
          playerView.topAnchor.constraint(equalTo: videoContainerView.topAnchor),
          playerView.rightAnchor.constraint(equalTo: videoContainerView.rightAnchor),
          playerView.leftAnchor.constraint(equalTo: videoContainerView.leftAnchor),
          playerView.bottomAnchor.constraint(equalTo: videoContainerView.bottomAnchor)
        ])
        playerView.playbackController = controller
      }

      requestContentFromPlaybackService()
    }

    func requestContentFromPlaybackService() {
      let queryParameters = [&quot;ad_config_id&quot;: Constants.kAdConfigId]

      playbackService?.findVideo(withVideoID: Constants.kVideoId, parameters: queryParameters) { (video: BCOVVideo?, jsonResponse: [AnyHashable: Any]?, error: Error?) -&gt; Void in

        if let v = video {
          self.controller?.setVideos([v] as NSArray)
        } else {
          print(&quot;ViewController Debug - Error retrieving video: \(error?.localizedDescription ?? &quot;unknown error&quot;)&quot;)
        }
      }
    }

    // MARK: - BCOVPlaybackControllerDelegate
    extension ViewController: BCOVPlaybackControllerDelegate {

        func playbackController(_ controller: BCOVPlaybackController!, didAdvanceTo session: BCOVPlaybackSession!) {
            print(&quot;ViewController Debug - Advanced to new session.&quot;)
        }
    }

    // MARK: - BCOVPlaybackControllerAdsDelegate
    extension ViewController: BCOVPlaybackControllerAdsDelegate {

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didEnter adSequence: BCOVAdSequence!) {
        print(&quot;ViewController Debug - Entering ad sequence&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didExitAdSequence adSequence: BCOVAdSequence!) {
        print(&quot;ViewController Debug - Exiting ad sequence&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didEnter ad: BCOVAd!) {
        print(&quot;ViewController Debug - Entering ad&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didExitAd ad: BCOVAd!) {
        print(&quot;ViewController Debug - Exiting ad&quot;)
    }
}</code></pre>
</div>
&nbsp;

<aside class="bcls-aside bcls-aside--tip">
<p>Events associated with Server-side ad insertion include the following:</p>

<ul>
	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios-oux/blob/master/ios/dynamic/BrightcoveOUX.framework/Headers/BCOVOUXConstants.h">Lifecycle events that are specific to Once UX</a></li>
	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios/blob/master/ios/dynamic/BrightcovePlayerSDK.framework/Headers/BCOVAdvertising.h">Lifecycle events associated with ads</a></li>
</ul>
</aside>
</section>

<section class="bcls-section">
<h2 id="tvOS_implementation">tvOS implementation</h2>

<p>Follow these steps within your app to get your ad configuration and play your video:</p>

<ol class="bcls-tasklist__restart">
	<li>Start with the <a href="https://github.com/BrightcoveOS/ios-player-samples/tree/master/OUX/BasicOUXtvOSPlayer">Basic Once UX Player for tvOS</a> sample written in Swift.</li>
  <li>
    Either delete or comment out the code in the <code>VideoConfig.swift</code> file.
  </li>
	<li>In Xcode, open your <strong>ViewController.m</strong> file.</li>

	<li>Define constants for your account id, policy key, video id, and your ad configuration id.
	<pre class="line-numbers">
<code class="notranslate language-swift">struct VideoConfig {
  static let kAccountId = &quot;<span class="bcls-input">your account id</span>&quot;
  static let kPolicyKey = &quot;<span class="bcls-input">your policy key</span>&quot;;
  static let kVideoId = &quot;<span class="bcls-input">your video id</span>&quot;
  static let kAdConfigId = &quot;<span class="bcls-input">your ad configuration id</span>&quot;
}
</code></pre>

	<aside class="bcls-aside bcls-aside--information">Learn how to get or generate a policy key in the <a href="/node/18125">Policy Keys</a> document.</aside>
	</li>
	<li>Create an instance of the <code class="notranslate">BCOVPlaybackService</code>.
	<pre class="line-numbers">
<code class="notranslate language-swift">let playbackService = BCOVPlaybackService(accountId: VideoConfig.kAccountId, policyKey: VideoConfig.kPolicyKey)</code></pre>
	</li>
	<!-- <li>Create the Once UX playback controller.
	<pre>
<code class="notranslate language-swift">let playbackController: BCOVPlaybackController = BCOVPlayerSDKManager.shared().createOUXPlaybackController()</code></pre>
	</li> -->
	<li>In the <code class="notranslate">requestContentFromPlaybackService()</code> method, set the query parameter value to your ad configuration id.
	<pre>
<code class="notranslate language-swift">let queryParameters = ["ad_config_id": VideoConfig.kAdConfigId]</code>
</pre>
	</li>
	<li>Call the <code class="notranslate">playbackService</code> to retrieve your video along with your ad configuration from the Playback API. Start video playback with your specified ads.
	<pre class="line-numbers">
<code class="notranslate language-swift">playbackService?.findVideo(withVideoID: VideoConfig.kVideoId, parameters: queryParameters) { (video: BCOVVideo?, jsonResponse: [AnyHashable: Any]?, error: Error?) -&gt; Void in

  if let v = video {
    //  since &quot;isAutoPlay&quot; is true, setVideos will begin playing the content
    self.playbackController?.setVideos([v] as NSArray)
  } else {
    print(&quot;ViewController Debug - Error retrieving video: \(error?.localizedDescription ?? &quot;unknown error&quot;)&quot;)
  }
}</code></pre>
	</li>
</ol>

<h3 id="tvOS_ViewController_using_Swift" class="bcls-expander-head">tvOS ViewController using Swift</h3>

<div class="bcls-expander-content">
<p>Your <strong>ViewController.swift</strong> file should look similar to this:</p>

<pre class="line-numbers">
<code class="notranslate language-swift">//
//  ViewController.swift
//  SSAI POC = tvOS + Swift + SSAI + VOD
//
//  Copyright © 2018 Brightcove. All rights reserved.
//

import UIKit
import BrightcovePlayerSDK
import BrightcoveOUX

// ** Customize these values with your own account information **
struct VideoConfig {
  static let kAccountId = &quot;<span class="bcls-input">your account id</span>&quot;
  static let kPolicyKey = &quot;<span class="bcls-input">your policy key</span>&quot;;
  static let kVideoId = &quot;<span class="bcls-input">your video id</span>&quot;
  static let kAdConfigId = &quot;<span class="bcls-input">your ad configuration id</span>&quot;
}

class ViewController: UIViewController {
    @IBOutlet weak var videoContainerView: UIView!

    let playbackService = BCOVPlaybackService(accountId: VideoConfig.kAccountId, policyKey: VideoConfig.kPolicyKey)

    private lazy var playerView: BCOVTVPlayerView? = {
        let options = BCOVTVPlayerViewOptions()
        options.presentingViewController = self

        guard let _playerView = BCOVTVPlayerView(options: options) else {
            return nil
        }

        _playerView.translatesAutoresizingMaskIntoConstraints = false
        self.videoContainerView.addSubview(_playerView)
        NSLayoutConstraint.activate([
            _playerView.topAnchor.constraint(equalTo: self.videoContainerView.topAnchor),
            _playerView.rightAnchor.constraint(equalTo: self.videoContainerView.rightAnchor),
            _playerView.leftAnchor.constraint(equalTo: self.videoContainerView.leftAnchor),
            _playerView.bottomAnchor.constraint(equalTo: self.videoContainerView.bottomAnchor)
            ])

        return _playerView
    }()

    private lazy var playbackController: BCOVPlaybackController? = {
        guard let _playbackController = BCOVPlayerSDKManager.shared()?.createOUXPlaybackController(viewStrategy: nil) else {
            return nil
        }

        _playbackController.delegate = self
        _playbackController.isAutoAdvance = true
        _playbackController.isAutoPlay = true

        return _playbackController
    }()

    private weak var currentSession: BCOVPlaybackSession?

    private var currentTime: TimeInterval?
    private var duration: TimeInterval?
    private var playingAdSequence = false
    private var topDrawerView: UIView?

    override var preferredFocusEnvironments: [UIFocusEnvironment] {
        return [playerView?.controlsView ?? self]
    }

    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view, typically from a nib.

        // Link the playback controller to the Player View
        playerView?.playbackController = playbackController

        requestContentFromPlaybackService()
    }

    func requestContentFromPlaybackService() {
        let queryParameters = [&quot;ad_config_id&quot;: VideoConfig.kAdConfigId]

        playbackService?.findVideo(withVideoID: VideoConfig.kVideoId, parameters: queryParameters) { (video: BCOVVideo?, jsonResponse: [AnyHashable: Any]?, error: Error?) -&gt; Void in

            if let v = video {
                //  since &quot;isAutoPlay&quot; is true, setVideos will begin playing the content
                self.playbackController?.setVideos([v] as NSArray)
            } else {
                print(&quot;ViewController Debug - Error retrieving video: \(error?.localizedDescription ?? &quot;unknown error&quot;)&quot;)
            }
        }
    }
}
// MARK: - BCOVPlaybackControllerDelegate
extension ViewController: BCOVPlaybackControllerDelegate {
    func playbackController(_ controller: BCOVPlaybackController!, didAdvanceTo session: BCOVPlaybackSession!) {
        currentSession = session
        print(&quot;ViewController Debug - Advanced to new session.&quot;)
    }
}

// MARK: - BCOVPlaybackControllerAdsDelegate
extension ViewController: BCOVPlaybackControllerAdsDelegate {
    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didEnter adSequence: BCOVAdSequence!) {
        print(&quot;ViewController Debug - Entering ad sequence&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didExitAdSequence adSequence: BCOVAdSequence!) {
        print(&quot;ViewController Debug - Exiting ad sequence&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didEnter ad: BCOVAd!) {
        print(&quot;ViewController Debug - Entering ad&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didExitAd ad: BCOVAd!) {
        print(&quot;ViewController Debug - Exiting ad&quot;)
    }

    func playbackController(_ controller: BCOVPlaybackController!, didCompletePlaylist playlist: NSFastEnumeration!) {
        print(&quot;ViewController Debug - Playlist complete; replaying video&quot;)
        playbackController?.setVideos(playlist)
    }

    func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didReceive lifecycleEvent: BCOVPlaybackSessionLifecycleEvent!) {
        if let eventType = lifecycleEvent.eventType {
            print(&quot;ViewController Debug - lifecycle event type: \(eventType)&quot;)
        }
    }

}</code></pre>
</div>

<h3 id="tvOS_ViewController_using_Swift" class="bcls-expander-head">tvOS ViewController using Swift + FairPlay</h3>

<div class="bcls-expander-content">
<p>Your <strong>ViewController.swift</strong> file should look similar to this:</p>

<pre class="line-numbers">
<code class="notranslate language-swift">//
//  ViewController.swift
//  AppleTV = tvOS + Swift + SSAI + VOD + FairPlay
//
//  Copyright © 2018 Brightcove. All rights reserved.
//

// This sample app shows how to set up and use the TV Player UI on tvOS.

import UIKit
import BrightcovePlayerSDK
import BrightcoveOUX

struct VideoConfig {
  static let kAccountId = &quot;<span class="bcls-input">your account id</span>&quot;
  static let kPolicyKey = &quot;<span class="bcls-input">your policy key</span>&quot;;
  static let kVideoId = &quot;<span class="bcls-input">your video id</span>&quot;
  static let kAdConfigId = &quot;<span class="bcls-input">your ad configuration id</span>&quot;
}

class ViewController: UIViewController
{
  @IBOutlet var videoContainerView: UIView!

  var fairPlayAuthProxy: BCOVFPSBrightcoveAuthProxy?
  var playbackController:BCOVPlaybackController?

  let playbackService = BCOVPlaybackService(accountId: kViewControllerAccountID, policyKey: kViewControllerPlaybackServicePolicyKey)

  private lazy var playerView: BCOVTVPlayerView? = {
    let options = BCOVTVPlayerViewOptions()
    options.presentingViewController = self

    guard let _playerView = BCOVTVPlayerView(options: options) else {
      return nil
    }

    _playerView.translatesAutoresizingMaskIntoConstraints = false
    self.videoContainerView.addSubview(_playerView)
    NSLayoutConstraint.activate([
      _playerView.topAnchor.constraint(equalTo: self.videoContainerView.topAnchor),
      _playerView.rightAnchor.constraint(equalTo: self.videoContainerView.rightAnchor),
      _playerView.leftAnchor.constraint(equalTo: self.videoContainerView.leftAnchor),
      _playerView.bottomAnchor.constraint(equalTo: self.videoContainerView.bottomAnchor)
    ])

    return _playerView
  }()

  private weak var currentSession: BCOVPlaybackSession?

  private var currentTime: TimeInterval?
  private var duration: TimeInterval?
  private var playingAdSequence = false
  private var topDrawerView: UIView?

  override var preferredFocusEnvironments: [UIFocusEnvironment] {
    return [playerView?.controlsView ?? self]
  }

  override func viewDidLoad()
  {
    super.viewDidLoad()

    let sdkManager = BCOVPlayerSDKManager.sharedManager()
    self.fairPlayAuthProxy = BCOVFPSBrightcoveAuthProxy(publisherId: nil,
                                                        applicationId: nil)

    // Create chain of session providers
    let basicSessionProvider = sdkManager?.createBasicSessionProvider(with:nil)

    let fairplaySessionProvider = sdkManager?.createFairPlaySessionProvider(withApplicationCertificate:nil,
                                            authorizationProxy:self.fairPlayAuthProxy!,
                                            upstreamSessionProvider:basicSessionProvider)

    let ouxSessionProvider = sdkManager?.createOUXSessionProvider(withUpstreamSessionProvider: fairplaySessionProvider)

    // Create the playback controller

    let playbackController = sdkManager?.createPlaybackController(with:ouxSessionProvider, viewStrategy:nil)

    playbackController?.isAutoAdvance = false
    playbackController?.isAutoPlay = true
    playbackController?.delegate = self

    if playbackController?.view != nil {
        playbackController?.view.frame = self.videoContainerView.bounds
        playbackController?.view.autoresizingMask = [.flexibleHeight, .flexibleWidth]
        self.videoContainerView.addSubview((playbackController!.view)!)
    }

    self.playbackController = playbackController

    // Link the playback controller to the Player View
    playerView?.playbackController = playbackController

    requestContentFromPlaybackService()
  }

  func requestContentFromPlaybackService() {
    let queryParameters = [&quot;ad_config_id&quot;: VideoConfig.kAdConfigId]

    playbackService?.findVideo(withVideoID: VideoConfig.kVideoId, parameters: queryParameters) { (video: BCOVVideo?, jsonResponse: [AnyHashable: Any]?, error: Error?) -&gt; Void in

      if let v = video {
        //  since &quot;isAutoPlay&quot; is true, setVideos will begin playing the content
        self.playbackController?.setVideos([v] as NSArray)
      } else {
        print(&quot;ViewController Debug - Error retrieving video: \(error?.localizedDescription ?? &quot;unknown error&quot;)&quot;)
      }
    }
  }

}
// MARK: - BCOVPlaybackControllerDelegate
extension ViewController: BCOVPlaybackControllerDelegate {

  func playbackController(_ controller: BCOVPlaybackController!, didAdvanceTo session: BCOVPlaybackSession!) {
    currentSession = session
    print(&quot;ViewController Debug - Advanced to new session.&quot;)
  }
}

// MARK: - BCOVPlaybackControllerAdsDelegate
extension ViewController: BCOVPlaybackControllerAdsDelegate {

  func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didEnter adSequence: BCOVAdSequence!) {
    print(&quot;ViewController Debug - Entering ad sequence&quot;)
  }

  func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didExitAdSequence adSequence: BCOVAdSequence!) {
    print(&quot;ViewController Debug - Exiting ad sequence&quot;)
  }

  func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didEnter ad: BCOVAd!) {
    print(&quot;ViewController Debug - Entering ad&quot;)
  }

  func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didExitAd ad: BCOVAd!) {
    print(&quot;ViewController Debug - Exiting ad&quot;)
  }

  func playbackController(_ controller: BCOVPlaybackController!, didCompletePlaylist playlist: NSFastEnumeration!) {
    print(&quot;ViewController Debug - Playlist complete; replaying video&quot;)
    playbackController?.setVideos(playlist)
  }

  func playbackController(_ controller: BCOVPlaybackController!, playbackSession session: BCOVPlaybackSession!, didReceive lifecycleEvent: BCOVPlaybackSessionLifecycleEvent!) {
    if let eventType = lifecycleEvent.eventType {
      print(&quot;ViewController Debug - lifecycle event type: \(eventType)&quot;)
    }
  }
}</code></pre>
</div>
&nbsp;

<aside class="bcls-aside bcls-aside--tip">
<p>Events associated with Server-side ad insertion include the following:</p>

<ul>
	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios-oux/blob/master/ios/dynamic/BrightcoveOUX.framework/Headers/BCOVOUXConstants.h">Lifecycle events that are specific to Once UX</a></li>
	<li><a href="https://github.com/brightcove/brightcove-player-sdk-ios/blob/master/ios/dynamic/BrightcovePlayerSDK.framework/Headers/BCOVAdvertising.h">Lifecycle events associated with ads</a></li>
</ul>
</aside>
</section>

<section class="bcls-section">
<h2 id="Play_a_video_with_ads">Playing a video with ads</h2>

<p>Any video that you retrieve from Video Cloud that has been ingested with Dynamic Delivery, will include the ads specified in the VMAP file in your ad configuration.</p>
<!-- <aside class="bcls-aside bcls-aside--information">Currently, Server-side ad insertion will not respect the Advertising property (Free or Ad Supported) set in Video Cloud's Media module.</aside> --></section>
<!-- <section class="bcls-section">
    <h2 id="Append_query_parameters">Append query parameters</h2>
      <p>
      The Native player SDKs do not support any client-side macro replacement. If you want to manually append query string parameters, you can follow these steps:
      </p>
      <ol class="bcls-tasklist__restart">
      	<li>Call the Brightcove catalog (Playback API) with an ad configuration id to return a video object.</li>
        <li>
          From the returned video object, select and extract the appropriate manifest or VMAP URL.
        </li>
        <li>
          Append query parameters to either the manifest or VMAP URL.
        </li>
        <li>
          Process the video with the Once UX plugin.
          <ul>
            <li>
              For Android, use the following method:
              <pre><code class="notranslate language-java">plugin.processVideo(videoUrlString);</code></pre>
            </li>
            <li>
              For iOS/tvOS, do the following:
              <ul>
                <li>
                  Create a <code class="notranslate">BCOVSource</code> object using the <code class="notranslate">videoUrlString</code>
                </li>
                <li>
                  Create the <code class="notranslate">BCOVVideo</code> and <code class="notranslate">initWithSource:mySource</code>
                </li>
              </ul>
            </li>
          </ul>
        </li>

      </ol>

    </section> -->
  </article>


  <!-- END DRUPAL CONTENT -->
</div>
</div>
<!-- bcl scripts -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
<script src="/en/scripts/docs-nav-data.min.js"></script>
<script src="/en/scripts/bcls-doc-site-v3.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
<script>
$(document).foundation();
</script>
<!-- Any scripts specific to page samples should go here -->
</body>

</html>
