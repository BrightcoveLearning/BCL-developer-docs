<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <meta name="robots" content="noindex">
  	<!-- change title to match the h1 heading -->
  	<title>Getting Playback Position from Cross-Device Resume API</title>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css">
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>

</head>

<body>
	<!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
	<!-- search -->
	<div id="searchModal" class="reveal-modal" data-reveal></div>
	<!-- content -->
	<div class="row">
		<div class="sidebar large-2 columns show-for-large-up">
			<div id="sidenav" class="side-nav"></div>
		</div>
		<div id="main" class="large-10 small-12 columns">
			<h1>Getting Playback Position from Cross-Device Resume API</h1>
      <aside class="bcls-aside bcls-aside--warning">This is a temporary STAGING document for review only. For the official Brightcove documentation site, go to <a href="https://support.brightcove.com/">support.brightcove.com</a></aside>
      <summary>In this topic, you will learn the how to retrieve the user's playback position from the Cross-Device Resume (XDR) API.</summary>


	    <!-- BEGIN DRUPAL CONTENT -->


<article class="bcls-article">
<section class="bcls-section">
<h2 id="Overview">Overview</h2>
<p>
  Cross-device resume lets you start watching a video on one device, and at a later time, continue watching the video where you left off on a different device.
</p>
<p>
  Because the Cross-Device Resume (XDR) API cannot be called from your client-side apps, you will need to create a server-side proxy to make the call and return the playback position value.
</p>
</section>

<section class="bcls-section">
<h2 id="Getting_playback_position">Getting playback position</h2>

<p>You can get the viewer playback position with the <a href="https://docs.brightcove.com/en/staging/xdr/xdr-api/v1/doc/">Cross-Device Resume (XDR) API</a>.</p>

<h3 id="Cross_Device_Resume_API">Cross-Device Resume (XDR) API</h3>
<p>
  With the Cross-Device Resume API, you can get all the playhead positions for a specific viewer, or all the playheads for a specific viewer and video.
</p>

<h3>Base URL</h3>
<p>
  The base URL for the API is:
</p>
<pre><code class="language-http">https://data.brightcove.com/v1/xdr</code></pre>

<h3>Account path</h3>
<p>
  In all cases, requests will be made for a specific Video Cloud Account. So, you will always add the term accounts followed by your account id to the base URL:
</p>
<pre><code class="language-http">https://data.brightcove.com/v1/xdr/accounts/{accountID}</code></pre>

<h3>Authorization</h3>
<p>
  An access token for requests is required and must be present in the Authorization header:
</p>
<pre><code class="language-http">Authorization: Bearer {access_token}</code></pre>
<p>
  The access token is a temporary OAuth2 access token that must be obtained from the Brightcove OAuth service. For details on how to obtain client credentials and use them to retrieve access tokens, see the <a href="https://support.brightcove.com/overview-oauth-api-v4">Brightcove OAuth Overview</a>.
</p>

<h3>Permissions</h3>
<p>
  Requests to the Cross-Device Resume API must be made from <a href="https://support.brightcove.com/oauth-api">client credentials</a> with the following permissions:
</p>
<ul>
  <li>
    <code>video-cloud/xdr/read</code>
  </li>
</ul>

<h3>API methods</h3>
<p>
  The Cross-Device Resume API supports the following requests. For details, see the <a href="https://docs.brightcove.com/en/staging/xdr/xdr-api/v1/doc/">Cross-Device Resume API Reference</a>.
</p>

<h4>Get viewer playheads</h4>
<p>
  This request gets all of the playheads for a viewer.
</p>
<pre><code class="language-http">GET /accounts/{accountID}/playheads/{viewerID}</code></pre>
<h5>Response body</h5>
<p>
  The response body contains an array of videos and playheads. It should look similar to this:
</p>
<pre class="line-numbers"><code class="language-json">{
  &quot;account_id&quot;: &quot;string&quot;,
  &quot;viewer_id&quot;: &quot;string&quot;,
  &quot;size&quot;: 0,
  &quot;items&quot;: [
    {
      &quot;video_id&quot;: &quot;string&quot;,
      &quot;timestamp&quot;: 0,
      &quot;playhead_seconds&quot;: 0
    }
  ]
}</code></pre>
<br />

<h4>Get viewer video playheads</h4>
<p>
  This request gets all of the playheads for a viewer and a specific video.
</p>
<pre><code class="language-http">GET /accounts/{accountID}/playheads/{viewerID}/{videoID}</code></pre>
<h5>Response body</h5>
<p>
  The response body contains an array of videos and playheads. It should look similar to this:
</p>
<pre class="line-numbers"><code class="language-json">{
  &quot;account_id&quot;: &quot;string&quot;,
  &quot;viewer_id&quot;: &quot;string&quot;,
  &quot;size&quot;: 0,
  &quot;items&quot;: [
    {
      &quot;video_id&quot;: &quot;string&quot;,
      &quot;timestamp&quot;: 0,
      &quot;playhead_seconds&quot;: 0
    }
  ]
}</code></pre>
<br />
</section>

<section class="bcls-section">
<h2 id="Using_a_server_side_proxy">Using a server-side proxy</h2>
<p>A proxy is a server-side application that acts as in intermediary between your client-side application and the REST API. If you are new to this, review the <a href="https://player.support.brightcove.com/getting-started/learning-guide-using-rest-apis.html">Learning Guide: Using the REST APIs</a></p>
<p>
   Here's an example of a web player making a call to a server-side proxy to get the playheads from the Cross-Device Resume API.
</p>
<pre class="line-numbers"><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
	&lt;meta charset=&quot;UTF-8&quot;&gt;
	&lt;title&gt;Cross-Device Resume Example&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

	&lt;video-js
	 id=&quot;myPlayerID&quot;
	 data-account=&quot;1752604059001&quot;
	 data-player=&quot;hyQW6GByl&quot;
	 data-embed=&quot;default&quot;
	 controls=&quot;&quot;
	 data-video-id=&quot;6156696074001&quot;
	 data-playlist-id=&quot;&quot;
	 data-application-id=&quot;&quot;
	 width=&quot;640&quot; height=&quot;360&quot;&gt;&lt;/video-js&gt;
	&lt;script src=&quot;https://players.brightcove.net/1752604059001/hyQW6GByl_default/index.min.js&quot;&gt;&lt;/script&gt;

	&lt;script&gt;
	  videojs.getPlayer('myPlayerID').ready(function() {
	    var myPlayer = this,
				accountId = myPlayer.bcinfo.accountId,
        options = {};

				// +++ Wait for loadstart event so can use mediainfo object +++
	      myPlayer.on('loadstart', function() {
	        var videoId = myPlayer.mediainfo.id,
	          baseURL = 'https://data.brightcove.com/v1/xdr/accounts/',
	          endPoint = accountId + '/playheads/' + viewerId + '/' + videoId;
	        options.proxyURL = &quot;https://solutions.brightcove.com/bcls/bcls-proxy/doc-samples-proxy-v2.php&quot;;
	        options.url = baseURL + endPoint;
	        options.requestType = &quot;GET&quot;;

	        // +++ Make the request to the Analytics API +++
	        // Extract views from data returned by Analytics API
	        makeRequest(options, function(viewsRaw) {
	          console.table(options);
	          var viewsCount;
	          // Remove console.log command for production code
	          console.log('viewsRaw', viewsRaw);
	          viewsObject = JSON.parse(viewsRaw);
	          console.log('viewsObject', viewsObject);
	          viewsCount = viewsObject.alltime_video_views;
	          console.log('views', viewsCount);
	          // Call function to place data in controlbar
	          placeCountInControlbar(viewsCount);
	        });
	      });
	    });

			/**
     * send API request to the proxy
     * @param  {Object} options for the request
     * @param  {String} options.url the full API request URL
     * @param  {String=&quot;GET&quot;,&quot;POST&quot;,&quot;PATCH&quot;,&quot;PUT&quot;,&quot;DELETE&quot;} requestData [options.requestType=&quot;GET&quot;] HTTP type for the request
     * @param  {String} options.proxyURL proxyURL to send the request to
     * @param  {String} options.client_id client id for the account (default is in the proxy)
     * @param  {String} options.client_secret client secret for the account (default is in the proxy)
     * @param  {JSON} [options.requestBody] Data to be sent in the request body in the form of a JSON string
     * @param  {Function} [callback] callback function that will process the response
     */
    function makeRequest(options, callback) {
      var httpRequest = new XMLHttpRequest(),
        response,
        requestParams,
        dataString,
        proxyURL = options.proxyURL,
        // response handler
        getResponse = function() {
          try {
            if (httpRequest.readyState === 4) {
              if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
                response = httpRequest.responseText;
                // some API requests return '{null}' for empty responses - breaks JSON.parse
                if (response === '{null}') {
                  response = null;
                }
                // return the response
                callback(response);
              } else {
                alert('There was a problem with the request. Request returned ' + httpRequest.status);
              }
            }
          } catch (e) {
            alert('Caught Exception: ' + e);
          }
        };
      /**
       * set up request data
       * the proxy used here takes the following request body:
       * JSON.strinify(options)
       */
      // set response handler
      httpRequest.onreadystatechange = getResponse;
      // open the request
      httpRequest.open('POST', proxyURL);
      // set headers if there is a set header line, remove it
      // open and send request
      httpRequest.send(JSON.stringify(options));
    }

	  });
	&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>

</section>

<!-- <section class="bcls-section">
<h2 id="Limitations">Limitations</h2>

<p>Here are the limitation associated with the cross-device resume.</p>

<ul>
	<li>The current version of this plugin does not support thumbnails on mobile devices.</li>
</ul>
</section> -->

<!-- <section class="bcls-section">
<h2 id="Changelog">Changelog</h2>

<p>See the <a href="https://docs.brightcove.com/en/staging/thumbnails/plugin-changelog.html">changelog here</a>.</p>
</section> -->
</article>

<!-- END DRUPAL CONTENT -->
</div>
</div>
<!-- bcl scripts -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
<script src="/en/scripts/docs-nav-data.min.js"></script>
<script src="/en/scripts/bcls-doc-site-v3.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
<script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
<script>
$(document).foundation();
</script>
<!-- Any scripts specific to page samples should go here -->
<script src="https://learning-services-media.brightcove.com/doc-assets/js/https-fix.js"></script>
<script src="https://learning-services-media.brightcove.com/doc-assets/js/support-feedback.js"></script><script src="https://learning-services-media.brightcove.com/doc-assets/site-assets/js/site/feedback-docs.js"></script>
</body>

</html>
