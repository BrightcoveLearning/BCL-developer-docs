<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title></title>
        <style>
        body {
        margin: 1em 2em;
        font-family: sans-serif;
        }
        h2 {
        font-size: 1.1em;
        }
        button {
        padding: .5em;
        }
        pre {
        background-color: #F1EFEE;
        border-left: .5em solid #636363;
        box-shadow: 5px 5px 10px rgba(192, 192, 192, 1.000);
        font-family: Hack, monospace;
        font-size: .8em;
        padding: 1em;
        }
        .buttonBlock {
        display: inline-block;
        padding: 0 .5em;
        }
        div:nth-of-type(2) {
        border-right: 1px solid #CCC;
        border-left: 1px solid #CCC;
        }
        #apiData {
        height: 170px;
        }
        </style>
    </head>
    <body>
        <h1>Analytics API Tester</h1>
        <p>Note that you must first create a video object, so other operations are disabled until you do that.</p>
        <div class="buttonBlock">
            <p><strong>Dimension Reports</strong></p>
            <p>
                <button id="account">Account</button>
                <button id="video">Video</button>
                <button id="player">Player</button>
                <button id="date">Date</button>
                <button id="destination_path">Destination Path</button>
                <button id="country">Country</button>
                <button id="source_type">Source Type</button>
                <button id="device_os">Device OS</button>
                <button id="videoCountry">Video and Country</button>
            </p>
        </div>
        <div class="buttonBlock">
            <p><strong>Parameters</strong></p>
            <p>
                <button id="multipleAccounts">Multiple Accounts</button>
                <button id="limitOffset">Limit and Offset</button>
                <button id="sort">Sort</button>
                <button id="dateRange">Date Range</button>
                <button id="fields">Fields</button>
                <button id="whereDevice">Device Filter</button>
                <button id="whereTags">Device Filter</button>
            </p>
        </div>
        <div class="buttonBlock">
            <p><strong>Engagement Reports</strong></p>
            <p>
                <button id="accountEngagement">Account</button>
                <button id="videoEngagement">Video</button>
                <button id="playerEngagement">Player</button>
            </p>
        </div>
        <p><strong>API request:</strong></p>
    <pre id="apiRequest"></pre>
<p><strong>Request method:</strong></p>
<pre id="apiMethod"></pre>
<p><strong>Response data</strong></p>
<pre id="responseData"></pre>
<script>
var BCLS = (function (window, document) {
        var reportURL = 'https://analytics.api.brightcove.com/v1/data',
            engagementURL = 'https://analytics.api.brightcove.com/v1/engagement/accounts/20318290001',
            proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/training-videos-proxy.php',
            video_id = '4562259880001',
            player_id = '901fa759-2353-412c-83ff-e8be6011e9f2',
            allButtons = document.getElementsByTagName('button'),
            account = document.getElementById('account'),
            video = document.getElementById('video'),
            player = document.getElementById('player'),
            date = document.getElementById('date'),
            destination_path = document.getElementById('destination_path'),
            source_type = document.getElementById('source_type');
            device_os = document.getElementById('device_os');
            videoCountry = document.getElementById('videoCountry');
            multipleAccounts = document.getElementById('multipleAccounts');
            limitOffset = document.getElementById('limitOffset');
            sort = document.getElementById('sort');
            fields = document.getElementById('fields');
            whereDevice = document.getElementById('whereDevice');
            whereTags = document.getElementById('whereTags');
            accountEngagement = document.getElementById('accountEngagement');
            videoEngagement = document.getElementById('videoEngagement');
            playerEngagement = document.getElementById('playerEngagement');
        /**
         * disables all buttons so user can't submit new request until current one finishes
         */
        function disableButtons() {
            var i,
                iMax = allButtons.length;
            for (i = 0; i < iMax; i++) {
                allButtons[i].setAttribute('disabled', 'disabled');
            }
        }
        /**
         * re-enables all buttons
         */
        function enableButtons() {
            var i,
                iMax = allButtons.length;
            for (i = 0; i < iMax; i++) {
                allButtons[i].removeAttribute('disabled');
            }
        }
        /**
         * sets up the data for the API request
         * @param {String} id the id of the button that was clicked
         */
        function setRequestData(id) {
            var endPoint = '',
                requestData = {};
            // disable buttons to prevent a new request before current one finishes
            disableButtons();
            switch (id) {
            case 'createVideo':
                endPoint = '/videos';
                requestData.url = baseURL + endPoint;
                requestData.requestType = 'POST';
                requestData.requestBody = {
                    name: 'New Video from Dynamic Ingest API Quick Start'
                };
                apiRequest.textContent = requestData.url;
                apiData.textContent = JSON.stringify(requestData.requestBody, null, '  ');
                apiMethod.textContent = requestData.requestType;
                getMediaData(requestData, id);
                break;
            case 'ingestVideo':
                endPoint = '/videos/' + newVideo_id;
                requestData.url = ingestURL + endPoint + ingestURLsuffix;
                requestData.requestType = 'POST';
                requestData.requestBody = {
                    master: {
                        url: 'http://learning-services-media.brightcove.com/videos/mp4/greatblueheron.mp4'
                    },
                    profile: 'videocloud-default-v1',
                    'capture-images': true
                };
                apiRequest.textContent = requestData.url;
                apiData.textContent = JSON.stringify(requestData.requestBody, null, '  ');
                apiMethod.textContent = requestData.requestType;
                getMediaData(requestData, id);
                break;
            case 'retranscode':
                endPoint = '/videos/' + newVideo_id;
                requestData.url = ingestURL + endPoint + ingestURLsuffix;
                requestData.requestType = 'POST';
                requestData.requestBody = {
                    master: {
                        use_archived_master: true
                    },
                    profile: 'smart-player-transition',
                    'capture-images': true
                };
                apiRequest.textContent = requestData.url;
                apiData.textContent = JSON.stringify(requestData.requestBody, null, '  ');
                apiMethod.textContent = requestData.requestType;
                getMediaData(requestData, id);
                break;
            case 'replace':
                endPoint = '/videos/' + newVideo_id;
                requestData.url = ingestURL + endPoint + ingestURLsuffix;
                requestData.requestType = 'POST';
                requestData.requestBody = {
                    master: {
                        url: 'http://learning-services-media.brightcove.com/videos/mp4/greathornedowl.mp4'
                    },
                    profile: 'videocloud-default-v1',
                    'capture-images': true
                };
                apiRequest.textContent = requestData.url;
                apiData.textContent = JSON.stringify(requestData.requestBody, null, '  ');
                apiMethod.textContent = requestData.requestType;
                getMediaData(requestData, id);
                break;
            case 'addImages':
                endPoint = '/videos/' + newVideo_id;
                requestData.url = ingestURL + endPoint + ingestURLsuffix;
                requestData.requestType = 'POST';
                requestData.requestBody = {
                    poster: {
                        url: 'http://learning-services-media.brightcove.com/images/for_video/Water-In-Motion-poster.png',
                        width: 640,
                        height: 360
                    },
                    'thumbnail': {
                        url: 'http://learning-services-media.brightcove.com/images/for_video/Water-In-Motion-thumbnail.png',
                        width: 160,
                        height: 90
                    },
                };
                apiRequest.textContent = requestData.url;
                apiMethod.textContent = requestData.requestType;
                apiData.textContent = JSON.stringify(requestData.requestBody, null, '  ');
                getMediaData(requestData, id);
                break;
            case 'addTextTracks':
                endPoint = '/videos/' + newVideo_id;
                requestData.url = ingestURL + endPoint + ingestURLsuffix;
                requestData.requestType = 'POST';
                requestData.requestBody = {
                    text_tracks: [{
                        url: 'http://learning-services-media.brightcove.com/captions/for_video/Water-in-Motion.vtt',
                        srclang: 'en',
                        kind: 'captions',
                        label: 'EN',
                        default: true
                    }]
                };
                apiRequest.textContent = requestData.url;
                apiMethod.textContent = requestData.requestType;
                apiData.textContent = JSON.stringify(requestData.requestBody, null, '  ');
                getMediaData(requestData, id);
                break;
            }
        }
        /**
         * send API request to the proxy
         * @param  {Object} requestData options for the request
         * @param  {String} requestID the type of request = id of the button
         */
        function getMediaData(options, requestID) {
            var httpRequest = new XMLHttpRequest(),
                responseRaw,
                parsedData,
                requestParams,
                dataString,
                // response handler
                getResponse = function () {
                    try {
                        if (httpRequest.readyState === 4) {
                            if (httpRequest.status === 200) {
                                console.log(httpRequest.responseText);
                                responseRaw = httpRequest.responseText;
                                responseData.textContent = responseRaw;
                                parsedData = JSON.parse(responseRaw);
                                // save new ids on create requests
                                if (requestID === 'createVideo') {
                                    newVideo_id = parsedData.id;
                                }
                                responseData.textContent = JSON.stringify(parsedData, null, '  ');
                                // re-enable the buttons
                                enableButtons();
                            } else {
                                alert('There was a problem with the request. Request returned ' + httpRequest.status);
                            }
                        }
                    } catch (e) {
                        alert('Caught Exception: ' + e);
                    }
                };
            // set up request data
            requestParams = 'url=' + encodeURIComponent(options.url) + '&requestType=' + options.requestType;
            if (options.requestBody) {
                dataString = JSON.stringify(options.requestBody);
                requestParams += '&requestBody=' + encodeURIComponent(dataString);
            }
            console.log(requestParams);
            // set response handler
            httpRequest.onreadystatechange = getResponse;
            // open the request
            httpRequest.open('POST', proxyURL);
            // set headers
            httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            // open and send request
            httpRequest.send(requestParams);
        }
        // event listeners
        createVideo.addEventListener('click', function () {
            setRequestData('createVideo');
        });
        ingestVideo.addEventListener('click', function () {
            setRequestData('ingestVideo');
        });
        retranscode.addEventListener('click', function () {
            setRequestData('retranscode');
        });
        replace.addEventListener('click', function () {
            setRequestData('replace');
        });
        addImages.addEventListener('click', function () {
            setRequestData('addImages');
        });
        addTextTracks.addEventListener('click', function () {
            setRequestData('addTextTracks');
        });
    })(window, document);
</script>
</body>
</html>