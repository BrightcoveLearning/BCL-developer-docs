<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Begin Drupal Taxonomy Data -->
    <meta name="product" content="Video Cloud">
    <meta name="audience" content="API Developer">
    <meta name="task" content="Dynamic Ingest API">
    <meta name="feature" content="General Information">
    <meta name="keywords" content="Upload Videos">
    <!-- End Drupal Taxonomy Data -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title>Source File Upload API for Dynamic Ingest</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <link href='//fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link rel="stylesheet" href="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.css">
    <link rel="stylesheet" href="//docs.brightcove.com/en/styles/template-less/css/bcls-doc.css">
    <link rel="stylesheet" href="/en/styles/foundation-fixes.css">

    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-2728311-29', 'auto');
        ga('send', 'pageview');
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
    <!-- header navbar -->
    <div id="navWrapper" class="fixed"></div>
    <!-- breadcrumbs -->
    <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
    <!-- search -->
    <div id="searchModal" class="reveal-modal" data-reveal></div>
    <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
            <h1>Source File Upload API for Dynamic Ingest</h1>
            <!-- begin drupal content -->
            <article class="bcls-article">
                <header id="bcls_header" class="bcls-header">
                    <p>In this topic, you will learn how to add videos to your Video Cloud account using the Source File Upload API for Dynamic Ingest. The Source File Upload API provides the ability to upload (“push”) source files into Video Cloud via Dynamic Ingest.</p>
                </header>
                <section class="bcls-section" id="introduction">
                    <h2>Introduction</h2>
                    <p>For ingest via source file upload, Brightcove provides an S3 bucket that you can upload your videos and asset files to, and Dynamic Ingest then pulls the video from S3 bucket in same way it would from your own S3 bucket or URL. The diagram below shows the difference between the workflows for basic dynamic ingest and ingest with source file upload.</p>
                    <figure class="bcls-figure">
                        <img class="bcls-image" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/di-api/guides/push-based-ingest/source-file-upload.png" alt="Workflow Differences">
                        <figcaption class="bcls-caption--image">Workflow Differences</figcaption>
                    </figure>
                </section>
                <section id="authentication" class="bcls-section">
                    <h2>Authentication</h2>
<p>The easiest way to get client credentials for Dynamic Ingest is through <a href="https://support.brightcove.com/en/video-cloud/docs/managing-api-authentication-credentials">the Studio Admin page for API Authentication</a>. For the API permissions, you need at least:</p>
<ul>
    <li>CMS &gt; Video Read</li>
    <li>Dynamic Ingest &gt; Create </li>
    <li>Dynamic Ingest &gt; Push Files (this is the new Source File Upload API) </li>
</ul>
<figure class="bcls-figure">
    <img class="bcls-image" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/di-api/guides/push-based-ingest/api-credentials-studio.png" alt="API Authetication">
    <figcaption class="bcls-caption--image">API Authetication</figcaption>
</figure>
                    <p>Authentication for Brightcove API requests for push-based ingestion require one additional permission over those for <a href="//docs.brightcove.com/en/video-cloud/di-api/getting-started/overview-di.html#operations">other Dynamic Ingest requests</a>:</p>
<pre class="line-numbers"><code class="language-bash">video-cloud/upload-urls/read</code></pre>
                    <p>The full set of permissions needed for source file upload is:</p>
                    <ul>
                        <li>video-cloud/video/create</li>
                        <li>video-cloud/video/read</li>
                        <li>video-cloud/video/update</li>
                        <li><span class="bcls-highlight">video-cloud/upload-urls/read</span></li>
                    </ul>
                    <p>The new permission will soon be available in Studio. Until then, you can obtain client credentials to use the source file upload API directly from the OAuth API by making a POST request as follows:</p>
                    <h3>Request URL</h3>
<pre class="line-numbers"><code class="language-http">https://oauth.brightcove.com/v3/client_credentials</code></pre>
                    <h3>Headers</h3>
                    <ul>
                        <li><code>Authorization: BC_TOKEN <span class="bcls-highlight">{YOUR_BC_TOKEN}</span></code></li>
                        <li><div>Content-Type: application/json</div></li>
                    </ul>
                    <h3>Request body</h3>
<pre class="line-numbers"><code class="language-json">{
  "type": "credential",
  "maximum_scope": [
    {
      "identity": {
        "type": "video-cloud-account",
        "account-id": <span class="bcls-highlight">{YOUR_ACCOUNT_ID}</span>
      },
      "operations": [
        "video-cloud/upload-urls/read",
        "video-cloud/video/create",
        "video-cloud/video/read",
        "video-cloud/video/update",
        "video-cloud/ingest-profiles/profile/write",
        "video-cloud/ingest-profiles/account/write",
        "video-cloud/ingest-profiles/profile/read",
        "video-cloud/ingest-profiles/account/read"
      ]
    }
  ],
  "name": "Source File Upload Credentials"
}</code></pre>
                </section>
                <section id="apiCalls" class="bcls-section">
                    <h2>API requests</h2>
                    <p>There are four API requests involved in push-based ingestion:</p>
                    <ol>
                        <li>CMS API POST request to create the video object in Video Cloud (same as for pull-based ingestion)</li>
                        <li>Dynamic Ingest GET request to get the Brightcove S3 bucket URLs</li>
                        <li>PUT request to upload the source file to the Brightcove S3 bucket</li>
                        <li>Dynamic Ingest POST request to ingest the source file (same as for pull-based ingestion)</li>
                    </ol>
                    <p>These requests are detailed in the sections that follow.</p>
                </section>
                <section id="cmsRequest" class="bcls-section">
                    <h2>CMS API request</h2>
                    <p>The CMS API request is the same as for any Dynamic Ingest operation to add a new video. This request is required to ingest a new video. If are replacing or adding assets to an existing video, you will not need this step - instead, you will use the existing video id in the other requests.</p>
                    <h3>Request syntax</h3>
                    <p>This is a <code>POST</code> request to:</p>
<pre class="line-numbers"><code class="language-http">https://cms.api.brightcove.com/v1/accounts/<span class="bcls-highlight">{ACCOUNT_ID}</span>/videos</code></pre>
                    <h4>Parameters</h4>
                    <p>URL parameters for the request:</p>
                    <ul>
                        <li><code>{ACCOUNT_ID}</code> - your account id</li>
                    </ul>
                    <h4>Request body</h4>
                    <p>The request body consists of a JSON object containing the <code>name</code> (required) and other metadata for the video (optional):</p>
<pre class="line-numbers"><code class="language-json">{
    "name": "My Video"
}</code></pre>
                    <p>See the <a href="//docs.brightcove.com/en/video-cloud/di-api/reference/versions/v1/index.html#api-Video-Create_Video_Object">API Reference</a> for details.</p>
                    <h4>Headers</h4>
                    <p>The HTTP headers you need to include with the request are:</p>
                    <ul>
                        <li><code>Authorization: Bearer {ACCESS_TOKEN}</code></li>
                        <li><code>Content-Type: application/json</code></li>
                    </ul>
                    <h4>Response</h4>
                    <p>The response will be a JSON object containing the video metadata. The important item for the rest of the Dynamic Ingest operations is the <code>id</code>, which you will substiture for the <code>{VIDEO_ID}</code> in the requests to the Ingest API.</p>
                <section id="S3urlRequest" class="bcls-section">
                    <h2>Request for S3 URLs</h2>
                    <p>The first request to the Ingest API will retrieve the information you need to PUT your source file(s) to the Brightcove S3 bucket and then ingest from there into Video Cloud.</p>
                     <h3>Request syntax</h3>
                    <p>This is a <code>GET</code> request to:</p>
<pre class="line-numbers"><code class="language-http">https://ingest.api.brightcove.com/v1/accounts/<span class="bcls-highlight">{ACCOUNT_ID}</span>/videos/<span class="bcls-highlight">{VIDEO_ID}</span>/upload-urls/<span class="bcls-highlight">{SOURCE_NAME}</span></code></pre>
                    <h4>Parameters</h4>
                    <p>URL parameters for the request:</p>
                    <ul>
                        <li><code>{ACCOUNT_ID}</code> - your account id</li>
                        <li><code>{VIDEO_ID}</code> - the video id returned from CMS API request</li>
                        <li><code>{SOURCE_NAME}</code> - a URI-encoded version of the video file name (URI-encoding required if the file name contains spaces or other characters that would break a URL) - examples: <code>MyVideo.mp4</code> or <code>My%20Video.mp4</code> (URI-encoded version of "My Video.mp4")</li>
                    </ul>
                    <h4>Headers</h4>
                    <p>The HTTP headers you need to include with the request are:</p>
                    <ul>
                        <li><code>Authorization: Bearer {ACCESS_TOKEN}</code></li>
                    </ul>
                    <h4>Response</h4>
                    <p>The response will be a JSON object similar to the following:</p>
<pre class="line-numbers"><code class="language-json">{
  "bucket": "ingestion-upload-production",
  "object_key": "57838016001/4752143002001/ed5a5ba0-1d97-4f95-a8ec-cbb786b04a37/greatblueheron.mp4",
  "access_key_id": "ASIAIF7SEBHDCYV7ICRA",
  "secret_access_key": "HkBQXEqMb8r+CQZatYNXc/JWPRt21v1C+pa84uN1",
  "session_token": "FQoDYXdzEKf//////////wEaDKR0wDgquq/qvkZgbyKOA7URC/9io6cmRBDkhbvxoHIKkPZlK/9YNvdWcESPkm75/2PvU6FV1Mc+/XENPzY8KgvP86MBJNxYLPdkuP1phgHs2Yh2p1KIDcQS66sIA1ovmYEp2bJDH5GOR9Bx2hi6yoChF9HSQc5FnGA3MEnJwucdb3mmr8Un/TW3TAgxepj9kWyprgHkm2gBZDhjlutP6G0pqVS1G5ZNdWDVX9p3X+X3RjE6VRzi/smy+tF8kUtJUugZVc1eM1v1K+Zj97OssmXGeRCCViBliu44sr4toNAkk+U54lAAwoJONu0awujeF8lHXeU8mbKPM6LT9oc42fSjQsOsoECZJ3i6i9m4S14ewjWIugYLYDQi6CG+3fiFwfzbKT5jes1kh24m9BQQIuvVOiM1GLTldyDzlrdDopJkdYd4IEU7FU36CUT7RL/aeMwR2Usk56nwqyqkkQHPmvqmGyiLdrD3OrIbUU+6+ZP4usS9dbV3eAqOWDIk3HCN+Kuc9f/eUWhY21ftNDXWgasqQqXwPRs3T1i/hoiIKODbzr8F",
  <span class="bcls-highlight">"signed_url": "https://ingestion-upload-production.s3.amazonaws.com/57838016001/4752143002001/ed5a5ba0-1d97-4f95-a8ec-cbb786b04a37/greatblueheron.mp4?AWSAccessKeyId=AKIAJZKRHWB4FUFMCPPA&Expires=1475673952&Signature=%2Fsr5cV%2FVOfGCBkodol9xQIKlbu4%3D"</span>,
  <span class="bcls-highlight">"api_request_url": "https://ingestion-upload-production.s3.amazonaws.com/57838016001/4752143002001/ed5a5ba0-1d97-4f95-a8ec-cbb786b04a37/greatblueheron.mp4"</span>
}</code></pre>
                    <p>The items in the response are:</p>
                    <ul>
                        <li><code>bucket</code> - the S3 bucket name</li>
                        <li><code>object_key</code> - the object key for the file upload (used in constructing the destination URL for multipart uploads)</li>
                        <li><code>access_key_id</code> - the access key used for authenticating the upload request (used for multipart uploads)</li>
                        <li><code>secret_access_key</code> - the secret access key used for authenticating the upload request (used for multipart uploads)</li>
                        <li><code>session_token</code> - a short-lived AWS token that provides the capability to write to the target objec</li>
                        <li><code>SignedUrl</code> - this is a shorthand S3 url that you can PUT your source file(s) to if you have relatively small videos and are not implementing multipart upload</li>
                        <li><code>ApiRequestUrl</code> - this is the URL you will include in your Dynamic Ingest POST request for the Master url or url for the image/text_tracks assets</li>
                    </ul>
                    <p>It is recommended that you use multipart upload using the AWS SDK for the language you are using. SDKs are available for many languages, including Java, .NET, Ruby, PHP, Python, JavaScript, Go, and C++. See the <a href="https://aws.amazon.com/blogs/developer/">AWS Developer Blog</a> for more information.</p>
                    <p>If you are implementing multipart upload, the following documents and sample code will be useful:</p>
                    <ul>
                        <li><a href="//docs.aws.amazon.com/AmazonS3/latest/dev/llJavaUploadFile.html">Upload a File</a></li>
                        <li><a href="//github.com/BrightcoveLearning/dynamic-ingest-code-samples/blob/master/dynamic-ingest/java/src/main/java/com/brightcove/ingest/App.java">Java sample</a></li>
                        <li><a href="//github.com/BrightcoveLearning/dynamic-ingest-code-samples/blob/master/dynamic-ingest/python/di-example-source-file-multipart-upload.py">Python sample</a></li>
                    </ul>
                    <p>Here is simple example in PHP:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
    // AWS SDK (for push ingests)
    require 'vendor/aws-autoloader.php';

    use Aws\S3\S3Client;
    use Aws\S3\MultipartUploader;
    use Aws\Exception\MultipartUploadException;

    /**
     * get S3 information as described above in this doc
     * the code below assumes it has been decoded as $s3response
     * and that $filePath is the local path to the asset file
     */

    s3 = new S3Client([
        'version' =&gt; 'latest',
        'region'  =&gt; 'us-east-1',
        'credentials' =&gt; array(
            'key'    =&gt; $s3response-&gt;access_key_id,
            'secret' =&gt; $s3response-&gt;secret_access_key,
            'token'	 =&gt; $s3response-&gt;session_token
        )
    ]);
    $params = array(
        'bucket' =&gt; $s3response-&gt;s3-&gt;bucket,
        'key' =&gt; $s3response-&gt;s3-&gt;object_key
    );
    $uploader = new MultipartUploader($this-&gt;s3, $filePath, $params);
    try {
        $uploadResponse = $uploader-&gt;upload();
    } catch (MultipartUploadException $e) {
        echo $e-&gt;getMessage() . "\n";
    }
?&gt;</code></pre>
                    <aside class="bcls-aside bcls-aside--information">
                        <ul>
                            <li>Note that the URLs are valid for <strong>24 hours</strong> - if you do not complete the Dynamic Ingest operations within 24 hours, you will have to make a new request for new URLs.</li>
                            <li>Dynamic Ingest allows no more than 100 jobs running concurrently per account</li>
                        </ul>

                    </aside>
                </section>
                </section>
                <section id="S3PUTRequest" class="bcls-section">
                    <h2>PUT source file(s) to S3</h2>
                    <p>After getting the S3 URLs, you make a PUT request to upload your video file, using the <code>SignedUrl</code> as the destination.</p>
                </section>
                <section id="DIrequest" class="bcls-section">
                    <h2>Dynamic Ingest request</h2>
                    <p>After your file has uploaded to the Brightcove S3 bucket, you make an ordinary Dynamic Ingest request to ingest the file from its S3 location.</p>
                    <h3>Request syntax</h3>
                    <p>This is a <code>POST</code> request to:</p>
<pre class="line-numbers"><code class="language-http">https://ingest.api.brightcove.com/v1/accounts/<span class="bcls-highlight">{ACCOUNT_ID}</span>/videos/<span class="bcls-highlight">{VIDEO_ID}</span>/ingest-requests</code></pre>
                    <h4>Parameters</h4>
                    <p>URL parameters for the request:</p>
                    <ul>
                        <li><code>{ACCOUNT_ID}</code> - your account id</li>
                        <li><code>{VIDEO_ID}</code> - the video id returned from CMS API request</li>
                    </ul>
                    <h4>Request body</h4>
                    <p>The request body consists of a JSON object containing the <code>master</code> (required) details for the ingest job. The <code>url</code> for the <code>master</code> will be the <code>ApiRequestUrl</code> returned by the request for the S3 bucket information</p>
<pre class="line-numbers"><code class="language-json">{
    "master": {
        "url": "<span class="bcls-highlight">https://ingestion-upload-prod.s3.amazonaws.com/12345/5678/3712cd37504911ab06a77a26a387ce/source.mp4</span>"
    },
    "profile": "high-resolution",
    "capture-images": true
}</code></pre>
                    <p>See the <a href="//docs.brightcove.com/en/video-cloud/di-api/reference/versions/v1/index.html#api-Ingest-Ingest_Media_Asset">API Reference</a> for details.</p>
                    <h4>Headers</h4>
                    <p>The HTTP headers you need to include with the request are:</p>
                    <ul>
                        <li><code>Authorization: Bearer {ACCESS_TOKEN}</code></li>
                        <li><code>Content-Type: application/json</code></li>
                    </ul>
                    <h4>Response</h4>
                    <p>The response will contain the <code>job_id</code> for the ingest request, which allows you to track the status via <a href="//docs.brightcove.com/en/video-cloud/media-management/guides/notifications.html">Notifications</a>.</p>
                </section>
                <section id="codeSamples" class="bcls-section">
                    <h2>Sample code</h2>
                    <p>To help you get started with push-based Dynamic Ingest, we have created some sample apps in Java and Python. You can find them on our <a href="//github.com/BrightcoveLearning/dynamic-ingest-code-samples">Github site</a>.</p>
                    <aside class="bcls-aside bcls-aside--information">Sample code is offered as is, and is not supported by Brightcove.</aside>
                </section>
            </article>
            <section class="bcls-section" id="BCLreferences">
                <h2>Related Topics</h2>
                <ul>
                    <li><a href="//docs.brightcove.com/en/video-cloud/di-api/getting-started/overview-di.html">Dynamic Ingest API Overview</a></li>
                    <li><a href="//docs.brightcove.com/en/video-cloud/di-api/getting-started/quick-start-di.html">Quick Start to Dynamic Ingest</a></li>
                </ul>
            </section>
        </div>
    </div>
    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.4/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site-v2.js"></script>
    <script src="//learning-services-media.brightcove.com/doc-assets/js/bcls-utils.js"></script>
    <script src="//learning-services-media.brightcove.com/doc-assets/js/prism/prism.js"></script>
    <script>
        $(document).foundation();
    </script>


<div style="text-align:center">
    <iframe id="CSAT" src="//learning-services-media.brightcove.com/doc-assets/general/surveylink.html" style=" padding-bottom:20px;border:none"></iframe>
</div>
<div class="bcls-footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>

</html>
