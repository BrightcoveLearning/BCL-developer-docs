<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title>Set Default Profile for Mulitple Accounts</title>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <link rel="stylesheet" type="text/css" href="//docs.brightcove.com/en/styles/bcls-doc-site.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/atelier-forest.light.min.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

    <style>
    input, select {
        max-width: 60%;
        font-size: .8rem;
    }
    fieldset {
        border: 1px #366 solid;
        border-radius: 5px;
    }
    textarea {
        background-color: #F1EFEE;
        border-left: .5em solid #636363;
        box-shadow: 5px 5px 10px rgba(192, 192, 192, 1.000);
        font-family: Hack, monospace;
        font-size: .8em;
        padding: 1em;
        width: 95%;
    }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
    <!-- header navbar -->
    <div id="navWrapper" class="fixed"></div>
    <!-- breadcrumbs -->
    <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
    <!-- search -->
    <div id="searchModal" class="reveal-modal" data-reveal></div>
    <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-large-up">
            <div id="sidenav" class="side-nav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">
            <div id="top" class="section">
                <h1>Set Default Profile for Mulitple Accounts</h1>
                <p>This sample app uses the Ingest Profiles API to set the default ingest profile for multiple accounts. You can also set the default profile in the <a href="https://studio.brightcove.com/products/videocloud/admin/ingestprofiles">Admin&gt;Ingest Profiles</a> settings in Studio, but this app offers the convenience of setting this for some or all of your accounts at once.</p>
            </div>
            <div id="obtaincredentials" class="section">
                <h2>Obtain credentials</h2>
                <p>Like most of Brightcove's RESTful APIs, the Ingest Profiles API requires OAuth access tokens to authorize requests. In order to get access tokens, you first need to obtain client credentials with permissions for kinds of operations you want to request. For the Ingest Profiles API, credentials currently have to be obtained using the <a href="../../oauth-api/getting-started/oauth-api-overview.html">OAuth API</a>.</p>
                <p>If you already have client credentials with permissions for profile operations, you can skip directly to the <a href="#Set_default_profile_app">app below</a>. If you need credentials, the following steps walk you through the process.</p>
                <ol>
                  <li>Login in to Studio.</li>
                  <li>Open the Developer Tools in your browser, and go to the Console.</li>
                  <li>
                      Copy the following JavaScript code, paste it into the Console, and press return:
<pre><code>var cookiesArray = document.cookie.split(";"), cookiesObj = {}, i, tmpArray = [];
for (i = 0; i &lt; cookiesArray.length; i++) {
    tmpArray = cookiesArray[i].split("=");
    cookiesObj[tmpArray[0].replace(/\s/g, "")] = tmpArray[1];
}
window.prompt("BC_TOKEN:", cookiesObj.BC_TOKEN);</code></pre>
                  </li>
                  <li>
                      Copy and paste you BC_TOKEN and a comma-separated list of the accounts that you want to set default profiles for into the form below. Then click the <strong>Get Credentials</strong> button:
                      <fieldset>
                          <legend>Get Client Credentials</legend>
                          <p>BC_TOKEN: <input type="text" id="bc_token"></p>
                          <p>Account id: <input type="text" id="account_ids_creds" placeholder="123456789,987654321,56473829"></p>
                          <p><button id="getCredentials" class="bcls-button">Get Credentials</button></p>
                      </fieldset>
                  </li>
                  <li>Your client id and client secret should now appear in the <a href="#Set_default_profile_app">app below</a>. If you wish to save them for other purposes, copy and save them somewhere secure before leaving this page.</li>
                  </ol>
                </div>

            <div class="section" id="Set_default_profile_app">
                <h2>Set default profile app</h2>
                <p>You can use the form below to generate a sample MRSS feed either for your own account or for a sample Brightcove account.</p>
                <fieldset>
                    <legend>Input</legend>
                    <p>
                        If you do not enter account information, a Brightcove sample account will be used.
                    </p>
                    <p>Account id: <input id="account_ids" type="text" placeholder="1752604059001"></p>
                    <p>Client id: <input id="client_id" type="text" size="60" placeholder="c5d0a622-5479-46d8-8d8a-5f034b943fab"></p>
                    <p>Client secret: <input id="client_secret" type="text" size="60" placeholder="w7NQYu0vUloM4GYYy2SXAxrvyFpt8fwI35qAFZcS13-VIgs0itwKNsAwHOS80sOWKJ1BUwHIvSFG2I"></p>
                    <p>Profile to set as default: <select name="profileSelect" id="profileSelect" style="width:100px;"></select></p>
                    <p><button class="bcls-button" id="setDefaults">Generate the Feed</button></p>
                </fieldset>
                <fieldset>
                    <legend>Output</legend>
                    <p id="logger" style="color:rgb(237, 104, 38)">Waiting for input...</p>
                    <p>Current API request</p>
                    <pre><code id="apiRequest"></code></pre>
                    <p>Generated MRSS feed</p>
                    <textarea id="apiResponse" style="width:95%;height:30em;"></textarea>
                </fieldset>
            </div>
        </div>
    </div>
    <!-- bcl scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script src="//docs.brightcove.com/en/scripts/docs-nav-data.min.js"></script>
    <script src="//docs.brightcove.com/en/scripts/bcls-doc-site-v1.js"></script>
    <script src="//docs.brightcove.com/en/scripts/vkbeautify.0.99.00.beta.js"></script>
<script id="pageScript">
var BCLS = ( function (window, document) {
        var // account stuff
        accountId,
        bcToken,
        clientId,
        clientSecret,
        // api stuff
        proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/mrss-proxy.php',
        oauthURL = 'https://oauth.brightcove.com/v4/client_credentials',
        baseURL = 'https://ingestion.api.brightcove.com/v1/accounts/',
        baseURLsuffix = '/configuration',
        totalCalls = 0,
        callNumber = 0,
        accountsArray = [],
        defaultAccounts = ['921483702001', '1937897674001', '47509719001'],
        profilesArray = ['smart-player-transition', 'videocloud-default-v1', 'high-resolution', 'screencast-1280', 'single-bitrate-high', 'single-bitrate-standard'],
        operationsArray = ['video-cloud/ingest-profiles/profile/read', 'video-cloud/ingest-profiles/profile/write', 'video-cloud/ingest-profiles/account/read', 'video-cloud/ingest-profiles/account/write'],
        // elements
        bc_token = document.getElementById('bc_token'),
        getCredentials = document.getElementById('getCredentials'),
        account_ids = document.getElementById('account_ids'),
        bc_token = document.getElementById('bc_token'),
        account_ids_cred = document.getElementById('account_ids_cred'),
        client_id = document.getElementById('client_id'),
        client_secret = document.getElementById('client_secret'),
        profileSelect = document.getElementById('profileSelect'),
        setDefaults = document.getElementById('setDefaults'),
        logger = document.getElementById('logger'),
        apiRequest = document.getElementById('apiRequest'),
        apiResponse = document.getElementById('apiResponse');

    /**
     * tests for all the ways a variable might be undefined or not have a value
     * @param {String|Number} x the variable to test
     * @return {Boolean} true if variable is defined and has a value
     */
    function isDefined(x){
        if ( x === "" || x === null || x === undefined || x === NaN) {
            return false;
        }
        return true;
    }

    /**
     * get selected value for single select element
     * @param {htmlElement} e the select element
     */
    function getSelectedValue(e) {
        return e.options[e.selectedIndex].value;
    }


    /**
     * disables a button so user can't submit new request until current one finishes
     */
    function disableButton(button) {
        button.setAttribute('disabled', 'disabled');
        button.setAttribute('style', 'opacity:.5,cursor:not-allowed;');
    }

    /**
    * enables a button
    * @param {htmlElement} button - the button to enable
    */
    function enableButton(button) {
        button.removeAttribute('disabled');
        button.setAttribute('style', 'opacity:1;cursor:pointer;');
    }

    /**
     * sets up the data for the API request
     * @param {String} id the id of the button that was clicked
     */
    function setRequestData(id) {
        var i,
            iMax,
            requestData = {};
        switch (id) {
            case 'getCredentials':
                var i,
                    iMax,
                    dataStr1 = 'name=Set_Default_Profiles_App&maximum_scope=[',
                    dataStr2 = '{"identity": {"type": "video-cloud-account","account-id":',
                    dataStrEnd = ']}]',
                    dataStrs = [],
                    callback = function (credentials) {
                        client_id.value = credentials.client_id;
                        client_secret.value = credentials.client_secret;
                        account_ids.value = account_ids_cred.value;
                        disableButton(getCredentials);
                        enableButton(setDefaults);
                    };
                accountsArray = account_ids_cred.join(',');
                // set up data
                iMax = accountsArray.length;
                for (i = 0; i < iMax; i++) {
                    dataStrs[i] = dataStr2 + accountsArray[1] + '},"operations:"' + JSON.stringify(operationsArray) + '}';
                }
                console.log(JSON.stringify(dataStrs));
                requestData.url = oauthURL;
                requestData.requestType = 'POST';
                apiRequest.textContent = requestData.url;
                // sendRequest(requestData, id, callback);
                break;
            case 'setDefaults':
            endPoint = accountId + '/videos?sort=' + sort + '&limit=' + limit + '&offset=' + limit * callNumber;
            if (isDefined(search)) {
                endPoint += '&search=' + search;
            }
            requestData.url = baseURL + endPoint;
            requestData.requestType = 'GET';
            apiRequest.textContent = requestData.url;
            sendRequest(requestData, id);
            break;
        }
    }

    /**
     * send API request to the proxy
     * @param  {Object} requestData options for the request
     * @param  {String} requestID the type of request = id of the button
     * @param  {Function} [callback] callback function
     */
    function sendRequest(options, requestID, callback) {
        var httpRequest = new XMLHttpRequest(),
            responseRaw,
            parsedData,
            requestParams,
            dataString,
            sources,
            // response handler
            getResponse = function() {
                try {
                    if (httpRequest.readyState === 4) {
                        if (httpRequest.status === 200) {
                            // check for completion
                            if (requestID === 'getCredentials') {
                                responseRaw = httpRequest.responseText;
                                parsedData = JSON.parse(responseRaw);
                                // set total videos
                                totalVideos = parsedData.count;
                                totalCalls = Math.ceil(totalVideos / limit);
                                logger.textContent = 'Total videos: ' + totalVideos;
                                setRequestData('getVideos');
                            } else if (requestID === 'setDefaults') {
                                if (httpRequest.responseText === '[]') {
                                    // no video returned
                                    alert('no video returned');
                                }
                                responseRaw = httpRequest.responseText;
                                parsedData = JSON.parse(responseRaw);
                                videosArray = videosArray.concat(parsedData);
                                callNumber++;
                                if (callNumber < totalCalls) {
                                    logger.textContent = 'Getting video set ' + callNumber;
                                    setRequestData('getVideos');
                                } else {
                                    logger.textContent = 'Video data for ' + totalVideos + ' retrieved; getting sources...';
                                    callNumber = 0;
                                    setRequestData('getVideoSources');
                                }
                            } else if (requestID === 'getVideoSources') {
                                if (httpRequest.responseText === '[]') {
                                    // no video returned
                                    sources = [];
                                    callback(sources);
                                } else {
                                    responseRaw = httpRequest.responseText;
                                    sources = JSON.parse(responseRaw);
                                    // increment offset
                                    callback(sources);
                                }

                            } else {
                              alert('There was a problem with the request. Request returned ' + httpRequest.status);
                            }
                        }
                    }
                } catch (e) {
                    alert('Caught Exception: ' + e);
                }
            };
        // set up request data
        requestParams = "url=" + encodeURIComponent(options.url) + "&requestType=" + options.requestType;
        // only add client id and secret if both were submitted
        if (isDefined(clientId) && isDefined(clientSecret)) {
            requestParams += '&client_id=' + clientId + '&client_secret=' + clientSecret;
        }

        // set response handler
        httpRequest.onreadystatechange = getResponse;
        // open the request
        httpRequest.open('POST', proxyURL);
        // set headers
        httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        // open and send request
        httpRequest.send(requestParams);
    }

    function init() {
        var i,
            iMax,
            opt;
        // set up profiles selector
        iMax = profilesArray.length;
        for (i = 0; i < iMax; i++) {
            opt = document.createElement('option');
            opt.value = profilesArray[i];
            opt.text = profilesArray[i];
            profileSelect.add(opt, null)
        }
        // event handlers
        setDefaults.addEventListener('click', function() {
            // get the inputs
            clientId = client_id.value;
            clientSecret = client_secret.value;
            // only use entered account id if client id and secret are entered also
            if (isDefined(clientId) && isDefined(clientSecret)) {
                if (isDefined(account_ids.value)) {
                    accountId = account_ids.value;
                } else {
                    window.alert('To use your own account, you must specify an account id, and client id, and a client secret - since at least one of these is missing, a sample account will be used');
                    clientId = '';
                    clientSecret = '';
                    accountsArray = '1752604059001';
                }
            } else {
                accountId = '1752604059001';
            }
            setRequestData('setDefaults');
        });

        getCredentials.addEventListener('click', function() {
            if (isDefined(account_ids_cred.value) && isDefined(bc_token.value)) {
                disableButton(setDefaults);
                account_ids_cred.value = account_ids_cred.value.replace(/\s/g, '');
                account_ids.value = account_ids_cred.value;
                accountsArray = account_ids_cred.value.split(',');
                bcToken = bc_token.value;
                setRequestData('getCredentials');
            } else {
                window.alert('You must include a BC_TOKEN and an account id to get your credentials - if you already have credentials for ingest profiles, just enter the client id and secret in the form below');
            }
        });
        apiResponse.addEventListener('click', function() {
            apiResponse.select();
        });
    }
    // kick things off
    init();
})(window, document);
</script>
    <script>
        $(document).foundation();
    </script>
<iframe id="CSAT" src="
http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=articleURL" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
<script>

    var cSat = document.getElementById('CSAT'),
        cSatSrc = cSat.getAttribute('src'),
        pageurl = window.location.href;
    cSat.setAttribute('src', cSatSrc.replace('articleURL', pageurl));

</script>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>

</html>
