<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
  <!-- change title to match the h1 heading -->
  <title>Quick Start to Policy API</title>
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/foundation.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/css/normalize.css" />
  <script src="//use.edgefonts.net/source-code-pro.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

  <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/atelier-forest.light.min.css">
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack-extended.min.css">

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-2728311-29', 'auto');
    ga('send', 'pageview');

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/vendor/modernizr.js"></script>
</head>

<body>
  <!-- header navbar -->
  <div id="navWrapper" class="fixed"></div>
  <!-- breadcrumbs -->
  <nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
  <div class="row">
    <div class="sidebar large-2 columns show-for-large-up">
      <div id="sidenav" class="side-nav"></div>
    </div>
    <div id="main" class="large-10 small-12 columns">
      <div id="top" class="section">
        <h1>Quick Start to the Policy API</h1>
        <!-- Place document intro sentence(s) here -->

        <p>In this quick start you will perform the following tasks:</p>
        <ul>
          <li>Create a policy object</li>
          <li>Retrieve a policy object</li>
        </ul>
        <p class="BCL-aside">For details on the API used in this document you can view the <a href="//docs.brightcove.com/en/video-cloud/cms-api/getting-started/overview-cms.html">Content Management System API Overview</a> document and the <a href="//docs.brightcove.com/en/video-cloud/cms-api/references/cms-api/versions/v1/index.html">Content Management System API</a> reference.</p>
      </div>
      <div id="api-tester" class="section">
        <h2>API Tester</h2>
        <p>The Policy API's security is implemented using OAuth2. To permit you to get started using the Policy API as quickly as possible, the API calls in this quick start will use a shell script called <strong>api-tester.sh</strong> to get access tokens and make the API calls. The api-tester script uses cURL to make http calls. cURL is built in on Mac OS X and all Unix/Linux systems. To get cURL on Windows, see <a href="../../concepts/curl/curl.html">Setting up cURL</a>. Then download the <a href="../../oauth-api/assets/api-tester.sh.zip">api-tester.sh script</a></p>
        <p class="BCL-aside">You can see the full code for the shell script at <a href="../../oauth-api/guides/get-token.html#codeSamples">Getting Access Tokens</a>.</p>
        <h3>Running the shell script</h3>
        <p>After you download the shell script, unzip it wherever you like, and then go to a command line in the same folder. To run the script, type:</p>
        <pre><code>bash api-tester.sh</code></pre>
        <p>Each time you run the script, it will prompt you for 5 variables:</p>
        <ul>
          <li>Client ID (see the <a href="#obtaincredentials">next section</a> on obtaining client credentials)</li>
          <li>Client Secret (see the <a href="#obtaincredentials">next section</a> on obtaining client credentials)</li>
          <li>The full API call (example: <code>https://policy.api.brightcove.com/v1/accounts/12345678/policy_keys</code></li>
          <li>The request verb - one of the following: GET | POST </li>
          <li>Request data - used for POST, PATCH, and PUT; for GET and DELETE requests, you will leave this blank and just press <strong>return</strong></li>
        </ul>
        <p>For each part of this quick start, you will be given the values for each of these inputs to use with your account.</p>
      </div>
      <div id="obtaincredentials" class="section">
        <h2>Obtain credentials</h2>
        <p>To use the Policy API you will need proper credentials. In this quick start, you will work on a Brightcove test account, so you will not need to complete this step, but be aware that you will need to get client credentials when you work on your own account.</p>
        <ol>
          <li>To obtain credentials follow the instructions in <a href="../../oauth-api/guides/managing-api-credentials.html">Managing API Credentials</a>. This is the recommended way of obtaining your client credentials. The permissions you will need are <strong>Player Read</strong> and <strong>Player Read/Write</strong>:
            <div><img src="./assets/quick-start-required-permissions.png" width="412" height="140"></div>
            <p>You can also obtain credentials using the OAuth API, following the instructions in one of the guides listed below:</p>
              <ul>
                <li><a href="//docs.brightcove.com/en/video-cloud/oauth-api/guides/get-client-credentials.html">OAuth: Get Client Credentials Using CURL</a></li>
                <li><a href="//docs.brightcove.com/en/video-cloud/oauth-api/guides/get-client-credentials-postman.html">OAuth: Get Client Credentials Using Postman</a></li>
              </ul>
            </li>
          </ol>
        </div>

  <div id="createPolicy" class="section">
    <h2>Create a policy</h2>
    <p>One of the basic tasks you will want to create a policy. The fundamental call information is:</p>
    <ul>
      <li>HTTP method: <code>POST</code></li>
      <li>Endpoint: <code>https://policy.api.brightcove.com/v1/accounts/<em>{YOUR_ACCOUNT_ID}</em>/policy_keys</code></li>
    </ul>
    <p>You will need to pass data defining the policy in the request body. The simplest policy looks like this:</p>
<pre><code>{
  "key-data": {
      "account-id": "{account_id}"
  }
}</code></pre>
    <ol start="2">
      <li>You will now use the api-tester.sh script to retrieve all videos. Run <code>bash api-tester.sh</code> using the input values below:
      <p>client_id:</p>
        <pre><code>553d4903-4547-435d-944c-2c8e2f6abc5d</code></pre>
      <p>client_secret:</p>
        <pre><code>ENBQH6pHfJQub7oR0SGCn2Pu_W2SY5QsVw24fK-frXcE6hdTRnJO-0_LBmKZh15rVliIAiECAQF1yBYP_l90gQ</code></pre>
      <p>Request URL:</p>
<pre><code>https://policy.api.brightcove.com/v1/accounts/57838016001/policy_keys</code></pre>
        <p>Request method</p>
        <pre><code>POST</code></pre>
        <p>Request data:</p>
<pre><code>{"key-data": {"account-id": "57838016001"}}</code></pre>
      </li>
      <li>The response should look like this:
<pre><code>{
    "key-data": {
        "account-id": "57838016001"
    },
    "key-string": "BCpkADawqM1sAorMz0FAkKX5KbEf_bX4-svEsgdEQszAm0SF7fnm-d-KCDSI8yU7lArijlJ95g3G2FkucW0ivo0oT_A2cV7seXt5-8BR8tvduw4B-DTXVjQNjr8",
    "policies": [
        {
            "effect": "deny",
            "pattern": {
                "!=": [
                    "[request.params.account-id]",
                    "57838016001"
                ]
            }
        }
    ]
}</code></pre>
      </li>
    </ol>
  </div>
  <div id="Set_policy_app" class="section"></div>
  <h2>Set policy app</h2>
  <p>Here is a simple app that allows you to create a basic policy key.</p>
  <fieldset>
      <legend>Create Policy Key</legend>
      <p>
          If you do not enter account information, a Brightcove sample account will be used.
      </p>
      <p>Account id: <input id="account_id" type="text" value="" placeholder="1752604059001"></p>
      <p>Client id: <input id="client_id" type="text" size="60" value="" placeholder="c5d0a622-5479-46d8-8d8a-5f034b943fab"></p>
      <p>Client secret: <input id="client_secret" type="text" size="60" value="" placeholder="w7NQYu0vUloM4GYYy2SXAxrvyFpt8fwI35qAFZcS13-VIgs0itwKNsAwHOS80sOWKJ1BUwHIvSFG2I"></p>
      <p><button class="bcls-button" id="generateKey">Generate the Feed</button></p>
      <h3></h3>
      <pre><code id="apiRequest"></code></pre>
      <pre><code id="requestData"></code></pre>

      <h3>Response</h3>
      <pre><code id="apiResponse"></code></pre>
  </fieldset>
  <div id="getPolicy" class="section">
    <h2>Get a policy</h2>
    <p>The call for getting a policy object is:</p>
    <ul>
      <li>HTTP method: <code>GET</code></li>
      <li>Endpoint: <code>https://policy.api.brightcove.com/v1/accounts/<em>{YOUR_ACCOUNT_ID}</em>/policy_keys/{key_string}</code></li>
    </ul>
    <p>The video object returned will look like the response to the previous step, including the encrypted key-string and the associated policy.</p>
    <ol start="4">
      <li>You will now get a policy object.  Run <code>bash api-tester.sh</code> from the command line again, using the following input values:
        <p>client_id:</p>
        <pre><code>553d4903-4547-435d-944c-2c8e2f6abc5d</code></pre>
      <p>client_secret:</p>
        <pre><code class="nohighlight">5ENBQH6pHfJQub7oR0SGCn2Pu_W2SY5QsVw24fK-frXcE6hdTRnJO-0_LBmKZh15rVliIAiECAQF1yBYP_l90gQ</code></pre>
      <p>Request URL:</p>
<pre><code>https://cms.api.brightcove.com/v1/accounts/57838016001/policy_keys/BCpkADawqM0NK0Rq8n6sEQyWykemrqeSmIQqqVt3XBrdpl8TYlvqN3hwKphBJRnkPgx6WAbozCW_VgTOBCNf1AQRh8KnmXSXfveQalRc5-pyNlSod5XzP99If2U</code></pre>
        <p>Request method</p>
        <pre><code>GET</code></pre>
        <p>Request data: none (just press Return)</p>

      </li>
      <li>The response should look like this:
<pre><code>{
    "key-data": {
        "account-id": "57838016001"
    },
    "key-string": "BCpkADawqM0NK0Rq8n6sEQyWykemrqeSmIQqqVt3XBrdpl8TYlvqN3hwKphBJRnkPgx6WAbozCW_VgTOBCNf1AQRh8KnmXSXfveQalRc5-pyNlSod5XzP99If2U",
    "policies": [
        {
            "effect": "deny",
            "pattern": {
                "!=": [
                    "[request.params.account-id]",
                    "57838016001"
                ]
            }
        }
    ]
}</code></pre>
</li>

    </div>
      <div class="section" id="BCLreferences">
        <h2>Related Topics</h2>
        <ul>
          <li><a href="./api-overview.html">Policy API Overview</a></li>
        </ul>
      </div>
    </div>
  </div>
  <!-- bcl scripts -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/2.2/gist-embed.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.3/js/foundation.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.3/handlebars.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
  <script src="/en/scripts/log.js"></script>
  <script src="/en/scripts/docs-nav-data.min.js"></script>
  <script src="/en/scripts/bcls-doc-site-v1.js"></script>
  <script src="/en/scripts/bc-mapi.js"></script>
  <script>
    $(document).foundation();
  </script>
    <script type="text/javascript">
    var BCLS = ( function () {
        var account_id = document.getElementById('account_id'),
            client_id = document.getElementById('client_id'),
            client_secret = document.getElementById('client_secret'),
            accountId,
            clientId,
            client_secret,
            apiRequest = document.getElementById('apiRequest'),
            requestData = document.getElementById('requestData'),
            apiResponse = document.getElementById('apiResponse'),
            generateKey = document.getElementById('generateKey'),
            // api urls
            proxyURL = 'https://solutions.brightcove.com/bcls/bcls-proxy/mrss-proxy.php',
            baseURL = 'https://policy.api.brightcove.com/v1/accounts/',
            urlSuffix = 'policy-keys';

            /**
             * disables all buttons so user can't submit new request until current one finishes
             */
            function disableButtons() {
                var i,
                    iMax = allButtons.length;
                for (i = 0; i < iMax; i++) {
                    allButtons[i].setAttribute('disabled', 'disabled');
                }
            }

            /**
            * re-enables all buttons
            */
            function enableButtons() {
                var i,
                iMax = allButtons.length;
                for (i = 0; i < iMax; i++) {
                    allButtons[i].removeAttribute('disabled');
                }
            }

            /**
             * sets up the data for the API request
             * @param {String} id the id of the button that was clicked
             */
            function setRequestData(id) {
                var requestData = {},
                    callback = function (response) {

                    }
                // disable buttons to prevent a new request before current one finishes
                disableButtons();
                requestData.url = baseURL + accountId + urlSuffix;
                requestData.requestType = 'POST';
                requestData.requestBody = '{"key-data": {"account-id": "' + {account_id} + '"}}'
                apiRequest.textContent = requestData.url;
                sendRequest(requestData, id);
            }

            /**
             * send API request to the proxy
             * @param  {Object} requestData options for the request
             * @param  {String} requestID the type of request = id of the button
             * @param  {Function} [callback] callback function
             */
            function sendRequest(options, requestID, callback) {
                var httpRequest = new XMLHttpRequest(),
                    responseRaw,
                    parsedData,
                    requestParams,
                    dataString,
                    sources,
                    // response handler
                    getResponse = function() {
                        try {
                            if (httpRequest.readyState === 4) {
                                if (httpRequest.status === 200) {
                                    // check for completion
                                    if (requestID === 'getCount') {
                                        responseRaw = httpRequest.responseText;
                                        parsedData = JSON.parse(responseRaw);
                                        // set total videos
                                        totalVideos = parsedData.count;
                                        totalCalls = Math.ceil(totalVideos / limit);
                                        logger.textContent = 'Total videos: ' + totalVideos;
                                        setRequestData('getVideos');
                                    } else if (requestID === 'getVideos') {
                                        if (httpRequest.responseText === '[]') {
                                            // no video returned
                                            alert('no video returned');
                                        }
                                        responseRaw = httpRequest.responseText;
                                        parsedData = JSON.parse(responseRaw);
                                        videosArray = videosArray.concat(parsedData);
                                        callNumber++;
                                        if (callNumber < totalCalls) {
                                            logger.textContent = 'Getting video set ' + callNumber;
                                            setRequestData('getVideos');
                                        } else {
                                            logger.textContent = 'Video data for ' + totalVideos + ' retrieved; getting sources...';
                                            callNumber = 0;
                                            setRequestData('getVideoSources');
                                        }
                                    } else if (requestID === 'getVideoSources') {
                                        if (httpRequest.responseText === '[]') {
                                            // no video returned
                                            sources = [];
                                            callback(sources);
                                        } else {
                                            responseRaw = httpRequest.responseText;
                                            sources = JSON.parse(responseRaw);
                                            // increment offset
                                            callback(sources);
                                        }

                                    } else {
                                      alert('There was a problem with the request. Request returned ' + httpRequest.status);
                                    }
                                }
                            }
                        } catch (e) {
                          alert('Caught Exception: ' + e);
                        }
                    };
                // set up request data
                requestParams = "url=" + encodeURIComponent(options.url) + "&requestType=" + options.requestType;
                // only add client id and secret if both were submitted
                if (isDefined(clientId) && isDefined(clientSecret)) {
                    requestParams += '&client_id=' + clientId + '&client_secret=' + clientSecret;
                }

                // set response handler
                httpRequest.onreadystatechange = getResponse;
                // open the request
                httpRequest.open('POST', proxyURL);
                // set headers
                httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                // open and send request
                httpRequest.send(requestParams);
            }

            function init() {
                // event handlers
                makeFeed.addEventListener('click', function() {
                    var numVideos;
                    // get the inputs
                    clientId = client_id.value;
                    clientSecret = client_secret.value;
                    // only use entered account id if client id and secret are entered also
                    if (isDefined(clientId) && isDefined(clientSecret)) {
                        if (isDefined(account_id.value)) {
                            accountId = account_id.value;
                        } else {
                            window.alert('To use your own account, you must specify an account id, and client id, and a client secret - since at least one of these is missing, a sample account will be used');
                            clientId = '';
                            clientSecret = '';
                            accountId = '1752604059001';
                        }
                    } else {
                        accountId = '1752604059001';
                    }
                    sort = getSelectedValue(sortSelect);
                    sortDirection = getSelectedValue(directionSelect);
                    if (isDefined(sortDirection)) {
                        sort = sortDirection + sort;
                    }
                    search = searchStr.value;
                    numVideos = getSelectedValue(numberSelect);
                    // add title and description
                    mrssStr += sChannel + sTitle + feedTitle.value + eTitle + sDescription + feedDescription.value + eDescription;
                    // if all videos wanted, get count; otherwise get videos
                    if (numVideos === 'all') {
                        // we need to get the count
                        setRequestData('getCount');
                    } else {
                        totalVideos = parseInt(numVideos);
                        totalCalls = Math.ceil(numVideos / limit);
                        logger.textContent = 'Total videos to retrieve: ' + totalVideos;
                        setRequestData('getVideos');
                    }
                });
                feedDisplay.addEventListener('click', function() {
                    feedDisplay.select();
                });
            }

            init();
    })();
    </script>

    <script>
      var feedbackMail = document.getElementById("feedbackMail");
      feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
    </script>
  <iframe id="CSAT" src="
http://survey.clicktools.com/app/survey/go.jsp?iv=3poon3e7e9spn&q1=
[articleURL]" style="margin-left:25%; padding-bottom:20px;width:550px;height:475px;border:none"></iframe>
<script>

    var cSat = document.getElementById('CSAT'),
        cSatSrc = cSat.getAttribute('src'),
        pageurl = window.location.href;
    cSat.setAttribute('src', cSatSrc.replace('[articleURL]', pageurl));

</script>
<br><br>
<div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
<script>
var feedbackMail = document.getElementById("feedbackMail");
feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
</script>
</body>

  </html>
