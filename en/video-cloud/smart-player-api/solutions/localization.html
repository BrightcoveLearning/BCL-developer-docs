<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" />
    <!-- change title to match the h1 heading -->
    <title id="bclPageTitle">Smart Player API Samples: Localization</title>
    <link href="//cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" rel="stylesheet" type="text/css" />
    <script src="//use.edgefonts.net/source-code-pro.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/en/styles/bcls-doc-site.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link href="/en/video-cloud/smart-player-api/samples/css/api-samples.css" rel="stylesheet" type="text/css">
    <style id="pageStyles">
      /**********************************
      video training course playlist
      **********************************/
      .BCLbutton {
        background-color: #ffffff;
        background-image: -webkit-gradient(radial, 50% 50%,0,50% 50%,200, from(#dddddd), to(#ffffff));
        background-image: -webkit-radial-gradient(50% 50%, #ffffff, #dddddd);
        background-image: -moz-radial-gradient(50% 50%, #ffffff, #dddddd);
        background-image: -o-radial-gradient(50% 50%, #ffffff, #dddddd);
        background-image: -ms-radial-gradient(50% 50%, #ffffff, #dddddd);
        background-image: radial-gradient(50% 50%, #ffffff, #dddddd);
        border: #999999 1px solid;
        border-radius: 5px;
        font-size: .7em;
        padding: 5px;
        cursor: pointer;
        width: 200px;
        text-align: center;
        margin-top: 5px;
      }
      .bcl-playlist {
        /* display: table; */
        width: 100%;
        padding: 1px;
        vertical-align: middle;
        height: 500px;
        overflow: scroll;
      }
      .bcl-playlist-item {
        display: table-row;
        cursor: pointer;
        margin: 2px;
        max-height: 66px;
        padding: 1px;
        background-color: #edefef;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#edefef), to(#dbdbdb));
        background-image: -webkit-linear-gradient(top, #edefef, #dbdbdb);
        background-image: -moz-linear-gradient(top, #edefef, #dbdbdb);
        background-image: -o-linear-gradient(top, #edefef, #dbdbdb);
        background-image: -ms-linear-gradient(top, #edefef, #dbdbdb);
        background-image: linear-gradient(top, #edefef, #dbdbdb);
        filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,StartColorStr='#edefef', EndColorStr='#dbdbdb');
      }
      .bcl-playlist-item:hover,.bcl-highlight {
        display: table-row;
        cursor: pointer;
        margin: 2px;
        max-height: 66px;
        padding: 1px;
        border-bottom: 1px #999 solid;
        color: #f5f5f5;
        background-color: #2a2a2a;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#2a2a2a), to(#5a5a5a));
        background-image: -webkit-linear-gradient(top, #2a2a2a, #5a5a5a);
        background-image: -moz-linear-gradient(top, #2a2a2a, #5a5a5a);
        background-image: -o-linear-gradient(top, #2a2a2a, #5a5a5a);
        background-image: -ms-linear-gradient(top, #2a2a2a, #5a5a5a);
        background-image: linear-gradient(top, #2a2a2a, #5a5a5a);
        filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,StartColorStr='#2a2a2a', EndColorStr='#5a5a5a');
      }
      .bcl-playlist-item img {
        float: left;
        width: 120px;
        height: 68px;
        margin: 0 5px 0 0 !important;
      }
      .bcl-highlight img {
        float: left;
        width: 120px;
        height: 68px;
        margin: 0 5px 0 0 !important;
      }
      .bcl-playlist-item div h4 {
        font-size: 14px;
        margin: 5px 0 0 0 !important;
      }
      .bcl-highlight div h4 {
        font-size: 14px;
        margin: 5px 0 0 0 !important;
      }
      .bcl-playlist-item div p {
        font-size: 12px;
        margin: 3px 0 0 0 !important;
        line-height: 16px !important;
      }
      .bcl-highlight div p {
        font-size: 12px;
        margin: 3px 0 0 0 !important;
        line-height: 16px !important;
      }
      #play-area {
        position: relative;
      }
      #playlist {
        position: absolute;
        left: 0;
        top: 0;
        height: 500px;
        max-height: 500px;
        overflow: scroll;
      }
      #flipButton {
        text-align: right;
      }
      .bcl-show {
        margin-left: auto;
        z-index: 99;
      }
      .bcl-hide {
        margin-left: -9999px;
        z-index: 1;
      }
      .displayName {
          font-weight: bold;
          font-size: 1.2em;
      }
    </style>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2728311-29', 'auto');
  ga('send', 'pageview');

</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/vendor/modernizr.js"></script>
  </head>
  <body>
  <!-- header navbar -->
	<div id="navWrapper" class="fixed"></div>
	<!-- breadcrumbs -->
	<nav id="breadCrumbWrapper" class="breadcrumbs show-for-medium-up"></nav>
  <!-- search -->
  <div id="searchModal" class="reveal-modal" data-reveal></div>
  <!-- content -->
    <div class="row">
        <div class="sidebar large-2 columns show-for-xlarge-up">
            <div id="sidenav"></div>
        </div>
        <div id="main" class="large-10 small-12 columns">

        <div id="top" class="section">
            <h1 id="bclPageHeading">Smart Player API Samples: Localization</h1>
          <p>This example shows a technique for localizing video titles and descriptions in a playlist. It is a slightly modified version of a solution we created for the Brightcove Support site &mdash; you can see the original at <a href="//support.brightcove.com/en/video-cloud/docs/training-demand-video-cloud-essentials">http://support.brightcove.com/en/video-cloud/docs/training-demand-video-cloud-essentials</a>.</p>
          <p>You can add a multi-language captions file to any video, as we have done here, but it would also be nice to localize the titles and descriptions in the player and/or playlist.</p>
          <p>There are several other things besides localization going on in this sample &mdash; toggling views between the player and the playlist, for example, and setting auto-advance to the next video &mdash; but all of that is just HTML | CSS | JavaScript, so we are just going to focus on the localization part.</p>
          <div class="text-warning">
              <h3>3rd party libraries used in this sample</h3>
              <p>Note: 3rd party libraries are used to simplify the JavaScript in the sample. These libraries are not supported by Brightcove. All functionality can be reproduced in ordinary JavaScript.</p>
              <ul>
                <li><a href="//jquery.org">jQuery</a></li>
                <li><a href="http://handlebarsjs.com/">Handlebars</a></li>
              </ul>
            </div>
          </div>
        <!-- every div class section must have an id -->
        <div class="section" id="resources">
          <h2><a name="resources"></a>API resources used</h2>
          <p>This sample uses the following API resources</p>
          <h4>Modules and methods</h4>
          <ul>
            <li>CONTENT
              <ul>
                <li>getPlaylistByID()</li>
                <li>updateMedia()</li>
              </ul>
            </li>
            <li>VIDEO_PLAYER
              <ul>
                <li>getCurrentVideo()</li>
                <li>addEventListener()</li>
                <li>cueVideoByID()</li>
                <li>play()</li>
              </ul>
            </li>
          </ul>
          <h4>Events</h4>
          <ul>
            <li>templateLoad</li>
            <li>templateReady</li>
            <li>Media: BEGIN</li>
            <li>Media: COMPLETE</li>
          </ul>
        </div>
        <div class="section" id="player">
          <!-- h2 contents will be in page navigation label - 21 characters (including spaces) maximum -->
          <h2><a name="player"></a>The player</h2>
          <p>A basic Chromeless Video Player is used for this sample.</p>
          <p class="text-warning">Note: the buttons below are for development purposes only &mdash; do not use in production.</p>
          <!-- buttons to switch between HTML and Flash Players -->
          <div id="modeSwitch">
            <span class="button" id="switchToHTML5" style="margin-bottom: 20px;margin-right: 10px;">Switch to HTML5 Player</span>
            <span class="button" id="switchToFlash" style="margin-bottom: 20px;">Switch to Flash Player</span>
          </div>
          <div class="player-block">
            <p>
              <span id="flipButton" class="BCLbutton">Show the topics</span>
              <span id="en" class="BCLbutton bclLanguage">English</span>
              <span id="de" class="BCLbutton bclLanguage">Deutsch</span>
              <span id="es" class="BCLbutton bclLanguage">Espa√±ol</span>
            </p>
              <p class="BCL-objective"></p>
            <div id="play-area">
              <div id="playlist"></div>
                <div id="videoPlayer" class="bcl-hide">
                  <!-- Start of Brightcove Player -->
                  <script language="JavaScript" type="text/javascript" src="//sadmin.brightcove.com/js/BrightcoveExperiences.js"></script>
                  <object id="myExperience" class="BrightcoveExperience">
                    <param name="bgcolor" value="#FFFFFF" />
                    <param name="width" value="660" />
                    <param name="height" value="371" />
                    <param name="playerID" value="2261168763001" />
                    <param name="playerKey" value="AQ~~,AAAA1oy1bvE~,ALl2ezBj3WHQA4dk5opKa9DGJeTOSBVj" />
                    <param name="isVid" value="true" />
                    <param name="isUI" value="true" />
                    <param name="dynamicStreaming" value="true" />
                    <param name="@videoPlayer" value="2268926256001" />
                    <param name="wmode" value="transparent" />

                    <param name="includeAPI" value="true" />
                    <param name="templateLoadHandler" value="BCLS.onTemplateLoad" />
                    <param name="templateReadyHandler" value="BCLS.onTemplateReady" />
                  </object>
                  <script src="//docs.brightcove.com/en/scripts/https-fix.js"></script><script type="text/javascript">brightcove.createExperiences();</script>
                  <!-- End of Brightcove Player -->
                  <p id="relatedLink" style="margin-bottom:150px"></p>
                </div>
             </div>
            </div>
          </div>
          <div class="section" id="logic">
            <h2><a name="logic"></a>How it is done</h2>
            <p>We created the playlist in the HTML &mdash; we generally prefer that to using playlist players, but here it is crucial, because we need to manipulate the video metadata in the playlist, and the Smart Player API does not provide a way to do that.</p>
            <p>After the basic setup, we get a reference to the <code>VIDEO_PLAYER</code> and <code>CONTENT</code> modules, and then use the <code>getPlaylistByID()</code> method to fetch the playlist DTO &mdash; we know what playlist we want, so it is hardcoded in the script.</p>
            <p>The localized strings for the titles and descriptions are stored in the video <code>longDescription</code> field as a JSON string:</p>
<pre><code>
{
  "en" : {
  "name": "Publishing a Player",
  "shortDescription" : "Learn how to generate the publishing code for a player using the Publishing module."
  },
  "de" : {
  "name": "Ver√∂ffentlichen eines Players",
  "shortDescription" : "Informationen zum Erzeugen des Ver√∂ffentlichungscodes f√ºr einen Player mithilfe des Ver√∂ffentlichungsmoduls."
  },
  "es" : {
  "name": "Publicaci√≥n de un reproductor",
  "shortDescription" : "Aprenda a generar el c√≥digo de publicaci√≥n de un reproductor con el m√≥dulo de publicaci√≥n."
  },
  "fr" : {
  "name": "",
  "shortDescription" : ""
  },
  "ja" : {
  "name": "",
  "shortDescription" : ""
  }
}
</code></pre>
            <p class="text-warning">Note the empty string valus for fr and ja: we do not have those translations yet, but are creating placeholders for when we do.</p>
            <p>In the callback function for the <code>getPlaylistByID()</code> call, we replace the <code>displayName</code> and <code>shortDescription</code> fields in the video DTOs before assembling the playlist and injecting it into the page. On the Support site, we get the site language from an identifier in the <code>window.location.pathname</code>. Here we don't have multiple language versions of the page, so we are simply putting buttons in the page to allow you to switch between English, German and Spanish versions of the playlist.</p>
            <p>With the localized strings at hand, it is relatively simple to swap them into the playlist items. This does not carry over when the video is loaded into the player, however, so when a video is selected, instead of playing it immediately, we use <code>cueVideoByID()</code> to get the video object into the player, then <code>getCurrentVideo()</code> to pull it out, and finally the <code>CONTENT</code> module <code>updateMedia()</code> method to put it back with the localized title and description. (This doesn't actually matter here, since the video player doesn't display this information, but we included that step for completeness.)</p>
            <p class="text-warning">Note: using updateMedia() adds an extra <code>video_impression</code> to the analytics data for the video, since the video is re-loaded into the player after the update.</p>
          </div>
          <div class="section" id="code">
            <h2>The code</h2>
            <h3>Modifications to the player publishing code</h3>
<pre><code>
  &lt;!-- smart player api params --&gt;
  &lt;param name="includeAPI" value="true" /&gt;
  &lt;param name="templateLoadHandler" value="BCLS.onTemplateLoad" /&gt;
  &lt;param name="templateReadyHandler" value="BCLS.onTemplateReady" /&gt;
</code></pre>
          <h3>CSS used for this sample:</h3>
<pre><code id="css_code"></code></pre>
            <h3>JavaScript used for this sample:</h3>
<pre><code id="js_code"></code></pre>
          </div>
        </div>
      </div>
    <!-- bcl scripts -->
    <script src="/en/scripts/prefix.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.3/fastclick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.2/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>

    <script src="/en/scripts/docs-nav-data.min.js"></script>
    <script src="/en/scripts/bcls-doc-site.js"></script>
    <script src="/en/scripts/flashHTMLswitch-nojQ.js"></script>
    <script src="/en/scripts/secondsToTime.js"></script>
    <script>
        $(document).foundation();
    </script>
    <script id="pageScript" type="text/javascript">
      /**** Brightcove Learning Services Module ****/
      var BCLS = (function() {
        var playlistShowing = true,
            player,
            APImodules,
            mediaEvent,
            videoPlayer,
            contentModule,
            videoLength = 0,
            videoLengthFormatted = false,
            siteLanguage = "en",
            totalTime = 0,
            playlistDTO = {},
            $nextItem,
            $playlistItems,
            $videoPlayer = $("#videoPlayer"),
            $videoPlayerChildren = $videoPlayer.children(),
            $playlist = $("#playlist"),
            $playlistChildren = $playlist.children(),
            $relatedLink = $("#relatedLink"),
            $flipButton = $("#flipButton"),
            $languageButtons = $(".bclLanguage"),
            relatedLink = {},
            playlistID = 2263786578001,
            playlistTemplate = "{{#videos}}<div class=\"bcl-playlist-item\" id=\"{{id}}\"><img src=\"{{thumbnailURL}}\"/ style=\"float:left\"><div><p class=\"displayName\">{{displayName}}</p><p class=\"shortDescription\">{{shortDescription}} [ {{length.m}}:{{length.s}} ]</p></div></div>{{/videos}}",
            relatedLinkTemplate = "Related document: <a href=\"{{linkURL}}\">{{linkText}}</a>";
        return {
          /**** template loaded event handler ****/
          onTemplateLoad : function (experienceID) {
            BCLSmain.bclslog("loaded");
            BCLSmain.bclslog(experienceID);
            // get a reference to the player and API Modules and Events
            player = brightcove.api.getExperience(experienceID);
            APImodules = brightcove.api.modules.APIModules;
            mediaEvent = brightcove.api.events.MediaEvent;
          },
          /**** template ready event handler ****/
          onTemplateReady : function (evt) {
            BCLSmain.bclslog("ready");
            // get references to modules
            contentModule = player.getModule(APImodules.CONTENT);
            videoPlayer = player.getModule(APImodules.VIDEO_PLAYER);
            contentModule.getPlaylistByID(playlistID, BCLS.onPlaylistLoad);
            videoPlayer.addEventListener(mediaEvent.BEGIN, BCLS.onMediaBegin);
            videoPlayer.addEventListener(mediaEvent.COMPLETE, BCLS.onMediaComplete);
            // add listener for click on the flip button
            $flipButton.on("click", BCLS.switchViews);
            // add listener for click on the language buttons
            $languageButtons.on("click", function (evt) {
              BCLSmain.bclslog("language click")
              var $this = $(this);
              var $displayNames = $(".displayName");
              var $shortDescriptions = $(".shortDescription");
              siteLanguage = $this.attr("id");
              BCLSmain.bclslog(siteLanguage);
              // make sure the playlist has been processed
              if (playlistDTO !== {}) {
                for (var i = 0, max = playlistDTO.videos.length; i < max; i++) {
                  var languageObj = playlistDTO.videos[i].localizedData[siteLanguage];
                  $displayNames[i].innerHTML = languageObj.name;
                  $shortDescriptions[i].innerHTML = languageObj.shortDescription;
                }
              }
            });
          },
          /**** handler for playlist return ****/
          onPlaylistLoad : function (DTO) {
            BCLSmain.bclslog("playlist loaded");
            var video = {};
            // get the total time and adjust length data, localize fields
            for (var i = 0, max = DTO.videos.length; i < max; i++) {
              video = DTO.videos[i];
              if (!videoLengthFormatted) {
                totalTime += video.length;
              videoLength = BCLSsecondsToTime(video.length / 1000);
              BCLSmain.bclslog(videoLength);
              video.length = videoLength;
              BCLSmain.bclslog(video.length)
              }
              // if siteLanguage is EN,DE, or ES, need to modify the Handlebars template
              if (siteLanguage == "en" || "de" || "es" ) {
                // save the localized data in the DTO for language switching later
                video.localizedData = JSON.parse(video.longDescription);
                var languageObj = video.localizedData[siteLanguage];
                video.displayName = languageObj.name;
                video.shortDescription = languageObj.shortDescription;
              }
            }
            // one way or another the time is now formatted
            videoLengthFormatted = true;
            BCLS.setTotalTime();
            var template = Handlebars.compile(playlistTemplate);
            var data = DTO;
            var results = template(data);
            $playlist.html(results);
            $playlist.fadeIn();
            $playlistItems = $("div.bcl-playlist-item");
            $playlistItems.on("click", BCLS.playVideo);
            // save the DTO for language switches
            playlistDTO = DTO;
          },
          setTotalTime : function () {
            if (!totalTime.s) {
              totalTime = BCLSsecondsToTime(totalTime / 1000);
            }
            $(".BCL-objective").html(" The total time for this course: " + totalTime.h + ":" + totalTime.m + ":" + totalTime.s);
          },
          playVideo : function() {
            var $this = $(this);
            var videoID = $(this).attr("id");
            $nextItem = $this.next(".bcl-playlist-item");
            $playlistItems.attr("class","bcl-playlist-item")
            $this.attr("class","bcl-highlight");
            if (playlistShowing){
              BCLS.switchViews();
            }
            $flipButton.attr("class","BCLbutton");
            // cue the video, localize the title, then play
            videoPlayer.cueVideoByID(videoID);
            if (siteLanguage == "en" || "de" || "es" ) {
              videoPlayer.getCurrentVideo( function (videoDTO) {
                var languageObj = JSON.parse(videoDTO.longDescription);
                var currentLanguage = languageObj[siteLanguage];
                videoDTO.displayName = currentLanguage.name;
                videoDTO.shortDescription = currentLanguage.shortDescription;
                contentModule.updateMedia(videoDTO, function (newVideoDTO) {
                  videoPlayer.play();
                });
              });
            } else {
              videoPlayer.loadVideoByID()
            }
          },
          onMediaBegin : function(evt) {
            BCLSmain.bclslog("begin");
            videoPlayer.getCurrentVideo( function(videoDTO) {
              if (videoDTO.linkText !== null) {
                var template = Handlebars.compile(relatedLinkTemplate);
                var data = videoDTO;
                var results = template(data);
                $relatedLink.html(results);
              } else {
                $relatedLink.html("");
              }
            });
          },
          onMediaComplete : function(evt) {
            BCLSmain.bclslog("complete")
            if ($nextItem.length > 0) {
              // trigger a click on the next item
              $nextItem.trigger("click");
            } else {
              BCLS.switchViews();
            }
          },
          switchViews : function() {
            BCLSmain.bclslog("switching views");
            if (playlistShowing) {
              $playlist.fadeOut();
              $playlistChildren.fadeOut();
              $videoPlayer.attr("class","bcl-show");
              $videoPlayerChildren.attr("class","bcl-show");
              $flipButton.html("Show the topics");
              playlistShowing = false;
            } else {
              $playlist.fadeIn();
              $playlistChildren.fadeIn();
              $videoPlayer.attr("class","bcl-hide");
              $videoPlayerChildren.attr("class","bcl-hide");
              $flipButton.html("Show the player");
              playlistShowing = true;
            }
          }
        }
      })();
    </script>
    <script>
      $(document).ready(function(){
        $("#js_code").html(BCLSpreFix($("#pageScript").html()));
        $("#css_code").html(BCLSpreFix($("#pageStyles").html()));
      });
    </script>
      <div class="footer text-center"><a id="feedbackMail" href="mailto:docs@brightcove.com">Questions or comments?</a></div>
    <script>
	var feedbackMail = document.getElementById("feedbackMail");
	feedbackMail.setAttribute("href", "mailto:docs@brightcove.com?subject=question regarding " + encodeURI(document.location.href));
	</script>
	</body>
</html>
