

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
  <head>
    <title>
            Advanced Integration: 100% Integration Reliability --       Zencoder
    </title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"b32b942736","applicationID":"4441395","transactionName":"cgtWQ0EOWFwAFBlTCVIXF0RbDkM=","queueTime":0,"applicationTime":53,"agent":""}</script>
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(2),u=e(3),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}finally{f.emit("fn-end",[c.now()],t)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],4:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=m(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){v[e]=m(e).concat(n)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(t)}function g(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var v={},y={},b={on:l,emit:t,get:w,listeners:m,context:n,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(2),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!x++){var e=h.info=NREUM.info,n=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+h.offset],null,"api");var t=d.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===d.readyState&&i()}function i(){f("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),f=e("handle"),c=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1026.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=n.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),f("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="lhEDwIesd3Zwt52BtwiCloNm+2m1bpjYrIVVGhKSodM=" name="csrf-token" />
    <script type="text/javascript">
      var _sf_startpt          = (new Date()).getTime();
      var _km_api_key          = '9e336b149965e7863a3f63ef82f0a9652e947238';
      var _mapbox_access_token = 'pk.eyJ1IjoiemVuY29kZXIiLCJhIjoiZlNCeDJIYyJ9.4aMQV_HE7Gf8lB4xC8qWNQ';
      var _zc_environment      = 'production';
      var _zc_controller       = 'docs_controller';
      var _zc_changelog        = false;
    </script>

    <!--[if lt IE 9]>
      <script src="https://a.zencdn.net/assets/selectivizr-d7619a79537ff588d4d36e42778b61c0.js" type="text/javascript"></script>
    <![endif]-->

    <link href="../../../../a.zencdn.net/assets/common-8cb491527f6f845f407f3afa63412867.css" media="all" rel="stylesheet" type="text/css" />
    <link href="../../../../a.zencdn.net/assets/facebox-215b2aa3f5153bf1e5a65c3c813b2083.css" media="all" rel="stylesheet" type="text/css" />
    

    <!--[if IE]>
      <link href="https://a.zencdn.net/assets/ie-f71d51ef2dd07407e995cea78e2974f7.css" media="all" rel="stylesheet" type="text/css" />
    <![endif]-->
    <link href="../../../../a.zencdn.net/assets/print-cda8f121f6d18ef5eaccaa4944098308.css" media="print" rel="stylesheet" type="text/css" />      <link href="../../../../a.zencdn.net/assets/docs-6b24ef369bf9f9ffa4be33e0a98bc931.css" media="all" rel="stylesheet" type="text/css" />

    <link href="../../../../a.zencdn.net/assets/favicon-30d4e55c4200749dc5493d61be3c9079.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />

    
  </head>
  <body id="docs_show" class="application docs">
    <div id="wrap">
      <div id="parallax_1" class="parallax screen"><div id="parallax_2" class="parallax"><div id="parallax_3" class="parallax"></div></div></div>
      <div id="body_padding">
        <img alt="" class="print" height="65" src="../../../../a.zencdn.net/assets/logo-print-c8eb6ccdba8286b7c36e567b2527f3bc.png" width="300" />
        <div id="header" class="screen">
            <a href="http://zencoder.com" id="logo" class="screen">
            <img alt="" height="54" src="../../../../a.zencdn.net/assets/logo-4578a00ccade4cf0594054ff8625db54.png" width="250" />
          </a>
          <ul id="nav">
              <li>
      <a href="../../../signup.html"><span class="nav-title">Sign Up</span><span class="nav-desc">Create your account.</span></a>
    </li>
              <li>
      <a href="../../../login.html"><span class="nav-title">Log In</span><span class="nav-desc">See your stuff.</span></a>
    </li>
              <li class="selected">
      <a href="../../../docs.html"><span class="nav-title">Docs/Support</span><span class="nav-desc">Guides & reference.</span></a>
    </li>
          </ul>
        </div>
          
        <div id="main" class="clearfix">
              <ul id="docs_nav">
  <li id="docs-nav-search" class="category-group-name">
    <form accept-charset="UTF-8" action="../../search.html" id="doc_search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>      <input class="query" id="q" name="q" placeholder="Search" type="search" />
      <img alt="Spinner" id="doc_search_activity" src="../../../../a.zencdn.net/assets/spinner-a5ea8f7ee3514bae1534f6c05f4d361c.gif" style="display:none;" />
</form>  </li>
  <li class="category-group-name"><a href="../../../docs.html">Home</a></li>
  <li class="category-group-name">
    <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;%68%65%6c%70@%7a%65%6e%63%6f%64%65%72.%63%6f%6d?body=%5BHelpful%20things%20to%20include%3A%20links%20to%20source%20files%2C%20job%20IDs%2C%20screenshots...%5D">Support Email &raquo;</a>
  </li>
    <li class="category-group-name"><a href="../../guides.html">Guides</a></li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../getting-started.html">Getting Started</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../advanced-integration.html"><span class="selected">Advanced Integration</span></a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../encoding-settings.html">Encoding Recommendations</a>
          </li>
        </ul>
      </li>
    <li class="category-group-name"><a href="../../api.html">API Reference</a></li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../api/jobs.html">Jobs</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../api/inputs.html">Inputs</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../api/outputs.html">Outputs</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../api/accounts.html">Accounts</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../api/reports.html">Reports</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../api/encoding.html">Encoding Settings</a>
          </li>
        </ul>
      </li>
    <li class="category-group-name"><a href="../../faq.html">FAQ</a></li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../faq/basics.html">Basics</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../faq/codecs-and-formats.html">Codecs And Formats</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../faq/about-encoding.html">Encoding</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../faq/transfer.html">File Transfers</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../faq/problems.html">Problems</a>
          </li>
        </ul>
      </li>
      <li class="category-group-list">
        <ul>
          <li class="category-name">
              <a href="../../faq/pricing.html">Pricing</a>
          </li>
        </ul>
      </li>
    <li class="category-group-name"><a href="../../errors.html">Error Codes</a></li>
</ul>

  <div id="docs_content">
    <div id="main_content">
      
      <div id="search-results">
  <p>
    <a href="../../../docs.html">Home</a> &raquo; <a href="../../guides.html">Guides</a> &raquo; <a href="../advanced-integration.html">Advanced Integration</a> &raquo; 100% Integration Reliability
  </p>

  <h2>
      <span class="api-section-permalink">
        <a href="stable-integration.html">permalink</a>
      </span>
    100% Integration Reliability
  </h2>

    <p>Zencoder is an essential software dependency for most of our customers. And while we aim at 100% uptime, there may be times when you can't connect to Zencoder:</p>
<ul>
  <li>Our service might be affected by problems at an upstream provider (e.g. Amazon Web Services)</li>
  <li>We occasionally need to perform system maintenance that requires temporary downtime</li>
  <li>You have exceeded your <a href="https://app.zencoder.com/docs/faq/basics/api-rate-limiting">API rate limit</a></li>
  <li>etc.</li>
</ul>
<p>When this happens and Zencoder is down, your application will typically get a '503 Service Unavailable' response from Zencoder, but you could get a different error (like a 500). If you have exceeded your API rate limit, you will get a '403 Rate Limit Exceeded' response.</p>
<p>The good news: since video encoding is an asynchronous process, you can build your application to never experience downtime or problems related to our availability. If you do this, the worst case scenario is that your jobs take a bit longer. But no errors occur. We highly recommend that you do this.</p>
<p>To put it more strongly, <strong>if you care about reliability, you should follow this approach to integration</strong> &mdash; for Zencoder, or for any critical API that you integrate with.</p>
<h2>Steps to reliable app integration</h2>
<p>1. Include a <a href="https://app.zencoder.com/docs/api/encoding/general-output-settings/secondary-url">Secondary URL</a> as a backup in case upload to your primary location fails.</p>
<p>2. If you get a non-successful response code from Zencoder &mdash; basically, something other than a 200 or 201 &mdash; <strong>don't fail the job</strong>. A response code of 503 doesn't mean that your video can't be processed. It just means that Zencoder is temporarily unavailable.</p>
<p>3. If you get a <strong>connection error</strong> when trying to connect to Zencoder, do the same thing. </p>
<p>4. Similarly, <strong>wrap your API requests in a timeout</strong>. We recommend a 30 second timeout; Zencoder usually responds in less than a second, so 30 seconds is usually plenty of time.</p>
<p>5. In all three of these cases &mdash; if you get a non-successful response code, can't connect, or the API request times out &mdash; <strong>flag the job as 'pending'.</strong></p>
<p>6. Periodically, <strong>resubmit any jobs in the  'pending' state</strong>. You could use cron to do this every minute, for instance.</p>
<p>Once the jobs are resubmitted, everything behaves like normal. This way, a failed job submission only makes the job take a little longer rather than causing trouble for your application or your users.</p>
<h2>Pseudocode</h2>
<p>OK, so this isn't Pseudocode &mdash; it's Ruby. But Ruby is pretty easy to read.</p>
<p>1. Imagine a Videos table that includes these columns. (It will obviously have more, including columns to store a Zencoder job ID and a Zencoder output file ID.)</p>
<div class="docs-code">
  <pre class="brush: ruby;">  create_table :videos do |t|
    t.string  :state
    t.integer :lock_version
    t.index   :state
  end</pre>
</div>
<p>2. A Video should include a state machine with the following states:</p>
<ul>
  <li>pending (not yet submitted to Zencoder)</li>
  <li>submitting (currently submitting to Zencoder)</li>
  <li>transcoding (successfully submitted to Zencoder)</li>
  <li>finished (Zencoder finished transcoding, and the job is done)</li>
  <li>failed (Zencoder was unable to transcode the video)</li>
</ul>
<p>3. When a new video is ingested, save the video in the 'submitting' state and trigger a background job to submit the video to Zencoder. </p>
<div class="docs-code">
  <pre class="brush: ruby;"># got a new video!
video = Video.new(params)
video.state = "submitting"
video.save!
submit_to_zencoder(video)</pre>
</div>
<p>You really should background the submit_to_zencoder method. In Ruby, using DelayedJob, this might look like this:</p>
<div class="docs-code">
  <pre class="brush: ruby;">delay.submit_to_zencoder(video)</pre>
</div>
<p>But we'll stick with our <code>submit_to_zencoder(video)</code> method for example purposes.</p>
<p>4. The <code>submit_to_zencoder</code> function looks something like this. This should be run asynchronously, in the background.</p>
<div class="docs-code">
  <pre class="brush: ruby;">def submit_to_zencoder(video)
  begin
    response = Zencoder::Job.create(attributes, :timeout =&gt; 30_000)
    if response.code == 201
      video.state = "transcoding"
    else
      video.state = "pending"
    end

    video.save!

  # Rescue any connection error. Our plugin abstracts these as
  # Zencoder::HTTPError.
  #
  # If you're not using the Zencoder plugin, this includes things
  # like Errno::ECONNRESET, Errno::ETIMEDOUT, Errno::ECONNREFUSED,
  # Errno::EHOSTDOWN, and SocketError.

  rescue Timeout::Error, Zencoder::HTTPError
    video.state = "pending"
    video.save!
  end
end</pre>
</div>
<p>5. Every so often &mdash; e.g. every minute &mdash; try to resubmit jobs that are in the 'pending' state.</p>
<div class="docs-code">
  <pre class="brush: ruby;">
  def resubmit_pending_jobs
    Video.where(:state =&gt; "pending").find_each do |video|
      begin
        video.state = "submitting"
        video.save!

        submit_to_zencoder(video)
      rescue ActiveRecord::StaleObjectError
      end
    end
  end</pre>
</div>
<p>Also, by adding a 'lock_version' column to the videos table, we introduce optimistic locking. This means that if the record gets updated between the <code>Video.find</code> query and <code>video.save</code>, it won't submit the job to Zencoder. This will prevent the job to be submitted to Zencoder twice accidentally. You could use pessimistic or database locking or some other lock method to accomplish the same thing.</p>
<h2>It's that easy&#8230;</h2>
<p>All things considered, this is a pretty simple approach to ensuring 100% integration reliability between Zencoder and your application. It's a few more steps than just naively submitting a job; but it ensures that no matter what happens &mdash; whether it's an occasional timeout, or unexpected downtime at Zencoder, or scheduled maintenance &mdash; your app runs reliably.</p>

</div>

    </div>
    <div id="docs_search_results">
    </div>
  </div>

        </div>
      </div>
    </div>
    <div id="footer" class="screen">
      <div id="feedback">
        <div id="feedback_content" class="content">
          <!--<strong>I wish this page would...</strong>
          <input id="feedback_input" name="wish" type="text" value="" />
          <input height="23" name="mood" src="https://a.zencdn.net/assets/feedback-happy-84889f3f6afe3f2d48d11fbee6ea1a63.png" type="image" value="happy" width="22" />
          <input height="23" name="mood" src="https://a.zencdn.net/assets/feedback-meh-21ab4292195e219904858f43c47e3315.png" type="image" value="meh" width="22" />
          <input height="23" name="mood" src="https://a.zencdn.net/assets/feedback-sad-afac56b816085f0477aca92e378c0888.png" type="image" value="sad" width="22" /> -->
        </div>
      </div>
      <div id="footer_content" class="content clearfix">
        <div class="footer-column">
          <h4>Help!</h4>
          <ul>
            <li>For details on how to use Zencoder, check out our <a href="../../../docs.html">Documentation and Guides</a>.</li>
            <li>If you have a specific question, please open a <a href="https://support.brightcove.com/en/contact/create">support ticket</a>.</li>
            <li>For information about any ongoing issues, visit our <a href="http://status.zencoder.com">Status Page</a>.</li>
          </ul>
        </div>
        <div class="footer-column">
          <h4>The Latest</h4>
          <table>
            <tr>
              <th>March 31, 2017</th>
              <td><a href="https://www.brightcove.com/en/blog/2017/03/live-streaming-format-future">Live Streaming Format of the Future</a></td>
            </tr>
            <tr>
              <th>March 30, 2017</th>
              <td><a href="https://www.brightcove.com/en/blog/2017/03/video-marketing-mentors-integrating-video-your-tech-stack">Video Marketing Mentors: Integrating Video With Your Tech Stack</a></td>
            </tr>
            <tr>
              <th>March 27, 2017</th>
              <td><a href="https://www.brightcove.com/en/blog/2017/03/generate-short-links-your-players-video-cloud-studio">Generate Short Links to your Players in the Video Cloud Studio</a></td>
            </tr>
            <tr>
              <th>March 22, 2017</th>
              <td><a href="https://www.brightcove.com/en/blog/2017/03/video-analytics-now-available-media-module">Video Analytics Now Available in the Media Module</a></td>
            </tr>
          </table>
        </div>
        <div id="footer_docs" class="footer-column">
          <h4>Documentation</h4>
          <ul>
            <li><a href="../../faq.html">FAQ</a></li>
            <li><a href="../getting-started.html">Getting Started</a></li>
            <li><a href="../../faq/about-encoding.html">Encoding</a></li>
            <li><a href="../../api.html">API Integration</a></li>
            <li><a href="../../../login.html">Recent Changes</a></li>
          </ul>
        </div>
        <p id="legal">
          &copy; 2008&mdash;2017 Zencoder, Inc. All rights reserved. <a href="https://www.brightcove.com/privacy">Privacy Policy</a> | <a href="http://zencoder.com/terms">Terms of Use</a> | <a href="../../../login.html">Attribution</a>
        </p>
      </div>
    </div>

    <script src="../../../../a.zencdn.net/assets/common-f0a408a5dce1206885a8d0352891cf57.js" type="text/javascript"></script>
    
      <script src="../../../../a.zencdn.net/assets/docs-885652dd599dc12b5c70c9d7b810b371.js" type="text/javascript"></script>
  <script type='text/javascript'>
    var search_url = '/docs/ajax_search';
  </script>


  </body>
  <!-- Version: 3.325.1 -->
</html>

